<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - Mont Kaala</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">Mont Kaala</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 5637.864774475022</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 1016.7033483593525</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 57</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 196</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 1710</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 1379.680908203125</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 915.0, "max": 2280.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 297.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 1070.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [10.0, 110.0, 210.0, 310.0, 410.0, 510.0, 610.0, 710.0, 810.0, 910.0, 1010.0], "forest": [28.89330590757808, 131.13115758054667, 151.13421551656225, 191.14033138859344, 160.02446348812475, 151.13421551656225, 111.12809964453108, 50.007644840038985, 27.78202491113277, 12.224090960898419, 2.2225619928906215], "non_forest": [1451.3329813575758, 654.544506906288, 515.6343823506242, 493.408762421718, 417.8416546634368, 274.48640612199176, 302.2684310331245, 204.47570334593718, 156.6906204987888, 136.68756256277322, 16.669214946679663]}, "elevation_max": 1070.0, "elevation_median": 297.0, "forest_area": "1016.7033483593525", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[164.36923685944825, -20.644386572326574], [164.3684698610452, -20.645183095068052], [164.3681950345943, -20.646014438031173], [164.36840000961897, -20.644796130599183], [164.36923685944825, -20.644386572326574]]], [[[164.36733077693546, -20.639526183001703], [164.36790756522896, -20.639498273890727], [164.36894020233504, -20.640242516850076], [164.36639117019928, -20.63985178929642], [164.36733077693546, -20.639526183001703]]], [[[164.36052403816475, -20.634851397638332], [164.36085888914295, -20.635325769857438], [164.35954738947837, -20.636293117127774], [164.36017058435445, -20.634972316047126], [164.36052403816475, -20.634851397638332]]], [[[164.35992177147483, -20.63184006418864], [164.36016128293838, -20.63383754328769], [164.3591102229235, -20.634851397638332], [164.35852423371168, -20.63353989797374], [164.35992177147483, -20.63184006418864]]], [[[164.36963012448854, -20.628261344359167], [164.3711834609707, -20.62838226276796], [164.3690347175928, -20.628843147933832], [164.3675373058746, -20.63543738685015], [164.3663932316991, -20.633567802221904], [164.36508173203453, -20.637279067230214], [164.36064495657345, -20.6377348366172], [164.36235641712867, -20.63633962420806], [164.36205179575282, -20.63343990775113], [164.3640795044541, -20.63253767039321], [164.36290752603043, -20.633904978554177], [164.36308192758142, -20.63683259925929], [164.36415544711312, -20.636750247697584], [164.36414228901236, -20.6335212951416], [164.36717455064834, -20.63221909689308], [164.36866277721808, -20.628452023388405], [164.36963012448854, -20.628261344359167]]], [[[164.35623841071475, -20.62945890167702], [164.35808009109482, -20.629440298844898], [164.35680579709447, -20.629896068231886], [164.3584428463212, -20.630816908421924], [164.35683370134265, -20.631105252319816], [164.35623841071475, -20.62945890167702]]], [[[164.364426398829, -20.62413503108522], [164.3642217840997, -20.62525100063972], [164.3628828288488, -20.625539361641238], [164.3633933633667, -20.624070911750188], [164.364426398829, -20.62413503108522]]], [[[164.35628280345756, -20.622753228599862], [164.35765921038816, -20.621934824478966], [164.3558643013503, -20.62006551506647], [164.35791961169934, -20.62057701764203], [164.35608750247417, -20.61949821220994], [164.35945411942603, -20.620809518812738], [164.35876591596073, -20.619023909821696], [164.36063522537324, -20.62085601904688], [164.35791961169934, -20.624873639276725], [164.3563014035512, -20.624650438152845], [164.35628280345756, -20.622753228599862]]], [[[164.36501282045066, -20.615627677886355], [164.36496855686966, -20.617141826694347], [164.3624978100225, -20.617257009197896], [164.36437533038563, -20.615663125768506], [164.36501282045066, -20.615627677886355]]], [[[164.356270722312, -20.61486591132501], [164.3564567109145, -20.6152731438566], [164.35551809854712, -20.616379934229148], [164.3555809414169, -20.61523626050127], [164.356270722312, -20.61486591132501]]], [[[164.36759907663455, -20.612748641768455], [164.36713865854222, -20.613386457301615], [164.3655889687213, -20.612376912288436], [164.36709428910947, -20.611464887847045], [164.36759907663455, -20.612748641768455]]], [[[164.3644833485087, -20.60725769742445], [164.36683806754507, -20.608190741267983], [164.36703329558802, -20.610830798961533], [164.3646269574813, -20.608109496714818], [164.36572022607874, -20.61070793485666], [164.36337085618308, -20.609390846241197], [164.3644833485087, -20.60725769742445]]], [[[164.3479844741686, -20.60814200491084], [164.3474256952136, -20.60791175098603], [164.3481801326059, -20.607067262162523], [164.3483828970368, -20.607363202300782], [164.3479844741686, -20.60814200491084]]], [[[164.3586558416867, -20.60663809616051], [164.35948352667717, -20.606851992281644], [164.35975322178643, -20.60917695012006], [164.35891987602903, -20.608651711818823], [164.3586558416867, -20.60663809616051]]], [[[164.34670780897088, -20.607169888849043], [164.346028093905, -20.607596290014367], [164.34531533888975, -20.60765128678492], [164.34660510479435, -20.606890234186523], [164.34670780897088, -20.607169888849043]]], [[[164.36108309767002, -20.605763912013263], [164.36146439075551, -20.605410518421824], [164.3632499583754, -20.607819174742424], [164.36135279277926, -20.608432963611765], [164.36108309767002, -20.605763912013263]]], [[[164.34605126673793, -20.6052149594498], [164.345445267686, -20.605178106309044], [164.34493397169973, -20.604044383832793], [164.34649544919992, -20.604797405073537], [164.34605126673793, -20.6052149594498]]], [[[164.36231067540868, -20.602806565642798], [164.3637893485939, -20.602927463450396], [164.36564931486467, -20.605996407797104], [164.36422644066755, -20.606070806447935], [164.36231067540868, -20.602806565642798]]], [[[164.34553125591725, -20.59933863336631], [164.35076818981767, -20.596296932859325], [164.35270297179153, -20.59754337893864], [164.35342011503369, -20.59552887092354], [164.35748419916612, -20.594968930610058], [164.35720627314836, -20.59354761299055], [164.35993933858975, -20.59431914691525], [164.3601903973465, -20.596150477206326], [164.35400971664336, -20.596243112469207], [164.35351158702375, -20.598452663488303], [164.35528888231428, -20.599780470595917], [164.35408894541703, -20.601268764421963], [164.3471650793254, -20.600504934760984], [164.34379053897408, -20.602695795601537], [164.3460146987085, -20.60063993803776], [164.34553125591725, -20.59933863336631]]], [[[164.3622837020463, -20.58700221778478], [164.36109261284966, -20.586118739336385], [164.3601073786509, -20.58502192104149], [164.36250549985664, -20.586425775208518], [164.3622837020463, -20.58700221778478]]], [[[164.35409490533652, -20.584264900920612], [164.35370745658736, -20.583970863194395], [164.3532475770974, -20.582504711005797], [164.35518420698534, -20.583630405022124], [164.35409490533652, -20.584264900920612]]], [[[164.37075922951288, -20.579646740192032], [164.3710379210919, -20.58073395364524], [164.3707500877541, -20.58133776485803], [164.36958043842444, -20.57871546301848], [164.37075922951288, -20.579646740192032]]], [[[164.36393249846023, -20.578427927879996], [164.36511490433617, -20.5795658826063], [164.3676943601852, -20.580692752263634], [164.36227396714915, -20.578492758143447], [164.36393249846023, -20.578427927879996]]], [[[164.3920096920926, -20.650662808252992], [164.39221431778643, -20.652123091613362], [164.3907795912964, -20.6523963881153], [164.3915911395371, -20.6507930246036], [164.3920096920926, -20.650662808252992]]], [[[164.36996697877143, -20.650107836461252], [164.37066355701248, -20.649531850063642], [164.3718001364822, -20.647359654891115], [164.37099249821068, -20.64965496688089], [164.36908843819305, -20.650536130636603], [164.36996697877143, -20.650107836461252]]], [[[164.37361925178132, -20.645466055939863], [164.37507074447473, -20.643698289463618], [164.3762797047888, -20.643986620839197], [164.37307965140874, -20.64644255209709], [164.37361925178132, -20.645466055939863]]], [[[164.37994290145159, -20.645128699598004], [164.37903122127017, -20.640291212921024], [164.38034292438834, -20.644654253789298], [164.38066852445317, -20.639844675689304], [164.38473387383362, -20.640430755805937], [164.38515250248832, -20.645603145406707], [164.37935682133497, -20.649268471850416], [164.37994290145159, -20.645128699598004]]], [[[164.39497632158628, -20.64935219758138], [164.39706946485998, -20.64586362545856], [164.39377625277598, -20.642849499144443], [164.3915539348655, -20.649807100806157], [164.38964719544592, -20.651434805188735], [164.3853686582117, -20.646133139485485], [164.38688474857946, -20.64719347262614], [164.38668942405357, -20.645240227367044], [164.3878055642016, -20.648458431460597], [164.38933095573725, -20.646430776858303], [164.38593602945357, -20.64175228940438], [164.38947977442365, -20.644589145614013], [164.38708007310538, -20.6379016058936], [164.38796368405593, -20.63723192180477], [164.39017736201623, -20.640561739913128], [164.38836363427563, -20.63723192180477], [164.38918213705088, -20.635827445451802], [164.391414417347, -20.635901854795005], [164.39165220372638, -20.6383367387919], [164.39301421822586, -20.63641341902953], [164.3964461733073, -20.645072882444055], [164.39729275546003, -20.643286982107952], [164.39388852800843, -20.63843177246392], [164.39413965954174, -20.636618044723335], [164.39445589925035, -20.638255050273813], [164.39761829633653, -20.638729409836742], [164.3996738544425, -20.643445101962264], [164.40323813611602, -20.64638622140129], [164.40288459400006, -20.649260478398244], [164.40061628002954, -20.64819262879583], [164.39902441634692, -20.644293623028304], [164.39708807057795, -20.649249866132443], [164.39497632158628, -20.64935219758138]]], [[[164.37421445798978, -20.639573919313378], [164.372270493136, -20.63716489109743], [164.3730890046534, -20.636392885916262], [164.37720946604205, -20.638420562175234], [164.37399122757594, -20.640429635899736], [164.3704753485581, -20.6392111698909], [164.37421445798978, -20.639573919313378]]], [[[164.3769676330939, -20.632588667613856], [164.3778791572837, -20.632067796648247], [164.37852094472348, -20.633342070260543], [164.37693042802493, -20.63282119929493], [164.3769676330939, -20.632588667613856]]], [[[164.37309830592082, -20.626793978121448], [164.3743074706624, -20.626291709690324], [164.37522829611947, -20.62756598330262], [164.37308900465356, -20.627463669362946], [164.37309830592082, -20.626793978121448]]], [[[164.3883031766842, -20.62838186054746], [164.3853571653863, -20.627546296099], [164.39288865245908, -20.631841895006424], [164.38956813551863, -20.63433460800374], [164.38778231128174, -20.63260459077426], [164.3885264047138, -20.634864774574066], [164.38566164500045, -20.63750630625779], [164.38136450543044, -20.63223254405824], [164.38359678572652, -20.629972360258428], [164.38208999652664, -20.62894923178938], [164.3800809442601, -20.630921079384276], [164.38089944703535, -20.63479966639876], [164.37916012863798, -20.631423342450898], [164.37633257359624, -20.630223491791742], [164.3689976281963, -20.63677214005499], [164.37410284278303, -20.630588895156603], [164.37682553549496, -20.629665421717714], [164.3772094660422, -20.626496337569673], [164.37846513712, -20.626524241371403], [164.3772477631461, -20.629918095883752], [164.38098315754647, -20.62848417339436], [164.3826248136811, -20.626107724995833], [164.38000188433315, -20.62231284849246], [164.38120173499232, -20.621996608783846], [164.37977865630353, -20.61850867082118], [164.3836386409823, -20.61849936965328], [164.3844757460933, -20.615150949209113], [164.38571280142406, -20.615541598260933], [164.3862987750018, -20.613337221468527], [164.38672662872523, -20.61534627373502], [164.38675453222893, -20.613569750666038], [164.38805669573497, -20.61428594059437], [164.3889217043497, -20.612872163073504], [164.39154463369763, -20.616453112715174], [164.39036867012877, -20.62215335460198], [164.39788803020576, -20.624498622949055], [164.39643704801327, -20.62504739185518], [164.3972509002044, -20.62647512112788], [164.39586502618724, -20.628335354707968], [164.3883031766842, -20.62838186054746]], [[164.3860150893807, -20.635636771509805], [164.386452244272, -20.634678751216057], [164.38536400762766, -20.633311479534694], [164.38553142864987, -20.63510660493948], [164.3860150893807, -20.635636771509805]], [[164.38469432353878, -20.630539731500356], [164.38444319200545, -20.63172097982371], [164.38533610412395, -20.63239996508045], [164.38559653682515, -20.63200001486073], [164.38469432353878, -20.630539731500356]]], [[[164.37647553013355, -20.620353816518147], [164.37778683673636, -20.619619112818707], [164.37933064450985, -20.621097820264414], [164.37054210025707, -20.625905944474667], [164.3662547786692, -20.623153130613478], [164.36804503768366, -20.618549607433447], [164.36704063262619, -20.61487608893625], [164.36909594297524, -20.613425281631027], [164.37176505641497, -20.613490381958826], [164.37262996077, -20.61514579029427], [164.3750293728517, -20.61334158120957], [164.37866569116161, -20.613285780928603], [164.37775428657244, -20.61544339179278], [164.38088840235358, -20.61274637821256], [164.3815115054911, -20.616763998442405], [164.37844249003774, -20.61644779685024], [164.3761021229145, -20.618231183494725], [164.37273226128514, -20.617052299894084], [164.3724207097164, -20.620456117033257], [164.37647553013355, -20.620353816518147]]], [[[164.39090023058844, -20.608726921998073], [164.39110860598825, -20.607977086166997], [164.39162644359797, -20.607928760325475], [164.39111973221128, -20.60895219805122], [164.39090023058844, -20.608726921998073]]], [[[164.36718378703802, -20.60494552685414], [164.36813236983608, -20.60435963747886], [164.36958314352725, -20.607558779464522], [164.37546993677412, -20.610664923136646], [164.36686759277197, -20.60688919160706], [164.36586942535908, -20.60611252531756], [164.36718378703802, -20.60494552685414]]], [[[164.3908938751132, -20.605630349715014], [164.3905316159604, -20.605564902273336], [164.3901598571138, -20.6052625415004], [164.39122696138034, -20.60493653887707], [164.3908938751132, -20.605630349715014]]], [[[164.3877663250369, -20.60170856252637], [164.38782210249545, -20.6022570408688], [164.38670995303957, -20.604999024579204], [164.38749673398723, -20.601262342857954], [164.3877663250369, -20.60170856252637]]], [[[164.37023878163765, -20.604527034443233], [164.36674204504868, -20.60424803950262], [164.36152483965938, -20.598482144063347], [164.36496577726024, -20.59997941691129], [164.36309651115815, -20.598017152495665], [164.36494717759751, -20.596268784201175], [164.36640725112005, -20.599812019946928], [164.36567256444312, -20.595236502920923], [164.36759762953332, -20.593627632096737], [164.37014578332423, -20.594334419279615], [164.3714756592078, -20.597784656711827], [164.37405171249276, -20.599356328210597], [164.38121258263504, -20.601002398360198], [164.3789527236161, -20.603159959234247], [164.3833701435091, -20.603559851982453], [164.37999430472766, -20.604824629046547], [164.38098008685117, -20.605856910326803], [164.37872952766358, -20.605094324155804], [164.37872022783222, -20.606972890089246], [164.37501889495348, -20.603076260752058], [164.37832031397295, -20.60976162704392], [164.3739494143478, -20.605047824999033], [164.37207084841438, -20.606647395991864], [164.37023878163765, -20.604527034443233]]], [[[164.39428299144444, -20.593016575235364], [164.39778767509011, -20.59491300882613], [164.39670931089145, -20.596446888936306], [164.39065745663856, -20.59714410716821], [164.39116875000863, -20.595080341201786], [164.39587264901317, -20.595600930814935], [164.39199611564382, -20.59407634694785], [164.39428299144444, -20.593016575235364]]], [[[164.3831943915527, -20.593934266410464], [164.38269078171632, -20.595757925383673], [164.38174170330907, -20.59566301782994], [164.38219909505654, -20.594194717830025], [164.3831943915527, -20.593934266410464]]], [[[164.393407807934, -20.590613510811096], [164.39248692612912, -20.591850655054], [164.3918171939074, -20.592064597291493], [164.3938261688647, -20.589195535027837], [164.393407807934, -20.590613510811096]]], [[[164.39584488907417, -20.5903251538823], [164.3958053724661, -20.590144890310082], [164.3960635354612, -20.59026872213967], [164.39596581294754, -20.590306550209473], [164.39584488907417, -20.5903251538823]]], [[[164.37965039187938, -20.586362571570433], [164.37878532109303, -20.589618214314925], [164.3829200249892, -20.591756799638553], [164.37858998252835, -20.589850760225243], [164.37965969371578, -20.584781259380257], [164.38172470139946, -20.58831595721713], [164.37965039187938, -20.586362571570433]]], [[[164.38334322093522, -20.586995096446504], [164.38310137318848, -20.588129920488868], [164.38283161993252, -20.58639047707967], [164.38311827463468, -20.585457921328945], [164.38334322093522, -20.586995096446504]]], [[[164.38423619723085, -20.586568014242616], [164.38442876833543, -20.586923948943358], [164.38423619723085, -20.586660230335646], [164.38423619723085, -20.586568014242616]]], [[[164.37774118995574, -20.583644109878787], [164.3789620794662, -20.583559602097072], [164.37564087320274, -20.585698862791677], [164.3752847263075, -20.583374272671016], [164.37774118995574, -20.583644109878787]]], [[[164.40396288337465, -20.644821705251207], [164.39919051671063, -20.639993521433222], [164.3993858767495, -20.639472561329548], [164.40411172911854, -20.642635533387573], [164.40523737505686, -20.64655203702413], [164.40396288337465, -20.644821705251207]]], [[[164.40179531722904, -20.637593383812725], [164.39666944192322, -20.633965268804996], [164.39634384185842, -20.63255123423788], [164.3974880935147, -20.633630365881206], [164.39879979663291, -20.632504719942908], [164.40336750039904, -20.638998115520845], [164.40515364932594, -20.638132949634386], [164.40652116959808, -20.644644950930317], [164.40179531722904, -20.637593383812725]]], [[[164.40510874738828, -20.635152558809164], [164.4037219658498, -20.63403192428188], [164.40368414299655, -20.633769745646585], [164.40563857284778, -20.635401214100128], [164.40510874738828, -20.635152558809164]]], [[[164.41014481049862, -20.63282785605113], [164.40762399796486, -20.63236684749906], [164.40724959600402, -20.631994201477728], [164.40794078888771, -20.63171707497964], [164.41014481049862, -20.63282785605113]]], [[[164.40500491119747, -20.631344684737126], [164.4038835174874, -20.631534272639], [164.40310892174674, -20.63063098916737], [164.4038727579998, -20.630394571151847], [164.40500491119747, -20.631344684737126]]], [[[164.4037210126723, -20.627806444869716], [164.403856368696, -20.6267874574226], [164.40593230513917, -20.628009759362538], [164.40287982034505, -20.62793926645567], [164.4037210126723, -20.627806444869716]]], [[[164.41254352476275, -20.627493528082667], [164.41051803834063, -20.625716425713996], [164.41320006046072, -20.627518201269403], [164.4106011383359, -20.627860742287627], [164.40924192489805, -20.626737653240966], [164.41254352476275, -20.627493528082667]]], [[[164.40689428288118, -20.62552187142541], [164.40768776625276, -20.626939144820458], [164.40504860804552, -20.6245408952934], [164.4065863762458, -20.624555729826994], [164.40689428288118, -20.62552187142541]]], [[[164.41383778283372, -20.62617916161965], [164.4134854709069, -20.626032907136], [164.41101191610903, -20.624147227132546], [164.41282201009642, -20.62433888455605], [164.41383778283372, -20.62617916161965]]], [[[164.40428192304338, -20.62497759942713], [164.4036551723109, -20.625415700697733], [164.4027972967675, -20.624978010058907], [164.40375197784903, -20.623998028912155], [164.40428192304338, -20.62497759942713]]], [[[164.41226157639161, -20.622197296986858], [164.41600582102708, -20.622347975290836], [164.41878913741036, -20.627054157688406], [164.4116520440282, -20.622349554164806], [164.41226157639161, -20.622197296986858]]], [[[164.40726823122245, -20.622769605645757], [164.40637612362244, -20.622904310911384], [164.40554681283365, -20.620731506421915], [164.40586741404647, -20.620771937336002], [164.40726823122245, -20.622769605645757]]], [[[164.40203779860263, -20.620049742590957], [164.40109877009158, -20.620663089937842], [164.4000678868405, -20.619368825109525], [164.40158703992432, -20.61849212647473], [164.40203779860263, -20.620049742590957]]], [[[164.40441690939556, -20.617858318360543], [164.40365134923655, -20.618527484620166], [164.40306689613257, -20.61805951401854], [164.40467658979566, -20.61736962524746], [164.40441690939556, -20.617858318360543]]], [[[164.39517071068988, -20.614416962830262], [164.397633178895, -20.615069098606007], [164.4018977362477, -20.612875259210135], [164.39762529589842, -20.615615532541153], [164.39763867934397, -20.61710090744028], [164.39585765506237, -20.61722530022931], [164.39716487683475, -20.615542873021116], [164.39517071068988, -20.614416962830262]]], [[[164.40516764619744, -20.614480510711505], [164.4042584219071, -20.615208963302138], [164.4038934983649, -20.615085840326692], [164.40565003910962, -20.613837209409255], [164.40516764619744, -20.614480510711505]]], [[[164.4065927798441, -20.611760229750402], [164.40641122232026, -20.612046246034804], [164.40266969663952, -20.61252829355173], [164.4036326108734, -20.61207258654942], [164.4065927798441, -20.611760229750402]]], [[[164.39532373481066, -20.610675410099706], [164.3947350574183, -20.609768474998706], [164.3964064629505, -20.609465719206852], [164.4012691305122, -20.61012818574058], [164.39550675850106, -20.611163032974996], [164.39361542531512, -20.6135294325158], [164.39243649832272, -20.61127368625412], [164.39532373481066, -20.610675410099706]]], [[[164.40414447962863, -20.609506284197742], [164.40187140052137, -20.610645550182145], [164.40158073407193, -20.61045200722761], [164.4035861668489, -20.609383800752504], [164.40414447962863, -20.609506284197742]]], [[[164.40401124279074, -20.606336162862465], [164.40235263649993, -20.605835623708817], [164.4021486590279, -20.60544801872777], [164.40390132464597, -20.60572789418109], [164.40401124279074, -20.606336162862465]]], [[[164.39572961937824, -20.600667604431447], [164.3977662824447, -20.598435644906566], [164.4025649954232, -20.59854724288281], [164.3993751532689, -20.600314210840008], [164.3986869657487, -20.601774284362534], [164.4000726406204, -20.603122759908814], [164.3950414318581, -20.60554071606077], [164.39671540150175, -20.602471771714058], [164.39572961937824, -20.600667604431447]]], [[[164.39662624333283, -20.59066001999316], [164.39661374461286, -20.59061314979324], [164.39695987053767, -20.590939075085544], [164.39684948740674, -20.590939075085544], [164.39662624333283, -20.59066001999316]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 1.245131610596196, "forest_fragmentation_fragment_size_distribution": {"10": 11.494269914101528, "100": 36.56328187493422, "1000": 100.0, "1100": 100.0, "1200": 100.0, "12000": 100.0, "125": 59.437522045797145, "1300": 100.0, "1400": 100.0, "150": 73.85899800019662, "1500": 100.0, "1600": 100.0, "1700": 100.0, "17000": 100.0, "175": 73.85899800019662, "1800": 100.0, "1900": 100.0, "20": 22.85345331639135, "200": 73.85899800019662, "2000": 100.0, "225": 73.85899800019662, "250": 73.85899800019662, "27000": 100.0, "275": 100.0, "30": 28.00905769907706, "300": 100.0, "325": 100.0, "350": 100.0, "375": 100.0, "40": 28.00905769907706, "400": 100.0, "425": 100.0, "450": 100.0, "475": 100.0, "50": 36.56328187493422, "500": 100.0, "500000": 100.0, "60": 36.56328187493422, "600": 100.0, "70": 36.56328187493422, "700": 100.0, "7000": 100.0, "80": 36.56328187493422, "800": 100.0, "90": 36.56328187493422, "900": 100.0}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 117, "land_use_category_distribution": null, "name": "Mont Kaala", "num_families_unique_taxonomic_count": 57, "num_occurrences_count": 1710, "num_species_unique_taxonomic_count": 196, "rainfall_mean": "1379.680908203125", "rainfall_range": "{\"min\": 915.0, \"max\": 2280.0}", "shape_area": "5637.864774475022", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[164.40934010902566, -20.646399036953408], [164.4032346451406, -20.652138839551892], [164.3921956377257, -20.65260464906564], [164.38530087548727, -20.649718963049935], [164.3790799955929, -20.650453455459747], [164.36882869464182, -20.659671036943944], [164.36299300722305, -20.660605029553846], [164.35768536366487, -20.658138304186107], [164.3434361865462, -20.645072081224523], [164.34067537856683, -20.64012776839376], [164.34098677707618, -20.62406869028049], [164.34447390291814, -20.619544050222387], [164.34069354115002, -20.61489425396792], [164.33849303933826, -20.597001600201814], [164.34025889832498, -20.58843964115067], [164.3423449418147, -20.585913771135857], [164.35994720726612, -20.578765905429215], [164.36894970701775, -20.578559092502594], [164.38205108739402, -20.584452878234092], [164.38540346129938, -20.588725501929353], [164.39376434285955, -20.589165879238745], [164.3999690863755, -20.593101728651508], [164.40346150389593, -20.597615973645475], [164.40394002207597, -20.606052624239577], [164.42314182019842, -20.633241634279145], [164.42149472773653, -20.64122577265068], [164.40934010902566, -20.646399036953408]]]}, \"bbox\": [164.33849303933826, -20.660605029553846, 164.42314182019842, -20.578559092502594]}], \"bbox\": [164.33849303933826, -20.660605029553846, 164.42314182019842, -20.578559092502594]}", "shape_id": 117, "type": "mines"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "mines";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>