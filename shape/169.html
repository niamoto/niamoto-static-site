<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - 64.0</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">64.0</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 6100.264978181081</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 5544.764391553792</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 44</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 71</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 173</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 2674.215576171875</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 2060.0, "max": 3230.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 363.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 831.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [45.0, 145.0, 245.0, 345.0, 445.0, 545.0, 645.0, 745.0], "forest": [320.0489269762495, 856.7976482593346, 1157.954798296014, 1316.8679807876933, 1037.9364506799202, 537.8600022795304, 178.91624042769504, 22.225619928906216], "non_forest": [67.78814078316395, 154.4680585058982, 146.689091530781, 127.79731459121074, 55.56404982226554, 17.780495943124972, 0.0, 0.0]}, "elevation_max": 831.0, "elevation_median": 363.0, "forest_area": "5544.764391553792", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[165.24097193298996, -21.10944303269203], [165.24011786371335, -21.1096209273673], [165.23987903004843, -21.10943623357213], [165.24043164135375, -21.109302386650462], [165.24097193298996, -21.10944303269203]]], [[[165.2359130234269, -21.107821504213344], [165.23622749154168, -21.1079924433168], [165.2352262437246, -21.108050885721124], [165.23549222195192, -21.10779300490492], [165.2359130234269, -21.107821504213344]]], [[[165.1906376335996, -21.106712397671927], [165.19135423307245, -21.107203640937566], [165.19046862453595, -21.10902010635063], [165.18971903844312, -21.107340967974825], [165.1906376335996, -21.106712397671927]]], [[[165.23120741104057, -21.106012582702114], [165.23167594319887, -21.106359296499242], [165.23203178892769, -21.107035730690196], [165.23045375232311, -21.105564131656894], [165.23120741104057, -21.106012582702114]]], [[[165.18974172580346, -21.105379424126546], [165.19023160348922, -21.105959801373434], [165.1896697021888, -21.107200365562964], [165.1891603733748, -21.105940550981643], [165.18974172580346, -21.105379424126546]]], [[[165.2307107669528, -21.10441957336393], [165.22974581619422, -21.104457055936592], [165.2295981882329, -21.104123966603265], [165.23064517245064, -21.1043727201481], [165.2307107669528, -21.10441957336393]]], [[[165.18823592514914, -21.1039428885301], [165.18820385255165, -21.103891021960013], [165.18819978140016, -21.10387933507142], [165.18823426383221, -21.103925202693805], [165.18823592514914, -21.1039428885301]]], [[[165.1879579711233, -21.103007502118455], [165.18804867621958, -21.103079008975804], [165.18797877194552, -21.10324489224361], [165.18787821988505, -21.102883103351857], [165.1879579711233, -21.103007502118455]]], [[[165.19760472354662, -21.08382972986764], [165.19802788156616, -21.083492999120125], [165.19818815209806, -21.0837224513764], [165.19794332766833, -21.083873112563936], [165.19760472354662, -21.08382972986764]]], [[[165.26725343400523, -21.06198246197514], [165.26826304400012, -21.060634673697603], [165.2658169956787, -21.059705092701133], [165.26526888605014, -21.058019111303953], [165.26526576367544, -21.056257168360368], [165.26883763517623, -21.053326303498903], [165.2730416137643, -21.055349813182275], [165.28470391772862, -21.056255283091755], [165.28795657775487, -21.05858357555572], [165.2865728188, -21.061469700000004], [165.29167812310004, -21.0622140616], [165.290384511, -21.060997050900003], [165.29209830578606, -21.060010891515176], [165.2919708371, -21.062007163], [165.2972208453, -21.06153260889999], [165.3010218062, -21.0629652265], [165.30036298870033, -21.060939185922948], [165.30348199006616, -21.061898979518457], [165.3032834761196, -21.060778634457876], [165.31974857971102, -21.059095493142244], [165.3240698326476, -21.05642901030575], [165.33815002929026, -21.05927077807739], [165.3383455337983, -21.055258725070548], [165.34102298768448, -21.052445556387834], [165.34031925680185, -21.042179922190154], [165.34400248810223, -21.038565652508854], [165.35227227142494, -21.044236672375195], [165.35225712323984, -21.043275769008293], [165.3572044881355, -21.040081595576655], [165.3613433144819, -21.040251309513884], [165.36099569328567, -21.041960754261453], [165.36369966228446, -21.04006782289875], [165.36802607343913, -21.04480509249028], [165.36552049369436, -21.050980099916142], [165.3639714602112, -21.049815215685054], [165.36360366603847, -21.051503489837508], [165.3623268907812, -21.050170887658602], [165.36197232096865, -21.051525117969806], [165.35678783725874, -21.05156175691078], [165.35776188073558, -21.052396270463728], [165.354129568, -21.053373198199996], [165.35854654095738, -21.05666990648464], [165.36083001073223, -21.061397148410382], [165.3611577055783, -21.05941535085037], [165.36459773038248, -21.060293324266695], [165.36424119146992, -21.066322287071326], [165.36192540678218, -21.067798846494924], [165.36257978865066, -21.066725043663485], [165.360116204212, -21.066010529360863], [165.36071332940338, -21.06931992575392], [165.35451334412906, -21.071437607887532], [165.3513390703, -21.0687524891], [165.3488998160418, -21.070608772315], [165.3464231451, -21.067514680600002], [165.34799161457903, -21.070573745323298], [165.34625309295228, -21.070076766493113], [165.34390995517762, -21.06740867600337], [165.34368992284263, -21.063689837589294], [165.3413311164272, -21.063402220310586], [165.34206048619856, -21.068278607119286], [165.33562497753746, -21.076799712115356], [165.33247455893795, -21.078377307738187], [165.3312508374, -21.075544662999995], [165.3295796671, -21.076566324600005], [165.3290034793, -21.078632947400003], [165.3320733234432, -21.079985522427883], [165.3310582399914, -21.08371412977975], [165.329291122553, -21.08525625956438], [165.3285176687519, -21.08202542916627], [165.32537616041333, -21.087009081968695], [165.32224955557996, -21.082188819659155], [165.3238940166241, -21.08697649644872], [165.32235189013235, -21.088521016534003], [165.31994193336627, -21.086912147054267], [165.31993284443914, -21.08885297565731], [165.31691733623404, -21.087995402928772], [165.31726056638195, -21.08663783079373], [165.31856028435004, -21.087117615671048], [165.31751861839035, -21.08493942628259], [165.31509157018337, -21.087985482578738], [165.3096104980206, -21.084370014273226], [165.30865924367004, -21.08106172589682], [165.30923560118845, -21.077868797255615], [165.3071159753031, -21.07550712990499], [165.3090396341, -21.0727034451], [165.3071955382, -21.071843133799998], [165.30909158, -21.07195747219999], [165.30917242900003, -21.070408192800002], [165.3063332242, -21.0719839872], [165.3011040359, -21.070545439399996], [165.2983250246, -21.07178309], [165.29936997379866, -21.07324022925239], [165.29731497061897, -21.073281162808236], [165.295154294, -21.069995652899994], [165.2915941800924, -21.069523011470075], [165.28986926528933, -21.07126562111752], [165.29014011967988, -21.068585186376367], [165.28924202354278, -21.069629430965268], [165.28860765404906, -21.06788680214582], [165.2871108271538, -21.069509709027834], [165.2876240249465, -21.06778038140373], [165.2831269309, -21.065677120500002], [165.2859006187, -21.069731781700003], [165.2894191917, -21.071669410499997], [165.2925833627, -21.072072786399993], [165.29290115270004, -21.074374422999995], [165.2950032742508, -21.073522631973542], [165.29522122142802, -21.07521104072739], [165.2936999972792, -21.075460564204295], [165.29465382172265, -21.077847684410273], [165.29260246027474, -21.07970000000143], [165.2929280891728, -21.078329271716907], [165.29120577797912, -21.077636281795485], [165.29116931986454, -21.079792077428955], [165.29033712106076, -21.080037198632347], [165.28976154151937, -21.076778934599325], [165.288499965229, -21.08109977354236], [165.28182192340313, -21.08017625844339], [165.28759989547387, -21.08170022661538], [165.28733874526233, -21.0836991319617], [165.29011029908006, -21.081200116306746], [165.2882334511918, -21.084862843620556], [165.2851213696209, -21.086278615055022], [165.28499350432074, -21.08511106597011], [165.2820876627155, -21.08632448827891], [165.28405186363668, -21.08390000006409], [165.2816998954667, -21.08559977337913], [165.27936709447178, -21.085565811056437], [165.2807, -21.0842], [165.278, -21.082299999999993], [165.2808, -21.0777], [165.2788, -21.078399999999995], [165.2769, -21.0843], [165.27789428679728, -21.085247143398632], [165.2727409344871, -21.084538598269344], [165.2743, -21.082399999999996], [165.2734, -21.0817], [165.2714, -21.084200000000006], [165.2716035889347, -21.090012906025052], [165.26783807245943, -21.093078648989824], [165.26430947929288, -21.093090520707122], [165.2633, -21.090699999999995], [165.2590568837357, -21.0920314564445], [165.25710480343108, -21.090206231443815], [165.26146266060493, -21.08981125080165], [165.2589, -21.089900000000004], [165.25840000000002, -21.0885], [165.2566, -21.090000000000003], [165.2545, -21.089400000000005], [165.2533020623195, -21.09159793768048], [165.25427172453675, -21.092426250643026], [165.25370510875783, -21.091553105016562], [165.25561859810944, -21.090568493990965], [165.25598437001784, -21.090696867045125], [165.25646534981567, -21.09267437284555], [165.25488478423188, -21.092853534672994], [165.256465889494, -21.094413017857], [165.25296200609702, -21.09799952059917], [165.25647776561237, -21.100737727628626], [165.2564066994955, -21.103303349747748], [165.25419741427066, -21.103201239224916], [165.25651033164766, -21.104324094661816], [165.2556545355541, -21.106899204691032], [165.25431828877, -21.105614777207204], [165.25396808659875, -21.10835261613251], [165.25054206280203, -21.108849850406486], [165.24670783980847, -21.104205618112637], [165.24985624662258, -21.108734156268348], [165.24549113705564, -21.10675977725283], [165.24607568098722, -21.109672112935815], [165.24456736446012, -21.11043166700923], [165.2368743943204, -21.10589976976975], [165.23694805308813, -21.107860934459783], [165.2333, -21.107], [165.229321555487, -21.1025128254304], [165.22950551378761, -21.101341023417493], [165.23345846896822, -21.10082652214438], [165.22904613659097, -21.098797424393968], [165.2249197094764, -21.09905019482995], [165.2253226471325, -21.101467820766715], [165.2263043611553, -21.09979529939656], [165.2277300657335, -21.103847964130825], [165.22605840374425, -21.101974780390663], [165.2256131370706, -21.103491879690523], [165.2276663775822, -21.104809391006327], [165.22585216244488, -21.107812673248212], [165.22369990751153, -21.109459488334338], [165.22135080902734, -21.108358131141774], [165.22160081872508, -21.109801637450143], [165.2123962923877, -21.110271119480014], [165.2129719662366, -21.10871401688169], [165.20849735406355, -21.1090670967809], [165.20903458024353, -21.10734397566942], [165.20738556703856, -21.106567302352055], [165.20797483718016, -21.108252246663216], [165.20438397225476, -21.108666577231528], [165.20215055971835, -21.11060111943667], [165.2075512992659, -21.108924382918477], [165.21146527396115, -21.11091760297728], [165.20558204826705, -21.11161288360347], [165.20399086666987, -21.113991472105702], [165.2004244410298, -21.11502518632339], [165.2001768143186, -21.112909294871713], [165.19924435883993, -21.11494716322884], [165.1967188200231, -21.113785054145893], [165.1946624002314, -21.110999378956958], [165.19710596912233, -21.111355147607746], [165.1954394738634, -21.109407782361334], [165.1921739069476, -21.110176673457538], [165.1946244050789, -21.1113555749092], [165.19138562798847, -21.110122876647836], [165.1937, -21.108200000000004], [165.19211771147982, -21.108191100263294], [165.191, -21.103699999999996], [165.1883, -21.101399999999995], [165.1919, -21.102], [165.1918, -21.100600000000004], [165.1902, -21.100999999999996], [165.1883, -21.099090195027536], [165.1915, -21.099100000000007], [165.1898, -21.097499999999997], [165.1929, -21.097999999999992], [165.19100622245443, -21.09639536783506], [165.1961873120595, -21.09496196675315], [165.19734705225687, -21.092744922547162], [165.1959262064955, -21.091024597834835], [165.1987, -21.091200000000004], [165.2001, -21.0899], [165.1996, -21.088499999999993], [165.1978, -21.0907], [165.198, -21.08899999999999], [165.1971, -21.0883], [165.1975, -21.089700000000004], [165.19542953696043, -21.090035231519785], [165.19517239237996, -21.087575868256696], [165.19636910185613, -21.084992265317883], [165.19830114798876, -21.08640610377933], [165.19803749091056, -21.08468291644692], [165.20252907756384, -21.084117936993668], [165.20149328189956, -21.081942766098667], [165.20091888612208, -21.083524708567754], [165.1991203681959, -21.083223386192685], [165.20151117322712, -21.07495037347261], [165.20450000000002, -21.074199999999998], [165.21040000000002, -21.079499999999992], [165.21010727464449, -21.072789782013373], [165.21244054053258, -21.070114004432515], [165.21465415756344, -21.069508315126896], [165.2143, -21.071500000000004], [165.2165, -21.071300000000004], [165.21749444392123, -21.07037696320907], [165.21623927705795, -21.06897510365636], [165.21828907787543, -21.067917034718455], [165.2199603100833, -21.069043284623355], [165.22039562885914, -21.06695905125222], [165.22226880848834, -21.06627494760124], [165.2205168090615, -21.072104029003523], [165.2235, -21.066699999999997], [165.22754069266233, -21.066958403026604], [165.2282, -21.065592373955305], [165.2288, -21.066699999999997], [165.2286820833986, -21.0649910416993], [165.232679406102, -21.06195274058806], [165.2373300115282, -21.061946305877658], [165.240155102222, -21.064099551054227], [165.24655653351968, -21.062626585522544], [165.25165503887126, -21.065115277190902], [165.25275923266958, -21.069521341259758], [165.25812519901, -21.07116896936576], [165.2593167349138, -21.08161807112068], [165.2610024299569, -21.08216162176722], [165.26327983836208, -21.07926497844826], [165.26100931034483, -21.07904480603447], [165.26023579949143, -21.08082525505891], [165.2603141001333, -21.079008270902023], [165.26411723584948, -21.07819178365455], [165.2677, -21.07999999999999], [165.2685, -21.076699999999995], [165.2698, -21.076600000000003], [165.2704, -21.075999999999997], [165.2682, -21.0749], [165.2674564967827, -21.07804350321732], [165.26748312461388, -21.071752097293135], [165.26842831929616, -21.069956638592302], [165.2695, -21.072742167508693], [165.2713, -21.069699999999994], [165.269, -21.069191458238944], [165.2718, -21.068302033900537], [165.27070867943456, -21.0654173588691], [165.27000000000004, -21.066300000000002], [165.2694, -21.066399999999998], [165.2706, -21.0678], [165.26938906307825, -21.06719432815355], [165.26902665831162, -21.066000000000003], [165.2711944801193, -21.064647240059653], [165.2697, -21.063699999999994], [165.2694, -21.0621], [165.26725343400523, -21.06198246197514]], [[165.36240196875445, -21.062109046636586], [165.36188294703888, -21.062328895844942], [165.36174769824117, -21.06328510233704], [165.3630284234883, -21.063220797001776], [165.36240196875445, -21.062109046636586]], [[165.3612344599, -21.062724730099998], [165.3614925384903, -21.062021336090854], [165.36076163209916, -21.06154258838429], [165.3607051575, -21.06185088479999], [165.3612344599, -21.062724730099998]], [[165.3565781829, -21.058084140899997], [165.356365195, -21.058479042], [165.3563663561, -21.058966728299996], [165.357066235, -21.0576958335], [165.3565781829, -21.058084140899997]], [[165.3563468924, -21.0572096552], [165.3564667959, -21.056226854099997], [165.3548759032, -21.058718832400007], [165.355617573, -21.058953953799996], [165.3563468924, -21.0572096552]], [[165.3548457737, -21.055678011699996], [165.3541809636, -21.055629195799998], [165.3542668381, -21.05640358149999], [165.3548164881, -21.056215965099994], [165.3548457737, -21.055678011699996]], [[165.3513531969, -21.052080848299997], [165.3515754964, -21.052395952100003], [165.3520005693, -21.051218880199997], [165.35155796460703, -21.051320125915638], [165.3513531969, -21.052080848299997]], [[165.34675398347727, -21.04455901029555], [165.3458812654, -21.043807271499997], [165.3452644306, -21.044661983099992], [165.34795511139026, -21.045409587738913], [165.34675398347727, -21.04455901029555]], [[165.34328103177228, -21.04296157944937], [165.34271060987624, -21.042681044090667], [165.3428882822701, -21.043129900664592], [165.34463444990232, -21.042776398744397], [165.34328103177228, -21.04296157944937]], [[165.3417989821719, -21.042725006163405], [165.3408270304, -21.041838033199998], [165.3411891117, -21.046520566600005], [165.34284286247296, -21.051278993162178], [165.3417989821719, -21.042725006163405]], [[165.3418488219078, -21.054343792767977], [165.34248098074863, -21.053746987677762], [165.34206818242427, -21.053325220150512], [165.34099976553046, -21.05382216037388], [165.3418488219078, -21.054343792767977]], [[165.33362447239898, -21.072566825831725], [165.33391464380298, -21.072136248909672], [165.3347477165435, -21.072201771484757], [165.33403632858528, -21.071537185365933], [165.33362447239898, -21.072566825831725]], [[165.3253307286, -21.057833087899997], [165.3246800068684, -21.057311022489547], [165.3246290153257, -21.058457987389225], [165.3249271423126, -21.058529607001287], [165.3253307286, -21.057833087899997]], [[165.3104438818, -21.082442549999993], [165.3105279726, -21.081099027399993], [165.3094197825, -21.081014988600003], [165.30941282, -21.0826406412], [165.3104438818, -21.082442549999993]], [[165.195, -21.1011], [165.1961, -21.10159999999999], [165.1963, -21.100899999999996], [165.1953, -21.100799999999996], [165.195, -21.1011]], [[165.1977, -21.0964], [165.1968, -21.097699999999996], [165.1981, -21.098400000000005], [165.19835764593407, -21.098082345813115], [165.1977, -21.0964]], [[165.20353459458977, -21.106028672613235], [165.20403179127175, -21.10557751266106], [165.20142611236432, -21.106424588489627], [165.20244812776616, -21.106581113370996], [165.20353459458977, -21.106028672613235]], [[165.21088205666788, -21.107934593227494], [165.2132, -21.108088920627946], [165.2131, -21.106800000000007], [165.20996609625098, -21.10743387274644], [165.21088205666788, -21.107934593227494]], [[165.21177516922629, -21.095559920253763], [165.21148974150142, -21.095817725940712], [165.2109096787058, -21.09706992499162], [165.212, -21.0964], [165.21177516922629, -21.095559920253763]], [[165.21800059064412, -21.106553909848824], [165.21810061590253, -21.10622202687845], [165.2172167106901, -21.105890562423795], [165.21690020817266, -21.106407324715946], [165.21800059064412, -21.106553909848824]], [[165.2176387197366, -21.095367532065797], [165.2173482297985, -21.095067671484507], [165.21672039670636, -21.095180119202478], [165.21733885915535, -21.095620539431273], [165.2176387197366, -21.095367532065797]], [[165.21985001163543, -21.108210813606377], [165.22050373319877, -21.107023065977188], [165.21825637879664, -21.106911688840515], [165.2189476917311, -21.108781669056057], [165.21985001163543, -21.108210813606377]], [[165.2194659951539, -21.097307255201116], [165.2198501915237, -21.096707534038508], [165.2185851546963, -21.09691368818815], [165.21928795293377, -21.09733536713061], [165.2194659951539, -21.097307255201116]], [[165.2214, -21.103699999999993], [165.2214, -21.103199999999994], [165.2206, -21.103199999999998], [165.221, -21.103799999999996], [165.2214, -21.103699999999993]], [[165.2219, -21.102699999999995], [165.2227, -21.103399999999997], [165.2227, -21.102599999999995], [165.2207, -21.101799999999997], [165.2219, -21.102699999999995]], [[165.222239705531, -21.09764459835508], [165.22266138447347, -21.096698163395327], [165.2211433402806, -21.09720417812629], [165.22203355138134, -21.097644598355085], [165.222239705531, -21.09764459835508]], [[165.2224, -21.0983], [165.22383794913313, -21.10044820346747], [165.2251403036335, -21.09777916693557], [165.2234901476633, -21.097406740740194], [165.2224, -21.0983]], [[165.22482600304468, -21.107165171811506], [165.22497593333534, -21.107858599405766], [165.22600670408357, -21.10558153311648], [165.2240013864461, -21.106771604798542], [165.22482600304468, -21.107165171811506]], [[165.2261191518016, -21.097026135906134], [165.22676572618005, -21.097044877192463], [165.2268313206822, -21.09661382760685], [165.22573495543182, -21.0967075340385], [165.22614726373112, -21.097541521280256], [165.2261191518016, -21.097026135906134]], [[165.22803076300744, -21.096707534038508], [165.2272998528405, -21.096576345034187], [165.22708432804768, -21.09718543683996], [165.22805887493692, -21.097129212980967], [165.22803076300744, -21.096707534038508]], [[165.22854614838155, -21.095433126567958], [165.2282556584434, -21.09577046972193], [165.22745915377433, -21.09567676329027], [165.22865859609954, -21.096098442232726], [165.22854614838155, -21.095433126567958]], [[165.2318, -21.097300000000004], [165.22998922742912, -21.09830054337668], [165.234, -21.099100000000004], [165.2341, -21.0983], [165.2318, -21.097300000000004]], [[165.20182202824074, -21.07785419396768], [165.20179440620285, -21.077347789939726], [165.201011781796, -21.07759638828072], [165.20171154008918, -21.078019926194994], [165.20182202824074, -21.07785419396768]], [[165.20369670176723, -21.08322338619269], [165.20419576695093, -21.083477626946664], [165.20424284857205, -21.082733737333218], [165.20396035884542, -21.082696072036338], [165.20369670176723, -21.08322338619269]], [[165.20440929245623, -21.076730897760225], [165.2051550874792, -21.077771327854006], [165.20591008984812, -21.0775503515509], [165.2050538066736, -21.076114005580745], [165.20440929245623, -21.076730897760225]], [[165.35704307538145, -21.042159481944637], [165.3551005656272, -21.04183832033193], [165.35367605847406, -21.04368240959198], [165.3582448414161, -21.042154301918625], [165.35704307538145, -21.042159481944637]], [[165.2309548298914, -21.078109897241475], [165.23144158707916, -21.07679190854847], [165.2308425013096, -21.076087982769245], [165.2298689869341, -21.078619120145596], [165.2309548298914, -21.078109897241475]], [[165.235, -21.0931], [165.2347, -21.0932], [165.235, -21.094600000000007], [165.2356, -21.0926], [165.235, -21.0931]], [[165.24560190371488, -21.10419492352087], [165.24532435435532, -21.103519360907924], [165.244647327094, -21.103994262401436], [165.24515606533643, -21.10463207701493], [165.24560190371488, -21.10419492352087]], [[165.24757792465124, -21.106780975441698], [165.24669875305094, -21.105909049468757], [165.2460357035532, -21.10589056242379], [165.24721246956773, -21.107483773679128], [165.24757792465124, -21.106780975441698]], [[165.2508, -21.107299999999995], [165.2509, -21.106867314603196], [165.2501724563972, -21.10658163759811], [165.2505, -21.10729999999999], [165.2508, -21.107299999999995]], [[165.2501382159859, -21.09762796926876], [165.2487, -21.097800000000003], [165.24998959545374, -21.09824102896393], [165.25231179126882, -21.097897343983306], [165.2501382159859, -21.09762796926876]], [[165.25304128047586, -21.105222232953064], [165.25402803497883, -21.10571561896043], [165.25414255427987, -21.105643728310678], [165.25401942832548, -21.105149051388643], [165.25304128047586, -21.105222232953064]], [[165.25321280324505, -21.096606203110134], [165.2541602591376, -21.09627180691276], [165.2512621587604, -21.09575163505019], [165.25234894640187, -21.096373983528622], [165.25321280324505, -21.096606203110134]], [[165.25464327586715, -21.102458136564085], [165.25470829734996, -21.101956542268038], [165.25318493689528, -21.101900809568477], [165.25349146674287, -21.10234667116497], [165.25464327586715, -21.102458136564085]], [[165.2363, -21.072199999999995], [165.2377, -21.072099999999995], [165.238, -21.071400000000008], [165.237, -21.0713], [165.2363, -21.072199999999995]], [[165.23936872859255, -21.066572432838885], [165.24366289386364, -21.067434785700705], [165.24088224586023, -21.06644923957291], [165.24082944874624, -21.06488292519123], [165.24558998852424, -21.0665372347629], [165.242061381406, -21.063694990126482], [165.23799600362887, -21.06594766699002], [165.23936872859255, -21.066572432838885]], [[165.2514185671633, -21.089909977003256], [165.2523332197768, -21.09010799457938], [165.2570290651532, -21.087552624906674], [165.25040962046597, -21.08944793599234], [165.2514185671633, -21.089909977003256]], [[165.25452462012623, -21.079364691155696], [165.25492721145855, -21.08014178605293], [165.25546087903857, -21.079739194720634], [165.2552736272561, -21.079411504101316], [165.25452462012623, -21.079364691155696]], [[165.2667276705459, -21.058608494181176], [165.266892274, -21.057121641100004], [165.2678696115, -21.055675504999996], [165.265373684, -21.057042090899998], [165.2667276705459, -21.058608494181176]], [[165.26705849249805, -21.05943928874585], [165.26687126461363, -21.05981374451472], [165.26740486408426, -21.06000097239916], [165.26748911663225, -21.05926142225563], [165.26705849249805, -21.05943928874585]], [[165.2692, -21.074300000000004], [165.26920257385336, -21.073394852293315], [165.26885642337965, -21.073330729861027], [165.2685, -21.074499999999997], [165.2692, -21.074300000000004]], [[165.2703, -21.080699999999997], [165.2716, -21.0793], [165.27000000000004, -21.078299999999995], [165.2684, -21.080599999999997], [165.2703, -21.080699999999997]], [[165.2698, -21.084], [165.27268804302528, -21.08169129455282], [165.27160627387366, -21.080096273466907], [165.2696, -21.081899999999997], [165.2698, -21.084]], [[165.272, -21.0751], [165.2712, -21.0751], [165.2706, -21.0748], [165.2711, -21.0756], [165.272, -21.0751]], [[165.2711, -21.0639], [165.27070000000003, -21.062999999999995], [165.2702, -21.0633], [165.2713, -21.064500000000002], [165.2711, -21.0639]], [[165.271127995, -21.061909920899996], [165.2734687951, -21.05925972449999], [165.2733601533, -21.058341891599998], [165.2703268533, -21.0582965422], [165.2729182306, -21.0590095922], [165.271127995, -21.061909920899996]], [[165.27400816809165, -21.077534304982112], [165.27398008032426, -21.077159801417185], [165.2729408329316, -21.077609205695104], [165.27440139683483, -21.0780960603295], [165.27400816809165, -21.077534304982112]], [[165.2739, -21.074199999999994], [165.2755, -21.073899999999995], [165.2755, -21.0731], [165.273, -21.073499999999992], [165.27291119780847, -21.070611197808486], [165.2727, -21.074499999999993], [165.2739, -21.074199999999994]], [[165.2749179657, -21.067992268899996], [165.2752361994, -21.0683666615], [165.2776603914, -21.068095226800004], [165.2767337698, -21.0671592454], [165.2749179657, -21.067992268899996]], [[165.27695840530004, -21.07000462899999], [165.2765278538, -21.070510059000007], [165.27714213589158, -21.070747378630532], [165.2774638353, -21.070032708500005], [165.27695840530004, -21.07000462899999]], [[165.2771809818, -21.061789882199996], [165.2747740665, -21.061707729899993], [165.2763419573, -21.062565817899994], [165.2751151401, -21.064367964299997], [165.2771809818, -21.061789882199996]], [[165.27845738000002, -21.057914950899992], [165.2779528272, -21.05775799459999], [165.27702875, -21.057974662199996], [165.2777627382, -21.058253168999997], [165.27845738000002, -21.057914950899992]], [[165.2827, -21.07789999999999], [165.2818, -21.077699999999997], [165.2813, -21.078500000000005], [165.2824, -21.078299999999995], [165.2827, -21.07789999999999]], [[165.2813433411, -21.064674317000005], [165.2827706643, -21.064664957599998], [165.2828689391, -21.063831962299997], [165.2812637853, -21.064426290399997], [165.2813433411, -21.064674317000005]], [[165.2853629918, -21.057265188900008], [165.2849559962, -21.056851393399995], [165.2838356736, -21.057655032000003], [165.2851277967, -21.0581333875], [165.2853629918, -21.057265188900008]]], [[[165.25920407291525, -21.07533071237253], [165.2592018259572, -21.075352488095596], [165.2591176629263, -21.075753019973018], [165.2588501363012, -21.075474535375005], [165.25920407291525, -21.07533071237253]]], [[[165.20961879774325, -21.0756], [165.2095, -21.0756], [165.2095, -21.0754634720884], [165.20961879774325, -21.0756]]], [[[165.25917782692048, -21.07501576850796], [165.25914973915312, -21.07492214261674], [165.25922828392729, -21.074798634975995], [165.25921941215, -21.075046957430107], [165.25917782692048, -21.07501576850796]]], [[[165.25855989603835, -21.073817357100197], [165.25918187866202, -21.07351150491461], [165.25922784202993, -21.074543694703127], [165.25868160969696, -21.07428548655636], [165.25855989603835, -21.073817357100197]]], [[[165.2685, -21.06987088455209], [165.2685, -21.0699], [165.26847566277002, -21.0699], [165.2685, -21.06987088455209]]], [[[165.2895354776, -21.0605108093], [165.2888711759, -21.060727098199997], [165.2884424959, -21.060304683], [165.28929829955533, -21.05993482318931], [165.2895354776, -21.0605108093]]], [[[165.2880674668, -21.059968238800003], [165.2883494707, -21.059609163900003], [165.28833923698843, -21.059274919082995], [165.2884915637331, -21.059618362416682], [165.2880674668, -21.059968238800003]]], [[[165.2660346234255, -21.054772696585946], [165.2659990059255, -21.055367270115077], [165.26542556799933, -21.055496405212246], [165.26572200281748, -21.054765013364637], [165.2661506718409, -21.054671602014643], [165.2663492533537, -21.05482163902211], [165.2660346234255, -21.054772696585946]]], [[[165.28004012020673, -21.054268817570247], [165.2809684362221, -21.05499984868943], [165.2751033290636, -21.054310781713546], [165.27670512078654, -21.053170853538422], [165.28052669054193, -21.053375415477014], [165.28004012020673, -21.054268817570247]]], [[[165.32043478483035, -21.088030402866938], [165.32087715783064, -21.08822113612566], [165.32085811616315, -21.08882589355091], [165.320343724136, -21.088855164285018], [165.32043478483035, -21.088030402866938]]], [[[165.29224204218193, -21.07984013010293], [165.29227594927872, -21.079864191175524], [165.29206034563703, -21.079948444975592], [165.29215929494922, -21.079862683817566], [165.29224204218193, -21.07984013010293]]], [[[165.35617369781545, -21.07132035441701], [165.35614797442577, -21.07144736649538], [165.35596401433236, -21.071456235879438], [165.35604418446832, -21.071306334877328], [165.35617369781545, -21.07132035441701]]], [[[165.3566092098487, -21.071219127063905], [165.35670059456902, -21.071375107081032], [165.35630357361404, -21.071439864493538], [165.3566092098487, -21.071219127063905]]], [[[165.3510442431, -21.07010141370001], [165.3514492429, -21.070114919599998], [165.35178825909628, -21.070602811693128], [165.3511335958536, -21.070604162663173], [165.3510442431, -21.07010141370001]]], [[[165.3032051472, -21.0609603046], [165.3030449158, -21.061068169400002], [165.30296790196687, -21.060793751448337], [165.30326420400988, -21.060779557652303], [165.3032051472, -21.0609603046]]], [[[165.30222698328572, -21.060969008316388], [165.30224874343548, -21.0609094489098], [165.30243196462092, -21.060874899717316], [165.30239501388934, -21.060912011861674], [165.30222698328572, -21.060969008316388]]], [[[165.29979006639522, -21.060819312230727], [165.2992245067, -21.060981707699995], [165.29915142007624, -21.060783959139332], [165.29917961209307, -21.060783909597333], [165.29979006639522, -21.060819312230727]]], [[[165.2974908995991, -21.060836502611952], [165.29766160481554, -21.060710826519696], [165.29800952296463, -21.060785965801852], [165.2977600023048, -21.061000954265438], [165.2974908995991, -21.060836502611952]]], [[[165.2944485518, -21.0606458019], [165.2937244283, -21.061522030399995], [165.2929665753, -21.0607846311], [165.2937861632898, -21.060018178716195], [165.2944485518, -21.0606458019]]], [[[165.3624190747416, -21.058764757519608], [165.36122902572717, -21.058876902527288], [165.3608099412797, -21.058502814181022], [165.36095153174105, -21.0581902833576], [165.3624190747416, -21.058764757519608]]], [[[165.36030683551368, -21.05850726964646], [165.36003139543323, -21.058023669783303], [165.36025878960734, -21.057736188526356], [165.36066184884814, -21.058164784268016], [165.36030683551368, -21.05850726964646]]], [[[165.35896848303702, -21.052226638635247], [165.35954294322417, -21.051934772328224], [165.35978282561794, -21.05193772232348], [165.35911547178725, -21.05219886943624], [165.35896848303702, -21.052226638635247]]], [[[165.3673735030948, -21.0491612868566], [165.36742576478235, -21.049071655052117], [165.36751814868876, -21.04906064833896], [165.36741096243367, -21.049235068147222], [165.3673735030948, -21.0491612868566]]], [[[165.3513450467689, -21.042599784155602], [165.3509229639597, -21.04231777044055], [165.3506379732183, -21.041416148212004], [165.35120958333897, -21.041331179140016], [165.35222689574135, -21.043236473260254], [165.3513450467689, -21.042599784155602]]], [[[165.3495201018895, -21.039973164168842], [165.3498449039988, -21.04017174786044], [165.34981129074532, -21.040262356531947], [165.3495683797618, -21.040150183917977], [165.3495201018895, -21.039973164168842]]], [[[165.3488777701286, -21.040149158161046], [165.34835212217985, -21.04003793157595], [165.34824733944993, -21.03934049583448], [165.3489601649626, -21.039672883521376], [165.3488777701286, -21.040149158161046]]], [[[165.3472737664439, -21.039524111241235], [165.3471450262875, -21.040393304542462], [165.34594327522274, -21.03853763161635], [165.34709368855223, -21.038823657584263], [165.3472737664439, -21.039524111241235]]], [[[165.34517769310216, -21.038472521621934], [165.34479671225395, -21.038671810998668], [165.34459463371437, -21.038496294887405], [165.34494589241942, -21.038456193469603], [165.34517769310216, -21.038472521621934]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 55.420620987162714, "forest_fragmentation_fragment_size_distribution": {"10": 0.02437243591082759, "100": 0.02437243591082759, "1000": 0.02437243591082759, "1100": 0.02437243591082759, "1200": 0.02437243591082759, "12000": 100.0, "125": 0.02437243591082759, "1300": 0.02437243591082759, "1400": 0.02437243591082759, "150": 0.02437243591082759, "1500": 0.02437243591082759, "1600": 0.02437243591082759, "1700": 0.02437243591082759, "17000": 100.0, "175": 0.02437243591082759, "1800": 0.02437243591082759, "1900": 0.02437243591082759, "20": 0.02437243591082759, "200": 0.02437243591082759, "2000": 0.02437243591082759, "225": 0.02437243591082759, "250": 0.02437243591082759, "27000": 100.0, "275": 0.02437243591082759, "30": 0.02437243591082759, "300": 0.02437243591082759, "325": 0.02437243591082759, "350": 0.02437243591082759, "375": 0.02437243591082759, "40": 0.02437243591082759, "400": 0.02437243591082759, "425": 0.02437243591082759, "450": 0.02437243591082759, "475": 0.02437243591082759, "50": 0.02437243591082759, "500": 0.02437243591082759, "500000": 100.0, "60": 0.02437243591082759, "600": 0.02437243591082759, "70": 0.02437243591082759, "700": 0.02437243591082759, "7000": 100.0, "80": 0.02437243591082759, "800": 0.02437243591082759, "90": 0.02437243591082759, "900": 0.02437243591082759}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 169, "land_use_category_distribution": null, "name": "64.0", "num_families_unique_taxonomic_count": 44, "num_occurrences_count": 173, "num_species_unique_taxonomic_count": 71, "rainfall_mean": "2674.215576171875", "rainfall_range": "{\"min\": 2060.0, \"max\": 3230.0}", "shape_area": "6100.264978181081", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[165.18893041309477, -21.105055158903454], [165.18778374137344, -21.102050629586863], [165.18861963142115, -21.098508609619696], [165.19293706180414, -21.095051206049117], [165.1961873120595, -21.09496196675315], [165.19734705225687, -21.092744922547162], [165.19517658029324, -21.087535454706106], [165.19984480954082, -21.082716489874475], [165.20084479957472, -21.07557740277172], [165.20584560836772, -21.07391570816738], [165.20980740439902, -21.07581675557229], [165.21046721185624, -21.071971114803397], [165.21244054053258, -21.070114004432515], [165.22262925121709, -21.066192808376805], [165.22754069266233, -21.066958403026604], [165.232679406102, -21.06195274058806], [165.2373300115282, -21.061946305877658], [165.240155102222, -21.064099551054227], [165.2441373263468, -21.06260434604288], [165.2502014932509, -21.0639991534112], [165.2521804708851, -21.06585087654456], [165.25275923266958, -21.069521341259758], [165.25865068421405, -21.07190454763315], [165.25923733237735, -21.08001798417747], [165.2631026911721, -21.078167625171485], [165.2684032203231, -21.079453238493763], [165.26727449301913, -21.07257873148042], [165.2698174830961, -21.067872565154385], [165.26523920545696, -21.056740436297773], [165.26865129994286, -21.05237144078062], [165.28076770985285, -21.053452753685196], [165.2885740543269, -21.05993605947715], [165.30590079988076, -21.060851575801], [165.31974857971102, -21.059095493142244], [165.32454151444762, -21.056406355708006], [165.33815002929026, -21.05927077807739], [165.3383455337983, -21.055258725070548], [165.34102298768448, -21.052445556387834], [165.34031925680185, -21.042179922190154], [165.3431171918398, -21.038838235397478], [165.3474997441685, -21.038940431368903], [165.3522416105071, -21.043285546416154], [165.3572044881355, -21.040081595576655], [165.36369966228446, -21.04006782289875], [165.3678398959854, -21.04393688248468], [165.36785061723944, -21.04830221802616], [165.36630371464412, -21.050486383803694], [165.35600208810908, -21.0524039331617], [165.35685211813794, -21.05634568732261], [165.36459773038248, -21.060293324266695], [165.36424119146992, -21.066322287071326], [165.35818643025138, -21.070918205951493], [165.35451334412906, -21.071437607887532], [165.34625309295228, -21.070076766493113], [165.34390995517762, -21.06740867600337], [165.34368992284263, -21.063689837589294], [165.3413311164272, -21.063402220310586], [165.34170128142765, -21.069097545335126], [165.33493805999512, -21.077430724693876], [165.33140339993201, -21.078386644971932], [165.3310582399914, -21.08371412977975], [165.32235189013235, -21.088521016534003], [165.31393970447155, -21.087802427734175], [165.3102111401717, -21.085021007683206], [165.30872455267007, -21.081957118309607], [165.30923560118845, -21.077868797255615], [165.30680017787918, -21.072949069279094], [165.29731497061897, -21.073281162808236], [165.29375450324906, -21.071528033949395], [165.29519219861814, -21.074397976840352], [165.29465382172265, -21.077847684410273], [165.29081667463456, -21.080225792409564], [165.2866297292666, -21.085938175678912], [165.27517386119345, -21.085443909842486], [165.27206100324787, -21.083949486750036], [165.2716035889347, -21.090012906025052], [165.26691281990477, -21.093252885434445], [165.25572339363734, -21.09069726135062], [165.256465889494, -21.094413017857], [165.25469200135257, -21.097491654982093], [165.25642365272657, -21.100191206385002], [165.25648373840258, -21.10480735887872], [165.25309671144464, -21.108692835364245], [165.24795216241043, -21.107815906168337], [165.2454725972513, -21.110067551563922], [165.24165392951596, -21.110418263255458], [165.23201598012488, -21.107025849800095], [165.2295353552021, -21.10398219798332], [165.23020011464214, -21.099892118786766], [165.22623370099112, -21.100267338785102], [165.22767001050516, -21.10479707921531], [165.22452756721506, -21.109046211131357], [165.21674391269593, -21.11067411524891], [165.21292433854845, -21.10971122843441], [165.19957510494547, -21.115004434841964], [165.19107520453107, -21.109850764632615], [165.18893041309477, -21.105055158903454]]]}, \"bbox\": [165.18778374137344, -21.115004434841964, 165.36785061723944, -21.038838235397478]}], \"bbox\": [165.18778374137344, -21.115004434841964, 165.36785061723944, -21.038838235397478]}", "shape_id": 169, "type": "hotspots"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "hotspots";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>