<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - Montagne des sources</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">Montagne des sources</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 5693.702557400756</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 2234.353663876026</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 81</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 438</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 3823</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 2609.166748046875</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 1630.0, "max": 3840.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 492.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 1122.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [105.0, 205.0, 305.0, 405.0, 505.0, 605.0, 705.0, 805.0, 905.0, 1005.0, 1105.0], "forest": [76.67838875472644, 252.26078619308555, 401.1724397167572, 390.0596297523041, 338.94070391581977, 245.59310021441368, 211.14338932460905, 148.91165352367165, 118.90706661964825, 40.00611587203119, 2.2225619928906215], "non_forest": [236.70285224285118, 453.4026465496868, 570.0871511764444, 568.9758701799991, 488.96363843593673, 518.9682253399601, 367.8340098233979, 168.91471145968723, 82.234793736953, 11.112809964453108, 0.0]}, "elevation_max": 1122.0, "elevation_median": 492.0, "forest_area": "2234.353663876026", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[166.5192640438519, -22.167496976873913], [166.51953986660902, -22.167458932355693], [166.52024449045211, -22.168137099407524], [166.51926313011856, -22.168529777556248], [166.5192640438519, -22.167496976873913]]], [[[166.52149456414023, -22.167924617908945], [166.5216165920391, -22.167916482715686], [166.5214432508022, -22.167944353808178], [166.52149456414023, -22.167924617908945]]], [[[166.51794690033478, -22.167152798860155], [166.5182892006848, -22.166536658230136], [166.51861221443963, -22.166450752622783], [166.51803057375366, -22.16755595260572], [166.51794690033478, -22.167152798860155]]], [[[166.5399463732553, -22.164631895613987], [166.54054045519004, -22.164339515031994], [166.5410416194761, -22.164604796426584], [166.5393495127205, -22.16501348043776], [166.5399463732553, -22.164631895613987]]], [[[166.53863821475684, -22.164719727043657], [166.5387278421531, -22.164817408900433], [166.53816410784583, -22.164639610146438], [166.53828261346254, -22.164515692036797], [166.53863821475684, -22.164719727043657]]], [[[166.5410482449619, -22.164604276264487], [166.54105552272338, -22.164607580150324], [166.54104488845155, -22.16460453978169], [166.5410482449619, -22.164604276264487]]], [[[166.53713974867486, -22.164170881585473], [166.53795487097722, -22.164386871620625], [166.53803037351724, -22.16453527825718], [166.53652318667878, -22.16461259396751], [166.53713974867486, -22.164170881585473]]], [[[166.538726303796, -22.161681393158634], [166.53893170144983, -22.162677952145643], [166.53807968155252, -22.162883349799454], [166.53843722561658, -22.160532687761393], [166.538726303796, -22.161681393158634]]], [[[166.538048967687, -22.16049846248575], [166.5370297039459, -22.1611374039354], [166.53584309839655, -22.161160223272887], [166.5384250236055, -22.16007565535171], [166.538048967687, -22.16049846248575]]], [[[166.5410730639231, -22.160715541500707], [166.54025510678133, -22.1603731408367], [166.54002683967198, -22.15993562887714], [166.54060701857503, -22.15972638402692], [166.5410730639231, -22.160715541500707]]], [[[166.51539486105858, -22.1592418574377], [166.5143223199619, -22.15864093015657], [166.5167260290864, -22.15918100404214], [166.51526936943858, -22.15966931724958], [166.51539486105858, -22.1592418574377]]], [[[166.5286362132932, -22.154337710027743], [166.5291543596139, -22.157218413425856], [166.53030473951875, -22.153653186447997], [166.53071355221223, -22.156686006197162], [166.5335402493151, -22.15765295778378], [166.53314193922043, -22.163454868871604], [166.53145731194232, -22.16218025545228], [166.53202797971565, -22.15926033867868], [166.5306393548005, -22.15755784648821], [166.52715828138312, -22.159184249642234], [166.5277860159338, -22.16339768003541], [166.52551285596996, -22.164034925715637], [166.52383889716816, -22.16265581193006], [166.52245978338257, -22.1667265753799], [166.52098555830142, -22.1653094170761], [166.51905479900162, -22.16604177405189], [166.51983471162518, -22.164253681695417], [166.51623950465316, -22.166431730363673], [166.51417558953958, -22.165433061760325], [166.52576965646807, -22.155408331208626], [166.52223306564088, -22.155155335414666], [166.52695817979557, -22.15390037551846], [166.52874664001905, -22.15126147872235], [166.5286362132932, -22.154337710027743]], [[166.52293533986037, -22.16469119365498], [166.52251685015992, -22.16364496940385], [166.52202227142303, -22.163369146646737], [166.52229809418014, -22.164244170565862], [166.52293533986037, -22.16469119365498]]], [[[166.53322347200464, -22.15445179729104], [166.53527704274387, -22.15485110271256], [166.53524274150558, -22.156673311439544], [166.53265571426644, -22.155589042670194], [166.53322347200464, -22.15445179729104]]], [[[166.52107317846412, -22.154470811834916], [166.51757681445386, -22.15658131696684], [166.51648679402172, -22.155684153965744], [166.51890262092886, -22.155636598317965], [166.51750448488417, -22.154000684034383], [166.52107317846412, -22.154470811834916]]], [[[166.53792488004032, -22.15489473021262], [166.53812922432616, -22.152531328358965], [166.54201466574926, -22.150966633706116], [166.53956482238925, -22.15419510094863], [166.53792488004032, -22.15489473021262]]], [[[166.52718681477185, -22.148617384705855], [166.52708219234674, -22.14951143088409], [166.5256460117838, -22.149368763940753], [166.5262547240754, -22.148702984871854], [166.52718681477185, -22.148617384705855]]], [[[166.5308276394755, -22.144221972682566], [166.53303615944873, -22.1470004926814], [166.53273180330297, -22.149520942013663], [166.5300575504483, -22.147349865151153], [166.52996406460224, -22.150395965932788], [166.528642017594, -22.14970165347522], [166.53037304317314, -22.145716490191383], [166.52838521709603, -22.142416128235546], [166.52828435483497, -22.141182612235767], [166.5308276394755, -22.144221972682566]]], [[[166.53863310973904, -22.143718087269704], [166.53971297239687, -22.143177018600003], [166.53839092538863, -22.141141636875084], [166.54089235246178, -22.143814264280238], [166.53863310973904, -22.143718087269704]]], [[[166.53536253087043, -22.141221526943983], [166.53514964464432, -22.14262049357271], [166.53394602467228, -22.1413983129161], [166.53474668143062, -22.140917403763826], [166.53536253087043, -22.141221526943983]]], [[[166.5423374787849, -22.139328938612017], [166.54360749078663, -22.14027194153545], [166.54295347263005, -22.14184614802859], [166.54215496209005, -22.140865120793734], [166.5423374787849, -22.139328938612017]]], [[[166.53544247522635, -22.13946767807328], [166.53499791819596, -22.139840881159362], [166.5346252803864, -22.138722967730686], [166.5354139418377, -22.138992121595496], [166.53544247522635, -22.13946767807328]]], [[[166.53065650858073, -22.138812334948167], [166.53098926309866, -22.137890129569897], [166.5314646266957, -22.137804564122426], [166.5308086249318, -22.139487351255976], [166.53065650858073, -22.138812334948167]]], [[[166.54265426728153, -22.13658753007066], [166.54436539346767, -22.13666358012338], [166.54221344536322, -22.13703571415251], [166.54225560323522, -22.13841008171481], [166.5406544918361, -22.137195411830895], [166.54265426728153, -22.13658753007066]]], [[[166.5333375592681, -22.136682706033394], [166.531943517358, -22.137669681821862], [166.52982937592188, -22.136207342436347], [166.53278613749552, -22.13625487879605], [166.5333375592681, -22.136682706033394]]], [[[166.53234880298623, -22.134496033486972], [166.53395553194426, -22.13547528249689], [166.53414567738307, -22.13575099338318], [166.53233929571428, -22.135532326128537], [166.53234880298623, -22.134496033486972]]], [[[166.53965029019898, -22.134648253726333], [166.54122879267914, -22.135488195039628], [166.5375864796144, -22.13473539964629], [166.5385950957175, -22.13441059731159], [166.53965029019898, -22.134648253726333]]], [[[166.5347730018817, -22.132781173221158], [166.53413617011114, -22.13145370646587], [166.53482622983879, -22.130788926826668], [166.53551373897014, -22.13233463737127], [166.5347730018817, -22.132781173221158]]], [[[166.56161954973848, -22.17088671534979], [166.56106442657133, -22.17071941795695], [166.56080587605513, -22.169903696565306], [166.5617145928415, -22.170697471969408], [166.56161954973848, -22.17088671534979]]], [[[166.56231803808035, -22.16546773405445], [166.56348202608243, -22.16497322934768], [166.56502922149164, -22.16694057579491], [166.56343135172628, -22.166113107523564], [166.56335526268984, -22.167596843734252], [166.56231803808035, -22.16546773405445]]], [[[166.5697931935257, -22.163673851073725], [166.57050617983575, -22.16639694782806], [166.56817086855773, -22.167636868799768], [166.56956292707198, -22.166237203408393], [166.5697931935257, -22.163673851073725]]], [[[166.55389313637562, -22.16152917290702], [166.55677593881964, -22.165047861013317], [166.5548546906494, -22.165228572474874], [166.55491175742674, -22.163440480118403], [166.5533834648346, -22.16316468606104], [166.5531476466589, -22.168040797371404], [166.55124549889814, -22.17030552325864], [166.55172084103592, -22.167143568331596], [166.54961798106137, -22.16755394694416], [166.54702803086306, -22.16508092732099], [166.55072177913377, -22.16670449131882], [166.54895779032486, -22.163897014337078], [166.55133557271378, -22.16475301599709], [166.5533834648346, -22.162731084899278], [166.5497412022151, -22.162236803164678], [166.55239454990425, -22.162000809258412], [166.5516865941141, -22.16046039315769], [166.5538706977655, -22.159685968071084], [166.55389313637562, -22.16152917290702]]], [[[166.56573834204286, -22.16116393128131], [166.56789916882917, -22.16366554075254], [166.5663893130181, -22.163278790915964], [166.56612300139057, -22.16472448260843], [166.56429686451585, -22.159997451219247], [166.56573834204286, -22.16116393128131]]], [[[166.56316043214014, -22.16278608857747], [166.56316804001509, -22.161812280582378], [166.56396686688606, -22.16131776870987], [166.56339606591382, -22.16312886365101], [166.56316043214014, -22.16278608857747]]], [[[166.55235398250352, -22.158970854758657], [166.55219998679894, -22.15931952052477], [166.55121823798052, -22.15948632056039], [166.55141088322782, -22.15892972237519], [166.55235398250352, -22.158970854758657]]], [[[166.54838712255153, -22.15804766966032], [166.54709360893196, -22.159892828794128], [166.54620907388326, -22.159255583113897], [166.54789254381464, -22.157866958198763], [166.54838712255153, -22.15804766966032]]], [[[166.56150384380544, -22.15887003492799], [166.5609618518957, -22.15975433751753], [166.56266389666482, -22.156454842909252], [166.56273707328322, -22.157150668874856], [166.56150384380544, -22.15887003492799]]], [[[166.56948158437126, -22.154952479370035], [166.57148721382836, -22.157423296283184], [166.5712287915888, -22.161087873105785], [166.57088827129627, -22.15809829500983], [166.56902878236292, -22.15727799960594], [166.56948158437126, -22.154952479370035]], [[166.57028030929084, -22.156445334279255], [166.56971930012114, -22.156645015509152], [166.569985541761, -22.157329636868795], [166.5703373610708, -22.15715848152888], [166.57028030929084, -22.156445334279255]]], [[[166.54352460115265, -22.16105935128999], [166.54199393037018, -22.16088822039505], [166.5446076700743, -22.158471175964845], [166.54240522643687, -22.159505334609026], [166.5424930621471, -22.158131111532178], [166.54806432350446, -22.152788024701362], [166.54778861261818, -22.155107799054953], [166.54502199648337, -22.156695513469092], [166.5446369519699, -22.159224447805364], [166.54625662953106, -22.16150020968904], [166.54472251741737, -22.16188648394883], [166.54450385016273, -22.16028926226275], [166.543334455714, -22.162333325730053], [166.54352460115265, -22.16105935128999]]], [[[166.55377042188016, -22.156644778050875], [166.5547310459653, -22.156150199313977], [166.5571601281798, -22.157594422720926], [166.55591470799402, -22.157974703693682], [166.55377042188016, -22.156644778050875]]], [[[166.5636689027244, -22.155629314685136], [166.56501910456777, -22.157264770439085], [166.5676624574724, -22.158053972925], [166.56441398773507, -22.158126816082785], [166.5636689027244, -22.155629314685136]]], [[[166.567134357888, -22.156699212883172], [166.56747524956577, -22.1555218914194], [166.56796010780602, -22.1555218914194], [166.56817591451144, -22.156475567953166], [166.567134357888, -22.156699212883172]]], [[[166.54821401829568, -22.14353353375326], [166.54728232991243, -22.14430360272309], [166.54536937297266, -22.14407559119138], [166.54773866707973, -22.14321029492642], [166.54821401829568, -22.14353353375326]]], [[[166.54485021255377, -22.143441541071887], [166.5436904492498, -22.14250992792609], [166.5469415890035, -22.14204412135319], [166.54674195761513, -22.142557459209037], [166.54485021255377, -22.143441541071887]]], [[[166.55380291250984, -22.14077320797219], [166.55537735843822, -22.14165477814855], [166.5551474111014, -22.142901580345203], [166.5548967247391, -22.141721588768295], [166.55380291250984, -22.14077320797219]]], [[[166.55910223648178, -22.1324606113596], [166.56223204257992, -22.132482613400626], [166.56295101371595, -22.12958563264989], [166.5646340117883, -22.133265408096268], [166.56603175595012, -22.13330344195101], [166.56488123184414, -22.132010290889752], [166.5659081459222, -22.130374835135804], [166.56282095727198, -22.129317300581466], [166.56099567414788, -22.126249738585503], [166.56369106186676, -22.122613945986807], [166.5621142689116, -22.126866212035765], [166.56280838676065, -22.127978702286995], [166.56310054788548, -22.12579360341888], [166.56412273263163, -22.126242500792856], [166.56462450332464, -22.129100701001914], [166.56948480521757, -22.128708084710453], [166.56569895972112, -22.13192471471658], [166.56752458474878, -22.13295162879464], [166.56656422991654, -22.134938897704956], [166.56741048318457, -22.137277979771643], [166.56871116272717, -22.13688812375433], [166.56799813590325, -22.138780021593792], [166.57055552544503, -22.138066994769876], [166.56974005678757, -22.139065570944567], [166.5722662565587, -22.14233406217918], [166.56971890730497, -22.140928609089865], [166.57079278678725, -22.142947215729215], [166.56663855265757, -22.143674444358336], [166.56774803364561, -22.140035434240538], [166.56563088945902, -22.14145473344462], [166.56583052084738, -22.14306129080829], [166.56477532636592, -22.14143572093144], [166.56588912899485, -22.138238334603905], [166.56455659309978, -22.139312414955647], [166.5632552845539, -22.138266859994967], [166.5641384071744, -22.1349714664504], [166.56061193164928, -22.137620284464337], [166.56328512949807, -22.141321463557453], [166.5625659209369, -22.14308765108366], [166.56525975265342, -22.14519662499513], [166.5668096593426, -22.144264779255614], [166.56714821891032, -22.147900924464924], [166.56988094683103, -22.14750722208392], [166.57091738750051, -22.150160129852537], [166.5728476393895, -22.146537341824427], [166.57555622023685, -22.147421906699687], [166.5722676129598, -22.148667274943318], [166.57192530228, -22.15025046183748], [166.57376997649902, -22.14954206890286], [166.5724577855597, -22.15093983751213], [166.57335159677925, -22.152290062971424], [166.57483494305845, -22.149741750132755], [166.57563541213344, -22.152284139288472], [166.57692684165738, -22.152137924891505], [166.57034637091016, -22.153639500604264], [166.56496498512362, -22.153259943230918], [166.56506958005357, -22.151938243661608], [166.5606290498459, -22.152898615291107], [166.5615608955854, -22.15536135045982], [166.5595052145211, -22.154555281520306], [166.55791727436645, -22.15658771127354], [166.55691860576312, -22.15616922157309], [166.55890643184026, -22.153696327888607], [166.55806945243936, -22.152792770580813], [166.55602455958487, -22.155208597487963], [166.54521125035754, -22.14885628460587], [166.54715662907108, -22.147995986708573], [166.5481833013025, -22.149307845670922], [166.54790028649316, -22.144408179990602], [166.549535494676, -22.14449374320947], [166.54860157517456, -22.148746978433397], [166.54992294036126, -22.147720306201993], [166.55124430554798, -22.148899078023234], [166.55179816646395, -22.146319091878695], [166.55451444672946, -22.150201430761218], [166.55649060493312, -22.14873151826053], [166.55937247718848, -22.151251967592792], [166.55897300974715, -22.149454364106763], [166.5578731550037, -22.148477186399088], [166.55733779536578, -22.14636091611782], [166.55845952984086, -22.14472584552707], [166.55789216905222, -22.143314872193912], [166.55648802291287, -22.143854581635775], [166.55840823537628, -22.142111358311666], [166.55855823455622, -22.138745450316545], [166.5524742303388, -22.137927912249815], [166.55226509269374, -22.13920175063285], [166.551542617193, -22.13686321151176], [166.54891889037424, -22.137195930492403], [166.54995507234247, -22.134657759982936], [166.54765455824776, -22.13499047896358], [166.54893790288736, -22.132832558717702], [166.55461313807146, -22.135142579069015], [166.55665625589077, -22.13269552602969], [166.5564141418458, -22.135524653000143], [166.55846317199033, -22.137176917979225], [166.56467075754344, -22.13417294089686], [166.56153425262679, -22.133312950414698], [166.56221814334324, -22.134391584798422], [166.56085874865093, -22.13447714110773], [166.55910223648178, -22.1324606113596]], [[166.55262633044418, -22.13717691797923], [166.55319670583958, -22.135941104622557], [166.55044939768513, -22.13542776676671], [166.55043038517195, -22.13576999200394], [166.55262633044418, -22.13717691797923]], [[166.56078855481024, -22.147549194163428], [166.5616916461249, -22.148119567625315], [166.55960978298899, -22.146028198265054], [166.5586337169492, -22.146233528659824], [166.55996344574623, -22.1509873806621], [166.5628514054974, -22.151998107166172], [166.55968844859063, -22.14828563945096], [166.56157138746374, -22.149646550390315], [166.56078855481024, -22.147549194163428]], [[166.56220163688073, -22.143138143681288], [166.5615456351168, -22.143299767304285], [166.56142204058156, -22.14354695637475], [166.5622396659685, -22.14385118907686], [166.56220163688073, -22.143138143681288]], [[166.56243652667663, -22.135595168446955], [166.5622178651173, -22.135490591179448], [166.5619611754607, -22.135595168446955], [166.562417512628, -22.136032491565626], [166.56243652667663, -22.135595168446955]], [[166.56385307330015, -22.13213461159487], [166.5627217374062, -22.132115597546232], [166.56296892003851, -22.13328496153746], [166.56383405925152, -22.133161370221313], [166.56385307330015, -22.13213461159487]], [[166.56283582169817, -22.150511689603338], [166.56373898900847, -22.150188450776493], [166.56202772463106, -22.14936133966075], [166.56192314736356, -22.149817676828057], [166.56283582169817, -22.150511689603338]], [[166.56293089194136, -22.149218734295964], [166.5633932602862, -22.147758331099453], [166.56175818969544, -22.14712141406701], [166.5617661108234, -22.147792046846515], [166.56293089194136, -22.149218734295964]], [[166.5597840668917, -22.141803255327204], [166.55874780124094, -22.14155607269491], [166.55894744875164, -22.143276844096636], [166.5595015716495, -22.14315715822517], [166.5597840668917, -22.141803255327204]], [[166.5585260734114, -22.147264007432483], [166.55803174974443, -22.148100555176587], [166.55821236800736, -22.148423766804992], [166.55860212320633, -22.148110061400953], [166.5585260734114, -22.147264007432483]], [[166.5616911422778, -22.14536968236823], [166.56147244761303, -22.145854614016205], [166.56190983694256, -22.145968715580434], [166.56200492157944, -22.14564542781512], [166.5616911422778, -22.14536968236823]], [[166.55014668151946, -22.15001552075055], [166.549300190989, -22.14956849766143], [166.5486344119201, -22.150614721912557], [166.54995645892834, -22.15048156609878], [166.55014668151946, -22.15001552075055]], [[166.55408666663305, -22.151988600941806], [166.5548851894797, -22.151903044922523], [166.5549422268259, -22.151636870640306], [166.55391555459448, -22.151323165236267], [166.55408666663305, -22.151988600941806]], [[166.55644304928535, -22.152431347657696], [166.55599602619623, -22.152878370746816], [166.5564335381558, -22.15315419350393], [166.55664278300603, -22.153078104467486], [166.55644304928535, -22.152431347657696]], [[166.55620527104645, -22.15200334682769], [166.55661424961735, -22.151841657625244], [166.55595798167798, -22.150709833208115], [166.55552624481547, -22.15152982941443], [166.55620527104645, -22.15200334682769]], [[166.56140302603768, -22.141132109301747], [166.5599674279746, -22.139829613045837], [166.55920684621933, -22.140419063906176], [166.56166678046114, -22.14274283121254], [166.56140302603768, -22.141132109301747]], [[166.56565911511325, -22.152071364481536], [166.56659096085278, -22.15262286502125], [166.56738017714235, -22.150711630392248], [166.5657732186732, -22.15045489738238], [166.56565911511325, -22.152071364481536]], [[166.56051884974718, -22.143176172769053], [166.561193866055, -22.14296701278635], [166.56085836063974, -22.142478254053845], [166.56025264613282, -22.142596229180654], [166.56051884974718, -22.143176172769053]]], [[[166.54827246492607, -22.138669400263822], [166.54638071986471, -22.140561145325186], [166.54505935019873, -22.13982916356777], [166.54469811244832, -22.13832717502659], [166.5458198507259, -22.139372863251463], [166.5475880144516, -22.137005805360612], [166.54827246492607, -22.138669400263822]]], [[[166.5690554474022, -22.12962366650463], [166.57085025710273, -22.130362545947627], [166.57159160698268, -22.13289073912793], [166.5691957356802, -22.132119589473472], [166.5690554474022, -22.12962366650463]]], [[[166.54168969766815, -22.129571266621554], [166.54355312296858, -22.128782163050456], [166.54299219392405, -22.12732755044349], [166.54469399560148, -22.12832581399729], [166.54236471397593, -22.13102587922852], [166.54422813927636, -22.131177995579577], [166.54538802645317, -22.1338780608108], [166.54191787219472, -22.13416327896903], [166.54168969766815, -22.129571266621554]]], [[[166.55582040748345, -22.130122681337454], [166.55651415415414, -22.129913606998336], [166.5588424820216, -22.131643221985573], [166.55715088055055, -22.131377127372154], [166.55582040748345, -22.130122681337454]]], [[[166.5522365739239, -22.124875821952052], [166.55249324285182, -22.12593101643352], [166.55178977986418, -22.126149660335084], [166.5514950859099, -22.124799771899337], [166.5522365739239, -22.124875821952052]]], [[[166.56182291994037, -22.124619150135675], [166.56015552539233, -22.126580958125192], [166.56180301845671, -22.129700442291202], [166.55454553181775, -22.124755333097532], [166.55294810991853, -22.121741150109152], [166.55481176880093, -22.12208345480184], [166.55480226033725, -22.118508272456], [166.55910008592318, -22.117975798489592], [166.5555439205047, -22.11633083427196], [166.55617147910797, -22.114847513936983], [166.56103981251508, -22.114419633071126], [166.56272281058745, -22.116454444299873], [166.56318753096178, -22.114946975414853], [166.56386207236278, -22.11732212119303], [166.56345449675638, -22.111627048033615], [166.56583819365022, -22.1169991013672], [166.56253513033522, -22.11984484062087], [166.56274165534953, -22.121730290158087], [166.56182291994037, -22.124619150135675]], [[166.5621455148804, -22.119645281485475], [166.56169888252975, -22.120082411020153], [166.56224750593753, -22.121388186719013], [166.5624819256409, -22.12135777752443], [166.5621455148804, -22.119645281485475]], [[166.56070701628605, -22.122292641002918], [166.5584206372491, -22.121566296140156], [166.5591571367053, -22.1254399424829], [166.5600794576828, -22.123414639717836], [166.56124683692144, -22.12399300184971], [166.56070701628605, -22.122292641002918]], [[166.55811120569987, -22.120001101254655], [166.5588908997221, -22.119658796561968], [166.55858662888414, -22.11822301854542], [166.55804464645405, -22.11847023860125], [166.55811120569987, -22.120001101254655]]], [[[166.54842935737568, -22.109600816044402], [166.5477440266552, -22.110606871393763], [166.54689763663927, -22.109968339874907], [166.5477069507994, -22.10891576634847], [166.54842935737568, -22.109600816044402]]], [[[166.60214076628176, -22.115319048024325], [166.59935184171, -22.114324816568416], [166.59970782468798, -22.111554986293395], [166.5909944099541, -22.11142188448622], [166.59346584574646, -22.112896962754007], [166.59316955554246, -22.113814221734945], [166.59203642581718, -22.11243901912481], [166.58595076912425, -22.112737065922097], [166.58607439672465, -22.11519627144678], [166.58311374257113, -22.11740873513944], [166.58898362193858, -22.114540269682855], [166.58985829095715, -22.116603347694046], [166.58772866204237, -22.117810771230545], [166.5894232864214, -22.117551270015575], [166.59024048637792, -22.117969372318907], [166.58846072198185, -22.11865691843329], [166.58657828213754, -22.117592103975905], [166.58466732047737, -22.1191227747584], [166.5883656492624, -22.12088162006748], [166.58509514771472, -22.121471070927818], [166.58155844255268, -22.118390714818947], [166.58301305515965, -22.120472807374018], [166.5806621427015, -22.119233181553977], [166.5816408821843, -22.121276181445264], [166.57817253353167, -22.121846320949814], [166.58610291854046, -22.122336232674442], [166.5849667995436, -22.12366725074618], [166.58618373035205, -22.124484876133103], [166.5810735716837, -22.124589456124454], [166.58133977529803, -22.12560673422214], [166.57783159195182, -22.12426620887846], [166.57731742749615, -22.127168929044362], [166.5752873532333, -22.128172561264197], [166.5743195526103, -22.125626483263435], [166.56986579996308, -22.12806318921125], [166.56879822669302, -22.126500772393193], [166.5681520129884, -22.128182828653703], [166.56465062076114, -22.121654387092423], [166.56759132756824, -22.125845055545877], [166.5682090318447, -22.12462865327839], [166.56604720647871, -22.12272795298416], [166.56794107348915, -22.121013367799225], [166.57064548870525, -22.123516501382515], [166.57227958900063, -22.12371601362788], [166.57006391729615, -22.118990898616772], [166.56752929744428, -22.119621262306303], [166.56606620764492, -22.118671203995035], [166.5678998201857, -22.1177496474331], [166.56517315283233, -22.114215430515173], [166.57101601144666, -22.116980100200973], [166.57250760299536, -22.11644806754666], [166.57118269286906, -22.114181162302007], [166.56998994847046, -22.11510848532777], [166.564470109682, -22.112096800481044], [166.56810883301418, -22.11211580164727], [166.56552467440744, -22.109142119132986], [166.57011345605088, -22.11220130689528], [166.56679775254455, -22.109341631378353], [166.56580969190082, -22.106187437784936], [166.57046497762605, -22.109322630212127], [166.56837484934132, -22.105702908046194], [166.57198507092406, -22.10501886606207], [166.5648311318402, -22.101845671302428], [166.56417559160542, -22.104258819413054], [166.5622754749829, -22.104230317663717], [166.56507343334616, -22.105684476517816], [166.56482244257327, -22.10735580308075], [166.56241798372957, -22.109978170446904], [166.56073963070915, -22.10921991365118], [166.56146160871214, -22.111138855185448], [166.558924179345, -22.109798519719856], [166.55523489543495, -22.11170972092069], [166.55634223889493, -22.113717040823346], [166.55399963057226, -22.11384083719812], [166.55419008653345, -22.115659691627485], [166.55203054317292, -22.116097876911635], [166.55300516070065, -22.11900271256766], [166.55184608599174, -22.12012898658404], [166.54945850374585, -22.11847974706493], [166.54984835075697, -22.12066669371265], [166.5482319119304, -22.121741150109152], [166.55154274867294, -22.122011397933175], [166.54980323205544, -22.124568380044654], [166.54475754061676, -22.124654269996565], [166.54503308289932, -22.125414386638145], [166.54266312278745, -22.127145150196426], [166.5397874941597, -22.12324241811706], [166.5418040336911, -22.124661838547386], [166.54249681067802, -22.12324241811706], [166.53726059728635, -22.12231448060216], [166.53897061789309, -22.126414852337167], [166.54144250859773, -22.12723247772409], [166.53710719259266, -22.12585392329265], [166.5340553582996, -22.12684267957451], [166.52902481528523, -22.12161278584938], [166.53058766095288, -22.1216516841099], [166.52978549238009, -22.11922616146425], [166.53536696056364, -22.1211944134472], [166.53434004648557, -22.11833236587779], [166.53951265073061, -22.12212624288841], [166.54184222433358, -22.121650819704122], [166.53627026461373, -22.1188553313805], [166.533084929279, -22.113939455654965], [166.53527187592672, -22.113273863196962], [166.53662207777012, -22.117305451799723], [166.53628928154112, -22.11399650643708], [166.53827655045146, -22.113055168532195], [166.53734472101027, -22.111010848839758], [166.5396552776859, -22.111828576716736], [166.54082481871927, -22.10904259685681], [166.54491345810413, -22.10996491783433], [166.54488493271302, -22.113449769775183], [166.54654112315256, -22.11018672413928], [166.54571216905367, -22.113316651283583], [166.54726204863445, -22.111348399300635], [166.5462921853385, -22.113991752205273], [166.5484886404499, -22.112422855697126], [166.54991491000277, -22.115722292596075], [166.55230153438788, -22.112128093322866], [166.55074214634342, -22.11216612717761], [166.55124609491878, -22.11071133223369], [166.54939194450006, -22.111357907764322], [166.54953545895484, -22.11010110302198], [166.5524178842536, -22.11006538789152], [166.5506542837509, -22.108554701870766], [166.55208428911658, -22.106395441277122], [166.55257600192496, -22.108260149270535], [166.55473581363162, -22.10763346198671], [166.5536568199339, -22.104231429835096], [166.55778055633715, -22.106473830275572], [166.55626266027625, -22.10947636645859], [166.55894418541217, -22.109457406415316], [166.55763491342393, -22.107619526775053], [166.55913417962347, -22.108431437674223], [166.56004109157936, -22.105912528259513], [166.55804660384703, -22.103651826331415], [166.56098262815263, -22.102758666833935], [166.5601194, -22.1003377], [166.5626069, -22.098703], [166.5612303, -22.0895495], [166.5635583, -22.0905423], [166.5757086, -22.0887421], [166.57848294905494, -22.090389906150975], [166.57865448026922, -22.093751174490393], [166.58717650332133, -22.09574629694406], [166.58804185006673, -22.0973041150976], [166.5896948324542, -22.09639212481487], [166.5884305802922, -22.093561162828138], [166.59014009293574, -22.094381912672752], [166.59249975637752, -22.100772812206547], [166.59814376426584, -22.103632822937833], [166.6036936, -22.1042714], [166.6050308, -22.1065903], [166.60502486481482, -22.110723349639095], [166.6025989616337, -22.112095576131086], [166.60545116620568, -22.11423101002043], [166.60339237820838, -22.11633686704304], [166.60214076628176, -22.115319048024325]], [[166.59346652574118, -22.105948931098084], [166.59328598156475, -22.1049226799899], [166.59140452119973, -22.105872912497478], [166.59117964762228, -22.10833820927166], [166.59427422337262, -22.108448042593007], [166.59346652574118, -22.105948931098084]], [[166.57798248703014, -22.11271458655201], [166.57581595691286, -22.113588800458977], [166.57395350119802, -22.112942642353826], [166.57367793377082, -22.11398789811216], [166.57691822662164, -22.11681008865966], [166.5774503568259, -22.115099670146023], [166.57851461723436, -22.11698113051102], [166.57798248703014, -22.11271458655201]], [[166.53594810746196, -22.12331193347509], [166.5363473751594, -22.122598955443948], [166.53471227887465, -22.12171486268533], [166.53504500195587, -22.12285562753516], [166.53594810746196, -22.12331193347509]], [[166.57249826694806, -22.117835142628216], [166.57278337796183, -22.11833883875256], [166.5738667998142, -22.1180727351397], [166.57311600747792, -22.117416979808006], [166.57249826694806, -22.117835142628216]], [[166.57180449681454, -22.120296601047183], [166.57228918553798, -22.120154045540296], [166.57220365223384, -22.11991645302881], [166.57169995610948, -22.119878438226973], [166.57180449681454, -22.120296601047183]], [[166.56891062002467, -22.122829337219592], [166.56932878284488, -22.12314295933475], [166.5696519086605, -22.122772315016835], [166.56914821253613, -22.12257273730719], [166.56891062002467, -22.122829337219592]], [[166.5739041887129, -22.120286303124193], [166.57444572195033, -22.119431250644052], [166.57293512923542, -22.11858569874702], [166.57318214439633, -22.119526256475176], [166.5739041887129, -22.120286303124193]], [[166.5687168703334, -22.112942352378077], [166.56808033126484, -22.11310386229099], [166.56772880968967, -22.113474385032386], [166.56886887966317, -22.113502886781728], [166.5687168703334, -22.112942352378077]], [[166.548365030422, -22.118879102539744], [166.54886897899735, -22.119240424159802], [166.54920177522635, -22.119211898768743], [166.54891652131576, -22.11868893326603], [166.548365030422, -22.118879102539744]], [[166.54785157338299, -22.11808039159014], [166.54673908313174, -22.1183751539644], [166.5466344900312, -22.119249932623486], [166.54779452260087, -22.119135831059257], [166.54785157338299, -22.11808039159014]], [[166.54419081486398, -22.124374994550102], [166.54374391707077, -22.12485041773439], [166.54455213648404, -22.12496451929862], [166.54456164494775, -22.124802875415963], [166.54419081486398, -22.124374994550102]], [[166.56559358925324, -22.09965059009589], [166.56450110089372, -22.09940359272765], [166.56429210312058, -22.099489091816658], [166.5648050976546, -22.10045808149206], [166.56559358925324, -22.09965059009589]], [[166.58925758962803, -22.10207970310627], [166.59037886398698, -22.10207970310627], [166.59067343606435, -22.10188965660475], [166.589628180306, -22.10173761940354], [166.58925758962803, -22.10207970310627]], [[166.5774646103136, -22.122292930228376], [166.5766759173323, -22.122349944178833], [166.5768754661589, -22.123499725512996], [166.57814877771904, -22.123138637160118], [166.5774646103136, -22.122292930228376]], [[166.58053861247552, -22.12409837199277], [166.58114676128037, -22.12373728363989], [166.5811657659305, -22.12355673946345], [166.580348565974, -22.123699274339586], [166.58053861247552, -22.12409837199277]], [[166.5755593941358, -22.12041146986337], [166.5774788638011, -22.119157162953368], [166.57454264535272, -22.11754176769049], [166.57432409187598, -22.117912358368446], [166.5755593941358, -22.12041146986337]], [[166.57362091982037, -22.10939827510057], [166.5747421941793, -22.112923637703673], [166.57791597075462, -22.11222046564807], [166.57696573824703, -22.109901898329586], [166.57362091982037, -22.10939827510057]], [[166.57605826620238, -22.12284406508277], [166.5758112057504, -22.12210288372686], [166.57507756663432, -22.1222392101637], [166.57579220110026, -22.123062618559512], [166.57605826620238, -22.12284406508277]], [[166.57904627308523, -22.12437530813517], [166.5796544533074, -22.124175748999775], [166.57970196738725, -22.123881161704666], [166.5789892561894, -22.124004698312294], [166.57904627308523, -22.12437530813517]], [[166.5791322683643, -22.12355673946345], [166.57899923581326, -22.123366692961934], [166.57807698585617, -22.1235390603297], [166.57838107596726, -22.12398569268035], [166.5791322683643, -22.12355673946345]], [[166.5720949632023, -22.115340505850497], [166.5726936406085, -22.115369014298413], [166.57280767440014, -22.115197963610928], [166.5719904322266, -22.11497939884359], [166.5720949632023, -22.115340505850497]], [[166.59928871872805, -22.110583017205645], [166.60006785786416, -22.11087756980588], [166.60207381176002, -22.109339137155885], [166.59799043806862, -22.108522462417607], [166.59786346421077, -22.11056401381208], [166.59928871872805, -22.110583017205645]], [[166.59543578068306, -22.104839538429104], [166.5954748007939, -22.105972074006754], [166.5968811783811, -22.10405255865129], [166.59602594876725, -22.102788719333084], [166.59543578068306, -22.104839538429104]]], [[[166.54901698787108, -22.10698748166824], [166.5497294661635, -22.106037510611674], [166.5501474534284, -22.107395969222566], [166.54977076571407, -22.107614043872513], [166.54901698787108, -22.10698748166824]]], [[[166.5716085427957, -22.163059946952668], [166.57167700377872, -22.162694821709845], [166.5740503178571, -22.16292302498661], [166.57517612068915, -22.164231390440065], [166.5716085427957, -22.163059946952668]]], [[[166.57559738304568, -22.159832913209584], [166.57642824758128, -22.16108476747405], [166.5750744830889, -22.159376564156418], [166.57591112301972, -22.15633423713531], [166.57559738304568, -22.159832913209584]]], [[[166.58134928256996, -22.157769835198405], [166.58259473519422, -22.157750820654517], [166.5818974054575, -22.16025638953022], [166.58111160077144, -22.1589297223752], [166.58134928256996, -22.157769835198405]]], [[[166.57800272284675, -22.157361022504936], [166.57849427154196, -22.155650046431532], [166.5804080626478, -22.159338535068656], [166.57897246458472, -22.158226184251564], [166.57848438372702, -22.160855332062308], [166.57800272284675, -22.157361022504936]]], [[[166.5894399709917, -22.15771279156676], [166.58444865322272, -22.15621064260008], [166.58772866204234, -22.154394753659364], [166.58334580967755, -22.153596142816323], [166.59018629183913, -22.148785463214203], [166.59188809351653, -22.14833862143297], [166.58893133194292, -22.15043972853193], [166.59004368275998, -22.151628137524543], [166.59358280543972, -22.15122559317579], [166.59550395771453, -22.149047653220684], [166.59415344472927, -22.151672593952604], [166.5960365543848, -22.152033998835986], [166.59208893552744, -22.153877176212216], [166.5909706417742, -22.158226184251568], [166.5894399709917, -22.15771279156676]]], [[[166.58560767720357, -22.148425423479335], [166.58645944123825, -22.14942245043424], [166.58568935221103, -22.150411206716104], [166.58499532135934, -22.149631610416943], [166.58560767720357, -22.148425423479335]]], [[[166.5728467183059, -22.144503250233775], [166.57332206952182, -22.144645855598558], [166.57278751939907, -22.145607393960375], [166.57238816392427, -22.14495130996606], [166.5728467183059, -22.144503250233775]]], [[[166.59282931343873, -22.141208167477256], [166.59206873168344, -22.140894427503202], [166.59243951528916, -22.140114831204045], [166.59303847342142, -22.140903934775146], [166.59282931343873, -22.141208167477256]]], [[[166.57222876172517, -22.140681426457572], [166.57243791626018, -22.141118749576243], [166.57166500607158, -22.139795925460092], [166.5720005931415, -22.13985431534183], [166.57222876172517, -22.140681426457572]]], [[[166.589245071917, -22.13935424944877], [166.58949226098744, -22.138831349492015], [166.59178351352523, -22.140628223888857], [166.59030037910242, -22.140314483914803], [166.589245071917, -22.13935424944877]]], [[[166.59658659929178, -22.13682685796318], [166.59602860783028, -22.137331065358083], [166.5956548847185, -22.136875834888983], [166.59600008189605, -22.13657037377874], [166.59658659929178, -22.13682685796318]]], [[[166.60585158677495, -22.13560102885004], [166.60613733641574, -22.13563966538943], [166.60505558788935, -22.13621147094907], [166.60515594424692, -22.13603995978386], [166.60585158677495, -22.13560102885004]]], [[[166.60501404787357, -22.134477566786416], [166.60458062163917, -22.13446996281739], [166.6053442503684, -22.134177219465936], [166.60531577857643, -22.134758913640304], [166.60501404787357, -22.134477566786416]]], [[[166.58153145958607, -22.132186455288164], [166.5837498687351, -22.133117479055496], [166.58435681581415, -22.135002368120354], [166.5814395325759, -22.13468878392862], [166.58153145958607, -22.132186455288164]]], [[[166.59171696262163, -22.13623586425213], [166.58771440113446, -22.134201308056767], [166.58779045930999, -22.131586808273], [166.5851854667982, -22.132242810036928], [166.58425375414797, -22.13069312471055], [166.58308435969923, -22.13199562096646], [166.57994904060251, -22.130894239891475], [166.57861588113204, -22.131930023158166], [166.57805556682183, -22.130180313129156], [166.58253914214097, -22.13067033952988], [166.57976632179182, -22.129942050227214], [166.57898672549265, -22.128477930348307], [166.5828942142604, -22.129504715717932], [166.58286569244459, -22.12805010311096], [166.58035101901618, -22.12769833404915], [166.58326975150206, -22.12574934330125], [166.5841824496084, -22.126871201390284], [166.58571004496113, -22.125691513360103], [166.5860601358168, -22.12694725956581], [166.58816124291576, -22.124180643430993], [166.5878570102136, -22.12635780870547], [166.5906426408923, -22.126842679574462], [166.5893401446364, -22.127679319505265], [166.59086130814694, -22.127964537663495], [166.5907377136117, -22.130170224753797], [166.59502549325708, -22.130046630218565], [166.5946832314672, -22.131254053755068], [166.59781112393577, -22.131853011887348], [166.59921820018306, -22.134438989855287], [166.5976970366725, -22.133602349924484], [166.59171696262163, -22.13623586425213]], [[166.58857949765698, -22.130848905997645], [166.5888075976436, -22.13125758514033], [166.58914024345742, -22.130744360170446], [166.58877908514526, -22.130601797678814], [166.58857949765698, -22.130848905997645]], [[166.58625028125556, -22.127774392224676], [166.58581294674627, -22.127831435856322], [166.5856323085794, -22.12861103215548], [166.58623126671168, -22.128668075787125], [166.58625028125556, -22.127774392224676]], [[166.58420621778825, -22.12832581399725], [166.5835692305682, -22.1280120740232], [166.58329351968192, -22.128059610382905], [166.58457700139394, -22.128962801217295], [166.58510940862263, -22.128382857628896], [166.58420621778825, -22.12832581399725]]], [[[166.60431945922852, -22.130336652839972], [166.60436698678637, -22.13027961977053], [166.604482604589, -22.130245706379675], [166.60439260006711, -22.13045869998817], [166.60431945922852, -22.130336652839972]]], [[[166.57589320216883, -22.12921351460288], [166.57655357828065, -22.129020549825203], [166.57695284105742, -22.12926771249654], [166.57574750435435, -22.1300103533973], [166.57589320216883, -22.12921351460288]]], [[[166.57194376693158, -22.12838239465071], [166.5738823201789, -22.128107949192586], [166.57479492081154, -22.128583262022072], [166.5751583738445, -22.129535317885548], [166.57021547997186, -22.128263956197568], [166.57194376693158, -22.12838239465071]]], [[[166.57847808644382, -22.125682792397665], [166.57936226273432, -22.12536905242361], [166.58037003356006, -22.12623421417024], [166.5795429009012, -22.126690563223406], [166.57847808644382, -22.125682792397665]]], [[[166.59387765476532, -22.123245541206398], [166.59407001242698, -22.12463699248416], [166.5899818854924, -22.12462748521222], [166.5913777052216, -22.123483178995727], [166.59387765476532, -22.123245541206398]]], [[[166.58867938923646, -22.122792581727612], [166.58841318562213, -22.12356267075483], [166.58765260386684, -22.123401047131832], [166.5875955602352, -22.122811596271493], [166.58867938923646, -22.122792581727612]]], [[[166.5912778973501, -22.122513616815265], [166.59225696504214, -22.121163834171877], [166.5927607571555, -22.121277900310755], [166.59239479495992, -22.122846309720323], [166.5912778973501, -22.122513616815265]]], [[[166.6027115578449, -22.12005267393963], [166.6025443137513, -22.11993104187155], [166.60319957255908, -22.11920914934256], [166.60329590893116, -22.119695379739635], [166.6027115578449, -22.12005267393963]]], [[[166.60258992577684, -22.119262065497093], [166.60233145763215, -22.11858548711838], [166.60318423416425, -22.11818045993356], [166.60318447604374, -22.11913295398166], [166.60258992577684, -22.119262065497093]]], [[[166.59649301627772, -22.112372502849283], [166.5980989092155, -22.112049423796705], [166.59914416497384, -22.112705084226935], [166.5971296720578, -22.11282861445292], [166.59649301627772, -22.112372502849283]]], [[[166.59607491397438, -22.112296484248677], [166.59560930004568, -22.11261956330125], [166.59519119774234, -22.112068428446857], [166.59584685817256, -22.111897386595494], [166.59607491397438, -22.112296484248677]]], [[[166.58560933007635, -22.091260424593973], [166.58599694557006, -22.09098681365725], [166.58776781635498, -22.093396109961198], [166.58634655954475, -22.093175701151054], [166.58560933007635, -22.091260424593973]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 8.620134163615921, "forest_fragmentation_fragment_size_distribution": {"10": 6.595519188312799, "100": 16.354458429365216, "1000": 40.06928725067495, "1100": 40.06928725067495, "1200": 40.06928725067495, "12000": 100.0, "125": 26.299484072871003, "1300": 40.06928725067495, "1400": 100.0, "150": 26.299484072871003, "1500": 100.0, "1600": 100.0, "1700": 100.0, "17000": 100.0, "175": 26.299484072871003, "1800": 100.0, "1900": 100.0, "20": 8.569295865404957, "200": 26.299484072871003, "2000": 100.0, "225": 26.299484072871003, "250": 26.299484072871003, "27000": 100.0, "275": 26.299484072871003, "30": 9.801084069454486, "300": 26.299484072871003, "325": 40.06928725067495, "350": 40.06928725067495, "375": 40.06928725067495, "40": 9.801084069454486, "400": 40.06928725067495, "425": 40.06928725067495, "450": 40.06928725067495, "475": 40.06928725067495, "50": 9.801084069454486, "500": 40.06928725067495, "500000": 100.0, "60": 12.167266301659081, "600": 40.06928725067495, "70": 12.167266301659081, "700": 40.06928725067495, "7000": 100.0, "80": 12.167266301659081, "800": 40.06928725067495, "90": 12.167266301659081, "900": 40.06928725067495}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 83, "land_use_category_distribution": null, "name": "Montagne des sources", "num_families_unique_taxonomic_count": 81, "num_occurrences_count": 3823, "num_species_unique_taxonomic_count": 438, "rainfall_mean": "2609.166748046875", "rainfall_range": "{\"min\": 1630.0, \"max\": 3840.0}", "shape_area": "5693.702557400756", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[166.5965903, -22.1517639], [166.5923465, -22.1540244], [166.590046, -22.1596901], [166.5828831, -22.1601202], [166.5786793, -22.1622803], [166.5763967, -22.1658065], [166.5730002, -22.165567], [166.565771, -22.1691914], [166.5627697, -22.1732868], [166.5595483, -22.171188], [166.5528246, -22.1712219], [166.5410437, -22.1646042], [166.5309477, -22.1660385], [166.5285484, -22.165127], [166.5164759, -22.1685655], [166.51247, -22.1602712], [166.516706, -22.1533763], [166.5196969, -22.1530985], [166.5240381, -22.1448593], [166.5235339, -22.1421627], [166.5278207, -22.1387402], [166.5265649, -22.1351645], [166.5319938, -22.129964], [166.5275529, -22.1206359], [166.5317199, -22.1163713], [166.5309594, -22.1122571], [166.5445317, -22.1085482], [166.5597479, -22.1020778], [166.5626069, -22.098703], [166.5612303, -22.0895495], [166.5635583, -22.0905423], [166.5746005, -22.0885189], [166.5858717, -22.0908984], [166.5915501, -22.0961417], [166.5935252, -22.1008357], [166.6019075, -22.1047511], [166.6036936, -22.1042714], [166.6050308, -22.1065903], [166.6054513, -22.1142308], [166.6030516, -22.1184623], [166.6046723, -22.1224028], [166.6040639, -22.1281594], [166.6053907, -22.128868], [166.604111, -22.1311251], [166.60616, -22.1356229], [166.5978426, -22.13815], [166.5927789, -22.14341], [166.5959185, -22.1478221], [166.5965903, -22.1517639]]]}, \"bbox\": [166.51247, -22.1732868, 166.60616, -22.0885189]}], \"bbox\": [166.51247, -22.1732868, 166.60616, -22.0885189]}", "shape_id": 83, "type": "protected_areas"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "protected_areas";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>