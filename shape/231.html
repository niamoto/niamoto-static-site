<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - 36.0</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">36.0</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 1510.1565542437427</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 1292.214722811383</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 1</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 1</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 7</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 3106.923095703125</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 2720.0, "max": 3460.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 386.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 688.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [108.0, 208.0, 308.0, 408.0, 508.0, 608.0], "forest": [107.79425665519514, 277.8202491113277, 383.3919437736322, 356.7211998589448, 160.02446348812475, 10.001528968007797], "non_forest": [37.78355387914056, 18.89177693957028, 30.00458690402339, 63.34301679738271, 48.896363843593676, 13.335371957343728]}, "elevation_max": 688.0, "elevation_median": 386.0, "forest_area": "1292.214722811383", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[166.35185099103776, -21.826903912809914], [166.35187775411273, -21.827272788350744], [166.35146622772123, -21.82664047503859], [166.35169960301215, -21.82671467777791], [166.35185099103776, -21.826903912809914]]], [[[166.35182260578296, -21.81904119723024], [166.35179481874277, -21.819044670610264], [166.351811571911, -21.818768162259726], [166.35190776154735, -21.81892765621104], [166.35182260578296, -21.81904119723024]]], [[[166.35225784635657, -21.827112071345116], [166.354897675053, -21.826014508159506], [166.35112224216695, -21.825810953932333], [166.35347580029668, -21.824810991117225], [166.3527380824951, -21.82364766689168], [166.35091937250405, -21.824577559623975], [166.3518845894737, -21.81803475016435], [166.35388526763177, -21.818482953885837], [166.3552856068686, -21.815814739934613], [166.35380011186737, -21.816401368533818], [166.35385688237696, -21.814007545379], [166.352088975925, -21.81648185164871], [166.34913922886395, -21.8139006214837], [166.34801059530133, -21.808476506425535], [166.35039240935166, -21.807242754565223], [166.34888438552434, -21.80535560636771], [166.3507630243614, -21.80301345438765], [166.34961837276492, -21.80254991779073], [166.34930665480016, -21.80130470230786], [166.35099006269465, -21.802209360290956], [166.3560201117155, -21.79961561081472], [166.3604733946811, -21.803340900693797], [166.35852016741188, -21.80280533591556], [166.35817166954976, -21.80409598268965], [166.3619997798083, -21.80533658823531], [166.3629387419978, -21.811071469116907], [166.36157709939684, -21.811397460029216], [166.36318304146218, -21.811896782965245], [166.36589642748692, -21.817370013857417], [166.36612089105378, -21.824724624355554], [166.36338519992273, -21.822605804777908], [166.36596026924775, -21.825682633934647], [166.36124916546555, -21.82931165440441], [166.3568995136489, -21.83004300175235], [166.35497635187323, -21.829879723406258], [166.35225784635657, -21.827112071345116]], [[166.35132576831435, -21.809808315208496], [166.34991133195976, -21.809418595852964], [166.34916385358338, -21.810421541522572], [166.35033258432944, -21.810650156871898], [166.35132576831435, -21.809808315208496]], [[166.3626000976596, -21.81913388439123], [166.36158420355144, -21.8184731980132], [166.36132845398578, -21.818579760332238], [166.36221647331107, -21.819297279947087], [166.3626000976596, -21.81913388439123]], [[166.35536465912747, -21.82100313805756], [166.35481251928857, -21.82082000653106], [166.35465166951136, -21.820943009301864], [166.35520112064123, -21.82155640111064], [166.35536465912747, -21.82100313805756]], [[166.3539578935858, -21.82115856845291], [166.3541710182239, -21.820853089805006], [166.35356356807736, -21.82028068668986], [166.35315512411574, -21.82107331859768], [166.3539578935858, -21.82115856845291]], [[166.36176631442797, -21.8166793584637], [166.36234381159275, -21.816821365963243], [166.3616243069284, -21.81646161363107], [166.3605450499319, -21.816878168963058], [166.36176631442797, -21.8166793584637]], [[166.3566102520926, -21.823270600195478], [166.3559952382386, -21.821898646213466], [166.35544645664578, -21.822050034239066], [166.35555053591338, -21.82238119554507], [166.3566102520926, -21.823270600195478]], [[166.3525038518982, -21.811746186746586], [166.352579545911, -21.810629700057774], [166.35128328594178, -21.810809473338175], [166.3511318979162, -21.81130148442138], [166.3525038518982, -21.811746186746586]], [[166.3536771090966, -21.81142448719218], [166.3531661745102, -21.81149071945338], [166.3528823219622, -21.811869189517385], [166.3540082704026, -21.81220035082339], [166.3536771090966, -21.81142448719218]], [[166.35184152928616, -21.8145468652202], [166.35229569336295, -21.813496610792594], [166.35028034027215, -21.814414400697803], [166.35135897995454, -21.8142251656658], [166.35184152928616, -21.8145468652202]], [[166.35404611740898, -21.824983177235097], [166.3536581855934, -21.8255035735731], [166.3543962022182, -21.8255508823311], [166.3543962022182, -21.8251913357703], [166.35404611740898, -21.824983177235097]], [[166.35875666567563, -21.80836777507858], [166.35886072491166, -21.808717792508908], [166.35972157859166, -21.808433994592427], [166.3594377806752, -21.808131276814848], [166.35875666567563, -21.80836777507858]], [[166.35431995824797, -21.802483698276884], [166.3553794704695, -21.80214314077711], [166.35280636936008, -21.802162060638206], [166.35361046345676, -21.80301345438765], [166.35431995824797, -21.802483698276884]], [[166.35982206497428, -21.824366468852183], [166.35876277787457, -21.82462183270657], [166.35846958233807, -21.825586540600924], [166.35968019616627, -21.825208223779608], [166.35982206497428, -21.824366468852183]], [[166.3581385551194, -21.826210763356094], [166.3580723496757, -21.827317340058443], [166.35843175065594, -21.827515956389636], [166.35876277787457, -21.82671203314434], [166.3581385551194, -21.826210763356094]], [[166.35758053780796, -21.828537411807186], [166.3579021071061, -21.829748025635396], [166.3593964585503, -21.827780778164556], [166.35767511701332, -21.827714572720826], [166.35758053780796, -21.828537411807186]], [[166.35426417880012, -21.828378520502657], [166.35409377261365, -21.828823469989565], [166.35488900148388, -21.828738266896327], [166.35445351900734, -21.828264916378338], [166.35426417880012, -21.828378520502657]], [[166.36480948974094, -21.81700974216511], [166.3646318858759, -21.816143035303615], [166.36387884548802, -21.816100410376], [166.36368703331377, -21.816739784290217], [166.36480948974094, -21.81700974216511]]], [[[166.34986485479826, -21.7994976480768], [166.34843717909817, -21.799480601751622], [166.34958657078178, -21.79804137306285], [166.35011752912, -21.79972347997837], [166.34986485479826, -21.7994976480768]]], [[[166.33859848505983, -21.79142169464253], [166.3401742328426, -21.792748554716063], [166.34216394749194, -21.791358819950833], [166.3463546967253, -21.79417787925454], [166.34723447026641, -21.793827861824212], [166.34833182221013, -21.791576398353467], [166.34997785012573, -21.79361028342158], [166.35073134085343, -21.7955663845724], [166.34882050986536, -21.79287737911269], [166.34797234484927, -21.794669795643106], [166.34915593702348, -21.794891553583238], [166.34714933089145, -21.795795527378477], [166.34709257130817, -21.796817199877808], [166.34921310840633, -21.795696454439334], [166.3480385643631, -21.797157757377587], [166.3494009293115, -21.797478990168358], [166.3473101497108, -21.797602374113406], [166.34885252598818, -21.801181709087945], [166.34674423424144, -21.80551261547635], [166.34212738175154, -21.806003318605963], [166.3404000092093, -21.80536274815849], [166.33966706386187, -21.804822654544015], [166.338757070269, -21.80366423336578], [166.33971382547966, -21.804612182650477], [166.3403949404792, -21.802729656471154], [166.3387867522858, -21.80070523133359], [166.3406976582568, -21.800941729597326], [166.33946313732008, -21.79633947338503], [166.33775544884023, -21.797758289001667], [166.33859848505983, -21.79142169464253]], [[166.3418373813371, -21.794269957600207], [166.3428450624915, -21.792938628352573], [166.34275992311657, -21.792475091755655], [166.34094361645109, -21.793279185852352], [166.3418373813371, -21.794269957600207]], [[166.34384781512975, -21.795142792170573], [166.3436869963104, -21.795492809600898], [166.34433027158775, -21.795880666753423], [166.34431135172665, -21.79489683397629], [166.34384781512975, -21.795142792170573]], [[166.34085847707613, -21.796022565711663], [166.34185176978383, -21.794679255573655], [166.3405841390902, -21.795426590087054], [166.34061836908828, -21.793788022525106], [166.3398557244379, -21.795861746892324], [166.34085847707613, -21.796022565711663]], [[166.34291601197052, -21.794655605747227], [166.34307683078987, -21.7950907625525], [166.34348360780348, -21.795270501232938], [166.34363496669226, -21.794523166719536], [166.34291601197052, -21.794655605747227]]], [[[166.3561104102519, -21.795994185920026], [166.35598082038487, -21.79605570292947], [166.35605112553853, -21.795994185920026], [166.3561104102519, -21.795994185920026]]], [[[166.35309104959626, -21.796167566449345], [166.35474674511184, -21.79421857629958], [166.3568624160314, -21.793816371647168], [166.35718771335766, -21.794691632161175], [166.35520121311063, -21.796307693784552], [166.35309104959626, -21.796167566449345]], [[166.356399380371, -21.794827490334143], [166.35613478856504, -21.794496750576723], [166.35582294822234, -21.794997585066533], [166.35624818505332, -21.795177129506275], [166.356399380371, -21.794827490334143]], [[166.3547656673463, -21.79446456534761], [166.3544061448915, -21.79532552701571], [166.35504950086326, -21.795599899415432], [166.35567393460056, -21.794947082326434], [166.3547656673463, -21.79446456534761]]], [[[166.36066051007813, -21.803480988254694], [166.36084481048218, -21.80361896831665], [166.36095136956308, -21.803779708762143], [166.36077163088265, -21.803808088553794], [166.36066051007813, -21.803480988254694]]], [[[166.36297610543383, -21.788853565238842], [166.3641961197412, -21.788787362912085], [166.3688690707523, -21.792004620752078], [166.36644462880983, -21.79137465449843], [166.36297610543383, -21.788853565238842]]], [[[166.37277569648452, -21.769709781955942], [166.37431611387925, -21.767885852157338], [166.3751761015045, -21.769927141465626], [166.37624399822593, -21.768755290196047], [166.37723629163966, -21.769823186917513], [166.37628221253323, -21.766877546490456], [166.37998517819443, -21.766488164716314], [166.38087470082345, -21.768292219936303], [166.38177249010258, -21.767281025695624], [166.38152491409915, -21.77020538558616], [166.38274459683325, -21.76799293783593], [166.3869302120153, -21.771912055216024], [166.38687643108312, -21.77363144157912], [166.38139638390444, -21.775871714007046], [166.38581606248843, -21.775602791809185], [166.3833481621026, -21.77771029737503], [166.38284747339895, -21.78337508607544], [166.37947634587317, -21.784039262393648], [166.38040207356693, -21.78590961018307], [166.3789600291279, -21.789148913031745], [166.37575598364216, -21.78878301643001], [166.37706756462921, -21.79081218847958], [166.37476823273335, -21.79250696351421], [166.37021668097688, -21.791742348147245], [166.36304703586123, -21.787789599287432], [166.36132990613422, -21.79364374148308], [166.3569658788568, -21.792849348894528], [166.35162240639528, -21.795653489944186], [166.35091309575148, -21.794537507864593], [166.35051588179093, -21.791898872269627], [166.34903805834145, -21.790575122024435], [166.3470725192117, -21.79126495066135], [166.34641103969685, -21.793750223695692], [166.3422720678754, -21.791066506806896], [166.33843776055483, -21.790532982673717], [166.33791776950923, -21.7890391902155], [166.33716659569964, -21.790313527919512], [166.3368960119779, -21.787708713845802], [166.33791418684484, -21.785138034925907], [166.33929541005858, -21.786303854300016], [166.3408280263756, -21.782812048265125], [166.34255555909598, -21.785840818639624], [166.34140362704642, -21.782275427696494], [166.3447173939883, -21.78058390980678], [166.35328469695816, -21.78120277531082], [166.3543204447529, -21.78460290697614], [166.35113589337428, -21.786833037911897], [166.3543960424117, -21.785113191173306], [166.3541950362532, -21.788765472315635], [166.3560154025287, -21.786692532082913], [166.35532717392084, -21.777623205524932], [166.35852217217007, -21.77458604290434], [166.36486572962403, -21.775364509769272], [166.36602999726458, -21.776654432141846], [166.36484246035988, -21.781186186537756], [166.36569985830602, -21.780162145483402], [166.3676102683067, -21.781164637859984], [166.36668166883697, -21.77846652025487], [166.36970918428173, -21.77605758736979], [166.37140585683588, -21.775317537396067], [166.37097093449373, -21.778214236946084], [166.37358046854658, -21.776625824913914], [166.37175198758567, -21.77227649880553], [166.37277569648452, -21.769709781955942]], [[166.3432264883182, -21.78899702089616], [166.34378402105216, -21.786596795228014], [166.3424799614372, -21.786247156055882], [166.3423287661195, -21.786700742008918], [166.3432264883182, -21.78899702089616]], [[166.33917256386297, -21.78928051211681], [166.33892687147173, -21.788893074115258], [166.33854888317754, -21.788911973529967], [166.33864338025109, -21.78931831094623], [166.33917256386297, -21.78928051211681]], [[166.33910902172275, -21.78742249078287], [166.33832430796303, -21.786845773441406], [166.3371897820454, -21.78860428861374], [166.33794613265715, -21.788765013118738], [166.33910902172275, -21.78742249078287]], [[166.3403475458495, -21.789086462128733], [166.3396762846816, -21.788103206333453], [166.33920356554924, -21.788018116889628], [166.34035377728233, -21.790518423780302], [166.3403475458495, -21.789086462128733]], [[166.37191246624243, -21.79064609889679], [166.37165710831655, -21.78966249799712], [166.37090994994085, -21.788754558705115], [166.37070256361085, -21.79119958204555], [166.37191246624243, -21.79064609889679]], [[166.36998309524694, -21.78937876696837], [166.37015333386418, -21.788451912274446], [166.36883871343096, -21.790570437289123], [166.3694440062923, -21.79065555659775], [166.36998309524694, -21.78937876696837]], [[166.38054376658127, -21.77158916953277], [166.38084604501188, -21.771570277130856], [166.38057210518414, -21.77076735004954], [166.3802981653564, -21.77139079931268], [166.38054376658127, -21.77158916953277]], [[166.35895194879606, -21.789387912714723], [166.3585169049046, -21.789208220672602], [166.35885737403706, -21.790494437395154], [166.35895194879606, -21.790409320112044], [166.35895194879606, -21.789387912714723]], [[166.37437472747973, -21.777580254739934], [166.3740342583707, -21.77741711329186], [166.37365832372947, -21.77785688589102], [166.37423286535096, -21.777977468700467], [166.37437472747973, -21.777580254739934]], [[166.37000537391387, -21.781240297661977], [166.3701968877877, -21.78153111502594], [166.370962943283, -21.781460183961556], [166.37002665323317, -21.780765059530626], [166.37000537391387, -21.781240297661977]], [[166.3684519836039, -21.78155239434525], [166.3683739594331, -21.783815095298998], [166.3694748095523, -21.783792397358393], [166.36977839450782, -21.78274403622685], [166.3684519836039, -21.78155239434525]], [[166.37019688778767, -21.778232820532235], [166.3699202566366, -21.777970375594027], [166.36806895585624, -21.77846689304469], [166.3701685153619, -21.77972237288423], [166.37019688778767, -21.778232820532235]], [[166.35197233297956, -21.795294105884658], [166.3519817904548, -21.794764487270612], [166.3514048844645, -21.7946131676666], [166.351385969514, -21.795275190934156], [166.35197233297956, -21.795294105884658]], [[166.37976881937817, -21.78088840816248], [166.3792013441462, -21.78174907893097], [166.38177389853115, -21.780462801738498], [166.3815563663589, -21.780415512135836], [166.37976881937817, -21.78088840816248]]], [[[166.36658288810602, -21.77814640955779], [166.36635242409832, -21.777580254739938], [166.36627407785576, -21.777153702974786], [166.36644590603754, -21.777531672767363], [166.36658288810602, -21.77814640955779]]], [[[166.3662049201543, -21.77700157704409], [166.36622608902132, -21.777048142119707], [166.36621056196958, -21.77702226370014], [166.3662049201543, -21.77700157704409]]], [[[166.36605924236557, -21.776700709541615], [166.36605689554142, -21.776691322245], [166.3660872250411, -21.776742683554897], [166.36605924236557, -21.776700709541615]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 7.396363259685821, "forest_fragmentation_fragment_size_distribution": {"10": 0.0, "100": 0.0, "1000": 100.0, "1100": 100.0, "1200": 100.0, "12000": 100.0, "125": 0.0, "1300": 100.0, "1400": 100.0, "150": 0.0, "1500": 100.0, "1600": 100.0, "1700": 100.0, "17000": 100.0, "175": 0.0, "1800": 100.0, "1900": 100.0, "20": 0.0, "200": 0.0, "2000": 100.0, "225": 0.0, "250": 0.0, "27000": 100.0, "275": 0.0, "30": 0.0, "300": 0.0, "325": 0.0, "350": 0.0, "375": 0.0, "40": 0.0, "400": 0.0, "425": 30.97648685024572, "450": 30.97648685024572, "475": 30.97648685024572, "50": 0.0, "500": 30.97648685024572, "500000": 100.0, "60": 0.0, "600": 30.97648685024572, "70": 0.0, "700": 30.97648685024572, "7000": 100.0, "80": 0.0, "800": 30.97648685024572, "90": 0.0, "900": 100.0}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 231, "land_use_category_distribution": null, "name": "36.0", "num_families_unique_taxonomic_count": 1, "num_occurrences_count": 7, "num_species_unique_taxonomic_count": 1, "rainfall_mean": "3106.923095703125", "rainfall_range": "{\"min\": 2720.0, \"max\": 3460.0}", "shape_area": "1510.1565542437427", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[166.33710220747744, -21.787081107998628], [166.34374613239618, -21.78076851801479], [166.35212658001626, -21.780700176498236], [166.35516729934815, -21.783220252534708], [166.35532717392084, -21.777623205524932], [166.35852217217007, -21.77458604290434], [166.36407298568164, -21.774879159798733], [166.3666800550976, -21.778468405555646], [166.37178009898142, -21.775232512972877], [166.3723030402982, -21.76973754579591], [166.3765839878547, -21.766737376831824], [166.3808190715498, -21.766694598113634], [166.38669819905647, -21.771091399633253], [166.38661237559202, -21.77441086490227], [166.3833481621026, -21.77771029737503], [166.38284747339895, -21.78337508607544], [166.37637637178614, -21.79183300918597], [166.36808756746538, -21.7919444609339], [166.36350741346533, -21.789537611806], [166.36132990613422, -21.79364374148308], [166.35404833344052, -21.796464662675643], [166.34853684119955, -21.793205412842926], [166.349873577757, -21.8022089335714], [166.35232304592452, -21.800088432752545], [166.3560201117155, -21.79961561081472], [166.36191283312195, -21.80507799001581], [166.36329002949986, -21.813483825690827], [166.36612177024222, -21.818719601756854], [166.36588515441912, -21.826230615083915], [166.36271507950667, -21.829112871241183], [166.35497635187323, -21.829879723406258], [166.3513774431262, -21.826504056858596], [166.352305368925, -21.816927434329312], [166.34803739496044, -21.811446695124108], [166.34919380456225, -21.803392156656358], [166.34490010113404, -21.806043175501884], [166.33905891338594, -21.804161103274605], [166.33767393309998, -21.796437675903224], [166.3393426796715, -21.79295905321909], [166.33717699140777, -21.790345174885317], [166.33710220747744, -21.787081107998628]]]}, \"bbox\": [166.33710220747744, -21.829879723406258, 166.38669819905647, -21.766694598113634]}], \"bbox\": [166.33710220747744, -21.829879723406258, 166.38669819905647, -21.766694598113634]}", "shape_id": 231, "type": "hotspots"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "hotspots";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>