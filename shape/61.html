<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - Massif du Kouakoué</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">Massif du Kouakoué</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 7479.92126457508</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 6635.199167947226</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 78</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 406</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 4560</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 3768.6884765625</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 3040.0, "max": 4710.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 809.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 1481.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [158.0, 258.0, 358.0, 458.0, 558.0, 658.0, 758.0, 858.0, 958.0, 1058.0, 1158.0, 1258.0, 1358.0, 1458.0], "forest": [73.3445457653905, 202.25314135304654, 317.82636498335887, 522.302068329296, 782.3418214974988, 989.0400868363266, 999.0416158043344, 944.5888469785141, 764.5613255543738, 407.84012569542904, 310.0473980082417, 244.48181921796836, 65.56557879027334, 0.0], "non_forest": [5.556404982226554, 15.55793395023435, 14.44665295378904, 40.00611587203119, 64.45429779382802, 103.3491326694139, 122.24090960898418, 155.57933950234352, 127.79731459121074, 55.56404982226554, 31.1158679004687, 45.56252085425774, 53.34148782937491, 12.224090960898419]}, "elevation_max": 1481.0, "elevation_median": 809.0, "forest_area": "6635.199167947226", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[166.55088459146026, -21.972866779119663], [166.55115013892038, -21.972403967832033], [166.55218198047967, -21.972631579940703], [166.55160480798622, -21.972962635275998], [166.55088459146026, -21.972866779119663]]], [[[166.47751475039473, -21.938275390877696], [166.4794546, -21.9313276], [166.4780808, -21.9283449], [166.4786005, -21.9225443], [166.4821762, -21.9192022], [166.48111281244758, -21.91686039206679], [166.486205, -21.9142015], [166.49502167536582, -21.912696699758808], [166.49409067889485, -21.915487231964637], [166.49632250483006, -21.912579655549422], [166.50338387649506, -21.91115440092067], [166.5095842, -21.9192273], [166.5131507, -21.9205804], [166.51920946434495, -21.919380053888585], [166.52337008828297, -21.916053053644657], [166.5380632, -21.9131312], [166.5399890245115, -21.914416704378525], [166.5408943, -21.9180888], [166.5533342, -21.9156741], [166.5663560729774, -21.95304969537819], [166.56504352578844, -21.952954924927205], [166.56429483922565, -21.953608841039006], [166.56684965531412, -21.95446638357158], [166.56977435868913, -21.96336029619304], [166.5687793610856, -21.964160111633042], [166.57028163547625, -21.96431690984437], [166.5659621490603, -21.965651088800836], [166.56762176321584, -21.96529677210621], [166.56939447805703, -21.966599245982255], [166.5706401168676, -21.965345829067953], [166.57707193288218, -21.98380653386256], [166.57457693641877, -21.981702193429438], [166.57352729731323, -21.983686520442852], [166.5791818, -21.9872333], [166.5768322, -21.9946022], [166.55241477264275, -22.003498035780538], [166.5544659960417, -21.999825745289154], [166.5517118962443, -21.99785704618064], [166.55415901514684, -21.998957301191073], [166.55551536399588, -21.996927520395968], [166.5515127121476, -21.994205337740848], [166.54855340556784, -21.99623511853596], [166.54955406852991, -21.992792079149865], [166.54844432856248, -21.993569845622755], [166.5474673779929, -21.99208070737588], [166.546680126563, -21.99498310421374], [166.54489695464954, -21.995343532579227], [166.5490703357236, -21.9985873878686], [166.5517509, -22.0037399], [166.5495134942233, -22.003553598480377], [166.55015810844472, -22.002397193612456], [166.5340743, -22.0032302], [166.5225302, -21.9971195], [166.5118373, -22.0012962], [166.502512, -21.9914631], [166.50561085008465, -21.985535704053152], [166.50403571937738, -21.98297374446905], [166.5057052, -21.9807819], [166.5031451, -21.980806], [166.50240484232717, -21.977669539256112], [166.4988936616885, -21.977132918214526], [166.4990664, -21.9748197], [166.49636, -21.9728577], [166.49417483687242, -21.97409071764984], [166.4917875, -21.972785], [166.4936375, -21.9680551], [166.4911382, -21.9636194], [166.4876985, -21.9624986], [166.4911171, -21.9604631], [166.4901622, -21.9568679], [166.4873152, -21.9557984], [166.4905059, -21.9516495], [166.4872224, -21.9502936], [166.484938, -21.9458185], [166.4812128, -21.946485], [166.4806916, -21.9399872], [166.4777965, -21.9397336], [166.47751475039473, -21.938275390877696]], [[166.567788536831, -21.966170204857654], [166.56721964252213, -21.965904720846854], [166.56775061054375, -21.96688132274372], [166.56796868669548, -21.966710654451063], [166.567788536831, -21.966170204857654]], [[166.54702755935708, -21.96522576170941], [166.54664832046987, -21.96489392768311], [166.5470560022736, -21.965785139068025], [166.5478524039367, -21.966221263788302], [166.54702755935708, -21.96522576170941]], [[166.54291281743096, -21.959556140345814], [166.54274215993172, -21.95968887395633], [166.54351011867828, -21.96019136548187], [166.5434153089565, -21.959802645622492], [166.54291281743096, -21.959556140345814]], [[166.54186176841398, -21.95999309789066], [166.54167206927426, -21.961140777686023], [166.5422601366074, -21.961406356481643], [166.54194713302687, -21.95969906422408], [166.5407899682745, -21.960827774105468], [166.54186176841398, -21.95999309789066]], [[166.54318491991359, -21.95218697829079], [166.542890886247, -21.952149038462842], [166.54253994283852, -21.95286041023683], [166.54284346146207, -21.95299319963464], [166.54318491991359, -21.95218697829079]], [[166.53590521542648, -21.96859595387737], [166.5352697233084, -21.968852047716002], [166.5363794632758, -21.96924093095245], [166.5363889482328, -21.968833077802028], [166.53590521542648, -21.96859595387737]], [[166.53787334400124, -21.971270711747554], [166.53722836692614, -21.971223286962623], [166.5370576377004, -21.971725989682906], [166.5372757917111, -21.971782899424824], [166.53787334400124, -21.971270711747554]], [[166.5429857358169, -21.96872874327518], [166.54253045788155, -21.969013291984773], [166.54272964197827, -21.96950650974807], [166.54316594999963, -21.969440115049164], [166.5429857358169, -21.96872874327518]], [[166.53605223225975, -21.982927723883932], [166.53549261979757, -21.98339248677627], [166.53605223225975, -21.9839331293245], [166.53654545002306, -21.98377188505573], [166.53605223225975, -21.982927723883932]], [[166.53436865239465, -21.971033587822895], [166.53460577631932, -21.970815433812206], [166.53416946829793, -21.970094577081234], [166.53424534795383, -21.97161217019907], [166.53436865239465, -21.971033587822895]], [[166.53458680640534, -21.977103960294237], [166.53422637803985, -21.976753016885738], [166.53436865239465, -21.97494139010132], [166.53350552130888, -21.977132415165197], [166.53458680640534, -21.977103960294237]], [[166.55935677157547, -21.98452119665766], [166.55957492558613, -21.983857249668606], [166.55876870424228, -21.98396158419546], [166.55878767415626, -21.984284072732997], [166.55935677157547, -21.98452119665766]], [[166.5495682959654, -21.973888559875824], [166.54881898436346, -21.974324867897202], [166.54888537906237, -21.9746758113057], [166.54939756673963, -21.97480860070351], [166.5495682959654, -21.973888559875824]], [[166.55645911721612, -21.97896301186358], [166.5566108765279, -21.97848876401426], [166.55559598613036, -21.97878279768084], [166.55588053483996, -21.979067346390433], [166.55645911721612, -21.97896301186358]], [[166.55301607783, -21.982311201679806], [166.55268410433547, -21.982130987497065], [166.55232367597, -21.98279493448612], [166.5533670212385, -21.98281390440009], [166.55301607783, -21.982311201679806]], [[166.55361363012014, -21.980471120024433], [166.55486564444237, -21.980869488217863], [166.55555804630237, -21.979731293379487], [166.5531583521848, -21.978877647250705], [166.55361363012014, -21.980471120024433]], [[166.55970297250545, -21.98221635210994], [166.55920975474214, -21.982491415862548], [166.55957018310764, -21.983126907980644], [166.55995906634408, -21.982775964572145], [166.55970297250545, -21.98221635210994]], [[166.5681303567879, -21.97690477619752], [166.56754228945474, -21.976980655853414], [166.5674284699709, -21.97753078335863], [166.56793117269117, -21.97760666301452], [166.5681303567879, -21.97690477619752]], [[166.55561969852278, -21.99140727542984], [166.55519287545837, -21.99111324176326], [166.55546793921098, -21.992042767547932], [166.5556671233077, -21.991957402935054], [166.55561969852278, -21.99140727542984]], [[166.5549178117058, -21.984824715281224], [166.55333382388903, -21.984132313421213], [166.5527836963838, -21.98508080911986], [166.55336227876, -21.984805745367254], [166.5549178117058, -21.984824715281224]], [[166.5321017476748, -21.998416658642842], [166.53222505211562, -21.99807520019133], [166.53120067676107, -21.998435628556816], [166.53191204853508, -21.998843481707233], [166.5321017476748, -21.998416658642842]], [[166.5166128129159, -21.984506969222174], [166.5164041438622, -21.983824052319147], [166.51627135446438, -21.984753578103824], [166.51673611735671, -21.985417525092874], [166.5166128129159, -21.984506969222174]], [[166.54206302781495, -21.957311449301837], [166.54179734311734, -21.95705525334343], [166.5412185300261, -21.95697934342983], [166.54174989942132, -21.957871284914656], [166.54206302781495, -21.957311449301837]], [[166.5404973858469, -21.952026221567262], [166.54012732501806, -21.951542295868048], [166.53968135427567, -21.952263440047272], [166.54044994215087, -21.95254810222328], [166.5404973858469, -21.952026221567262]], [[166.52937658350413, -21.942157932798942], [166.5287028830209, -21.942575437323754], [166.5287503267169, -21.942812655803763], [166.52987948668175, -21.94280316706456], [166.52937658350413, -21.942157932798942]], [[166.52798173884167, -21.941598097186123], [166.52738394827207, -21.941579119707722], [166.52783940775367, -21.942632369758957], [166.52793429514568, -21.942575437323754], [166.52798173884167, -21.941598097186123]], [[166.5279912275809, -21.965130170402894], [166.5276401442305, -21.96564256231971], [166.52833282219214, -21.965718472233313], [166.52836128840974, -21.965471765014104], [166.5279912275809, -21.965130170402894]], [[166.49941114510952, -21.95641950781702], [166.50006586811435, -21.9558691609434], [166.49789294683748, -21.9557932510298], [166.49806374414308, -21.95610637942341], [166.49941114510952, -21.95641950781702]], [[166.53061723615446, -21.95684650108104], [166.53098729698328, -21.956125356901815], [166.53095883076568, -21.95590711590021], [166.52985813701844, -21.956447974034628], [166.53061723615446, -21.95684650108104]], [[166.5196245317909, -21.961657291855598], [166.52010845749012, -21.960945636415577], [166.51972890792212, -21.96050915441236], [166.5192449822229, -21.96078432784917], [166.5196245317909, -21.961657291855598]], [[166.52555973816075, -21.976900951380898], [166.52603417512077, -21.977195102296108], [166.52663196569037, -21.976844018945698], [166.52625241612236, -21.976559356769688], [166.52555973816075, -21.976900951380898]], [[166.51784539319087, -21.972953635873562], [166.51770306210287, -21.972450732695947], [166.51770306210287, -21.97436745801441], [166.51802567923568, -21.97385506609759], [166.51784539319087, -21.972953635873562]], [[166.5241221941719, -21.975297354456043], [166.52546959513833, -21.974101773316804], [166.5242929914775, -21.97274488361116], [166.5246156086103, -21.974082795838402], [166.5241221941719, -21.975297354456043]], [[166.50775886342095, -21.966216631041338], [166.50673407958732, -21.966216631041338], [166.50662021471692, -21.96650129321735], [166.50836614272976, -21.966216631041338], [166.50775886342095, -21.966216631041338]], [[166.51026507666236, -21.991580030923803], [166.50899358560952, -21.991893159317414], [166.50890818695672, -21.99225373140703], [166.50989501583354, -21.99281356701985], [166.51026507666236, -21.991580030923803]], [[166.5101595144387, -21.984662740046726], [166.5098938297411, -21.98418830308671], [166.50785493690552, -21.984501431480318], [166.50743743238067, -21.98554519279236], [166.50961984239677, -21.99007132139094], [166.50903154056635, -21.98533644052995], [166.5101595144387, -21.984662740046726]], [[166.5305358482867, -21.947092619246597], [166.52982550844666, -21.94595607550256], [166.52928565016825, -21.94574770914949], [166.52982550844666, -21.9473199279954], [166.5305358482867, -21.947092619246597]], [[166.5043865886262, -21.949732100317078], [166.50508511690217, -21.951691016569264], [166.50538882484824, -21.951630274980047], [166.5041410999886, -21.94916727832104], [166.5043865886262, -21.949732100317078]], [[166.5332130438627, -21.997373087406807], [166.5327292738887, -21.99755331543634], [166.53273875957444, -21.997885314438108], [166.53345967169258, -21.997818914637755], [166.5332130438627, -21.997373087406807]], [[166.53112843063613, -21.945097466843116], [166.53041759342454, -21.944699398004627], [166.53019960334632, -21.945372323898265], [166.5307682731156, -21.945760914907268], [166.53112843063613, -21.945097466843116]], [[166.5319487278993, -21.992351019893935], [166.5325710632267, -21.991804579118654], [166.5328215152487, -21.991053223052642], [166.5315151061108, -21.992516416295192], [166.5319487278993, -21.992351019893935]], [[166.5375466082783, -21.95747536710227], [166.53620903054698, -21.958320823334102], [166.53620903054698, -21.958681058346645], [166.53933663869347, -21.957573970472595], [166.5375466082783, -21.95747536710227]], [[166.51107596645457, -21.97461612227018], [166.51100769147334, -21.97414578351049], [166.51033252776992, -21.974327850127143], [166.51071941933031, -21.975018186048622], [166.51107596645457, -21.97461612227018]], [[166.53373710498994, -21.953411770513576], [166.53373710498994, -21.953927541989135], [166.53427003766816, -21.954227182631335], [166.53410077685376, -21.95355548101284], [166.53373710498994, -21.953411770513576]], [[166.52932960017554, -21.927944493086596], [166.52836301441653, -21.925821794949155], [166.52956650844985, -21.921585875005245], [166.5285189133604, -21.920212676720798], [166.52684739373183, -21.9248202652197], [166.527877358795, -21.928770447846084], [166.52569305816553, -21.933258345678425], [166.52858333911158, -21.93345734862881], [166.52817585687984, -21.930396493725265], [166.52932960017554, -21.927944493086596]], [[166.53208288379486, -21.920705722747385], [166.5324496821478, -21.917795342616966], [166.53030744068712, -21.92467641653209], [166.53101224170996, -21.927973066477602], [166.53098192768746, -21.92546458111676], [166.53348283454267, -21.923137979890846], [166.53208288379486, -21.920705722747385]], [[166.529519126795, -21.929545993020657], [166.5289410706058, -21.929849235611723], [166.52985325242037, -21.932355747089517], [166.5304219510289, -21.931180436631863], [166.529519126795, -21.929545993020657]], [[166.5270363280806, -21.936605859593833], [166.52711213872837, -21.93531707858181], [166.52427871576813, -21.934881167357158], [166.52488520095025, -21.937430300388286], [166.5270363280806, -21.936605859593833]], [[166.52023942969186, -21.93471770064792], [166.51967354732747, -21.93427984404842], [166.51908589209864, -21.934336713909275], [166.51963294450974, -21.935068324893834], [166.52023942969186, -21.93471770064792]], [[166.52032471667061, -21.93557057043528], [166.51922427679946, -21.93563859301423], [166.52095871959574, -21.937012878289966], [166.5208743438669, -21.936129673962554], [166.52032471667061, -21.93557057043528]], [[166.52180776246752, -21.93123988718166], [166.52464118542778, -21.931363079484278], [166.52376936297847, -21.93033015940847], [166.52516238363117, -21.929628910916637], [166.52631588710548, -21.92211524326659], [166.52329668352388, -21.92275943601383], [166.5217206986768, -21.92681977105447], [166.5203543105797, -21.926473821490266], [166.5204698229887, -21.92968162300755], [166.52288628738617, -21.92834546034071], [166.52180776246752, -21.93123988718166]], [[166.49022830212368, -21.92343671452549], [166.487877573094, -21.919995522149286], [166.4838144292091, -21.918366476116173], [166.48832335810158, -21.92389162653077], [166.4906453047952, -21.92488674654232], [166.49022830212368, -21.92343671452549]], [[166.4910196594662, -21.933283663973093], [166.4845910674342, -21.93406025098169], [166.48524796339922, -21.935624565333594], [166.4800259500623, -21.934145491762497], [166.481257205785, -21.9355188154532], [166.47840058998642, -21.937245189352392], [166.48523207838485, -21.93608735360271], [166.48657798368197, -21.938826555228506], [166.49114286480093, -21.934411466652847], [166.4927540114863, -21.935747770668357], [166.4904747127932, -21.936164773339854], [166.48778286111533, -21.93976191209759], [166.49282509148716, -21.938562538701014], [166.49110021680048, -21.940600165391324], [166.49234174748153, -21.941926992073387], [166.49379651816508, -21.9355392693326], [166.49575832618783, -21.934951674659118], [166.4923232960256, -21.933027046950084], [166.4940622653011, -21.926975794977224], [166.4924412594827, -21.92817538124715], [166.49213014093624, -21.92695685258149], [166.48849320095533, -21.926540119875344], [166.4925010534872, -21.930688162072947], [166.4909136856468, -21.9310964363995], [166.4874277500912, -21.926848554565087], [166.48649897141374, -21.92783419724319], [166.4841497518598, -21.92307809988356], [166.47979798562923, -21.922319622109168], [166.48012033868335, -21.92498377529173], [166.48230096228474, -21.925258723484944], [166.47964629007436, -21.926093049036776], [166.48578237173163, -21.92753256119197], [166.4844651689615, -21.928631809546907], [166.48039556867624, -21.927843674576632], [166.48470775539298, -21.92990025593383], [166.48265117403574, -21.932174815960224], [166.48769347741126, -21.929579437439095], [166.4910196594662, -21.933283663973093]], [[166.49734577953956, -21.934297738651523], [166.49619902219294, -21.93485690132468], [166.4980755342147, -21.93580463466901], [166.5004638222424, -21.933899690646903], [166.4979902382137, -21.932212725293994], [166.49734577953956, -21.934297738651523]], [[166.49343164082754, -21.942296608077683], [166.49293881948847, -21.942732565416073], [166.4930335928229, -21.94303584008626], [166.49369700616393, -21.942495632079993], [166.49343164082754, -21.942296608077683]], [[166.4926286898538, -21.944273414210656], [166.49193896081022, -21.945007125442466], [166.4918868956796, -21.9452260794396], [166.49332739015966, -21.945130330777232], [166.49305613452836, -21.943322916445503], [166.4926286898538, -21.944273414210656]], [[166.4907827261301, -21.94684572813047], [166.4925928968178, -21.946807818796696], [166.49233700881481, -21.94553785611529], [166.49144613947115, -21.945717925450715], [166.4907827261301, -21.94684572813047]], [[166.4938222975393, -21.961666873510502], [166.49339710641482, -21.961530204934768], [166.49278969052267, -21.962130028128268], [166.49342747720942, -21.962304660197262], [166.4938222975393, -21.961666873510502]], [[166.53773447778914, -21.93544903642448], [166.53648340429675, -21.9359797948758], [166.53625593638904, -21.9363683858848], [166.5374501429045, -21.93606509534119], [166.53773447778914, -21.93544903642448]], [[166.51114477703302, -21.923360895857943], [166.5106993423612, -21.922365775846394], [166.5099127236854, -21.922280479845405], [166.51079411569563, -21.924175946534067], [166.51114477703302, -21.923360895857943]], [[166.49445045417266, -21.931511402619194], [166.49385338216572, -21.931577743953298], [166.49368279016375, -21.931994746624802], [166.49471581950908, -21.93224115729433], [166.49445045417266, -21.931511402619194]], [[166.4877831500953, -21.926355733226032], [166.4883044034347, -21.925474341215807], [166.49025673412402, -21.926024026555517], [166.4887877474403, -21.924555039871805], [166.4877831500953, -21.926355733226032]], [[166.49262606748485, -21.923673647861577], [166.4924839074832, -21.92270695985036], [166.49225645148056, -21.922432117180502], [166.49255972615074, -21.9244886985377], [166.49262606748485, -21.923673647861577]], [[166.49245073681612, -21.926355733226032], [166.4929909448224, -21.925739706552218], [166.49215693947937, -21.925389045214814], [166.49177784614164, -21.926441029227025], [166.49245073681612, -21.926355733226032]], [[166.4783207902331, -21.936112739177595], [166.47891791885422, -21.936453955532517], [166.47940130869034, -21.93608430448135], [166.47880418006923, -21.935923174535972], [166.4783207902331, -21.936112739177595]], [[166.52346218739777, -21.917529891755542], [166.5242011863876, -21.917425673949285], [166.52434330157794, -21.91708459749244], [166.52274213709998, -21.917264610066887], [166.52346218739777, -21.917529891755542]], [[166.51839154515258, -21.934537650359474], [166.51767134399879, -21.933599493593373], [166.51717857478832, -21.93369425690308], [166.51798406292082, -21.935238898851306], [166.51839154515258, -21.934537650359474]], [[166.5231889377065, -21.936027803404624], [166.5234447986427, -21.934653735413868], [166.52145476913884, -21.93350709936641], [166.52132210050527, -21.935430794553465], [166.5231889377065, -21.936027803404624]], [[166.52450377862874, -21.937288155423722], [166.52356562186264, -21.937686161324496], [166.52359405085556, -21.93827369384468], [166.52458906560747, -21.938595889097684], [166.52450377862874, -21.937288155423722]], [[166.53065628651154, -21.929773424963955], [166.53107324507425, -21.930294623167345], [166.53136701133437, -21.92958389834454], [166.53111115039815, -21.92942280071804], [166.53065628651154, -21.929773424963955]], [[166.56463989261695, -21.96859595387737], [166.5624298976391, -21.970085092124243], [166.56718527182431, -21.967177621862923], [166.56639830136376, -21.96699747199845], [166.56463989261695, -21.96859595387737]], [[166.5652664387284, -21.955399139276707], [166.56439908672172, -21.955295755066548], [166.56433274740604, -21.955731699141083], [166.56535177287472, -21.955882699439233], [166.5652664387284, -21.955399139276707]], [[166.5680955027185, -21.98164650045138], [166.5693254613682, -21.981078157271572], [166.55937099901098, -21.977056535509305], [166.55844971084025, -21.978359030291116], [166.55663933139886, -21.975832976058044], [166.55739812795778, -21.97468529626268], [166.55583894835897, -21.974437302669486], [166.55614611363558, -21.97232354197305], [166.5531678371418, -21.970160971780132], [166.54999986150833, -21.96970569384478], [166.5483067966862, -21.971337106446462], [166.5478135789229, -21.96940217522122], [166.54695519031566, -21.97136556131742], [166.54552770428916, -21.971081012607826], [166.5498101623686, -21.97387907491883], [166.54963943314286, -21.974979329929262], [166.54833050907868, -21.976003705283805], [166.54926951982037, -21.978659493240016], [166.55033183500285, -21.976847866455596], [166.55725585360298, -21.97834648965946], [166.55620302337744, -21.984407377173817], [166.55929511935503, -21.983496821303117], [166.55864065732297, -21.98208356271213], [166.56002546104304, -21.980233996099773], [166.56049970889237, -21.9816187998198], [166.5611731408384, -21.982121502540082], [166.56146241215765, -21.97888120907679], [166.56470110000902, -21.980432859259164], [166.5628092959185, -21.981960258271315], [166.56426621227195, -21.98322848082431], [166.56620491051964, -21.981789529045557], [166.5683390258416, -21.98301308849681], [166.5680955027185, -21.98164650045138]], [[166.57188165727607, -21.983117423023664], [166.57302933707143, -21.984084888636286], [166.57393040798516, -21.98059442446526], [166.5691574387617, -21.98169390831045], [166.57188165727607, -21.983117423023664]], [[166.5446999806869, -21.962893442553145], [166.54292703888922, -21.962751227970447], [166.54437762763277, -21.96474223212823], [166.54504129568534, -21.9636708822719], [166.5446999806869, -21.962893442553145]], [[166.54301236763885, -21.958295171045886], [166.5422192673353, -21.958605219396635], [166.54222874720406, -21.9591171323092], [166.54303132958321, -21.958484790489482], [166.54301236763885, -21.958295171045886]], [[166.54559119207178, -21.95991641728865], [166.54446295638238, -21.959489773540554], [166.54419748916135, -21.96015344159315], [166.54447073616367, -21.96034477531248], [166.54559119207178, -21.95991641728865]], [[166.54618849331914, -21.96223451498664], [166.54786452917662, -21.96069553045627], [166.5505402595497, -21.961670397141937], [166.54828164340165, -21.96021205714996], [166.54524039610112, -21.96157558742014], [166.54371395958017, -21.960456832702906], [166.54564807790487, -21.963519186717022], [166.5482743071987, -21.96392686852076], [166.54618849331914, -21.96223451498664]], [[166.5060275566367, -21.975588637170198], [166.50518616005857, -21.97491533358306], [166.50472009469206, -21.976454980638472], [166.50620050601495, -21.976479511927007], [166.5060275566367, -21.975588637170198]], [[166.50440933848324, -21.96950922354385], [166.50555510374173, -21.970320510745484], [166.50376410421762, -21.973522960225576], [166.50437138352643, -21.975079113454427], [166.50510913299925, -21.97278283856795], [166.50656328228172, -21.973437561572773], [166.50734135889613, -21.967668408138987], [166.50440933848324, -21.96950922354385]], [[166.51027337930904, -21.975990032417656], [166.51040956774048, -21.975654763345652], [166.5096186563042, -21.97551559545764], [166.5096945662178, -21.97580025763365], [166.51027337930904, -21.975990032417656]], [[166.51428474380594, -21.979851949272188], [166.51167709094972, -21.981743216769217], [166.51065288804674, -21.980178462334116], [166.51037787060056, -21.98181908365092], [166.50836614272976, -21.982186179115455], [166.51175295783142, -21.98192340061326], [166.5128139892299, -21.983884663432317], [166.5153945681531, -21.9821035844573], [166.51267284377204, -21.982274284941127], [166.51428474380594, -21.979851949272188]], [[166.5238713443068, -21.978483672486245], [166.52871474394485, -21.979709618184184], [166.530024425857, -21.978195365335928], [166.527538140284, -21.97746078699371], [166.5238713443068, -21.978483672486245]], [[166.52228137876702, -21.978514037044942], [166.5211977102684, -21.978778612846867], [166.52289814681504, -21.981521967371442], [166.52230984498462, -21.982793458424286], [166.5241506603895, -21.98346715890751], [166.5249382257431, -21.980383318667403], [166.52228137876702, -21.978514037044942]], [[166.51971467481334, -21.979472399704175], [166.51760817471086, -21.9801461001874], [166.51651696970282, -21.978542503262545], [166.51597611156842, -21.980250476318602], [166.52061610503736, -21.98411239317313], [166.52156823565159, -21.979751711124546], [166.51971467481334, -21.979472399704175]], [[166.51351852811553, -21.975800257633658], [166.51458126690596, -21.975610482849653], [166.51336670828832, -21.974538255320017], [166.51285431637152, -21.975496617979246], [166.51351852811553, -21.975800257633658]], [[166.51346159568033, -21.97385506609759], [166.51429660472996, -21.973551426443183], [166.51313897854752, -21.97163470112472], [166.51388858894435, -21.97345653905118], [166.51346159568033, -21.97385506609759]], [[166.52516121111432, -21.971435437601517], [166.5248006390247, -21.97026832267988], [166.52208685961344, -21.97216607051994], [166.52370293360852, -21.972731525447713], [166.52516121111432, -21.971435437601517]], [[166.52316857588227, -21.977090726164903], [166.52271311640064, -21.977754937908927], [166.5242787583687, -21.976749131553692], [166.5241666763499, -21.975740249754555], [166.52316857588227, -21.977090726164903]], [[166.52928644048163, -21.958013616002656], [166.53050337128406, -21.958355210613888], [166.52806476530958, -21.954654602325768], [166.52292186866302, -21.95803259348108], [166.5251612111143, -21.95797566104588], [166.5255882043783, -21.963412708607656], [166.5283494274856, -21.963431686086057], [166.52795801699358, -21.959465393100302], [166.53024717532574, -21.959797498972332], [166.52797699447197, -21.958013616002656], [166.52928644048163, -21.958013616002656]], [[166.5055361262633, -21.956656726297027], [166.50963526159785, -21.956542861426623], [166.50970168277226, -21.953316690098518], [166.50853456785063, -21.9527758319641], [166.50873383137383, -21.954407895106552], [166.50633318035614, -21.9528612306169], [166.50666528622816, -21.95412323293054], [166.5047936324209, -21.95356339731773], [166.5015366226904, -21.955489611375388], [166.5022957218264, -21.95761508895626], [166.5055361262633, -21.956656726297027]], [[166.53283048457308, -21.96685712093735], [166.53450050267233, -21.968432251644604], [166.53518369189476, -21.967312580418966], [166.5335800949699, -21.964921418140488], [166.53283048457308, -21.96685712093735]], [[166.5300597727266, -21.96327037751963], [166.52929118485136, -21.964570334790075], [166.53250786744027, -21.96559511862371], [166.5330107706179, -21.964238228918067], [166.5300597727266, -21.96327037751963]], [[166.531217398909, -21.946873836181496], [166.53154001604182, -21.94813583849514], [166.53239400256984, -21.948202259669543], [166.53180135652977, -21.945505013511095], [166.5309293962169, -21.945884126690608], [166.53008586939248, -21.94577987056624], [166.531217398909, -21.946873836181496]], [[166.53031596868496, -21.949473750722376], [166.5276723020251, -21.942774181749414], [166.52611447606276, -21.942287587937], [166.53005028398735, -21.95177002560886], [166.52769707666567, -21.952861230616893], [166.5281240699297, -21.95403783427773], [166.53156214218689, -21.955935637550233], [166.5322220262806, -21.956785143509975], [166.5326905310761, -21.954669231699725], [166.53494647341472, -21.956039958248997], [166.53031596868496, -21.949473750722376]], [[166.5347045105651, -21.948676696629548], [166.5341019756259, -21.94473886986143], [166.5319530018016, -21.945031122036706], [166.53388647901713, -21.948575830265167], [166.5347045105651, -21.948676696629548]], [[166.5353497448307, -21.948970847544757], [166.53627015253315, -21.949473750722373], [166.53684892168755, -21.94940500677359], [166.53571031692033, -21.948411011931938], [166.5353497448307, -21.948970847544757]], [[166.5198282133343, -21.989723695564734], [166.51832959013043, -21.989771120349666], [166.5179976166359, -21.990416097424745], [166.51890817250663, -21.99056785673653], [166.5198282133343, -21.989723695564734]], [[166.51481142988507, -21.98543270102408], [166.51354917180927, -21.985417525092874], [166.51648950847508, -21.98718172709236], [166.51810195116278, -21.986223746436725], [166.51481142988507, -21.98543270102408]], [[166.5138811453038, -21.98441211965231], [166.51287573986323, -21.984080146157783], [166.51245840175582, -21.985341645436982], [166.5136724762501, -21.98491482237259], [166.5138811453038, -21.98441211965231]], [[166.53691062086696, -21.990942512537508], [166.53465320110416, -21.99021217084955], [166.53477650554498, -21.991540064827653], [166.53043239524519, -21.994195852783864], [166.53126707146, -21.99453731123538], [166.53160852991152, -21.99577035564362], [166.5303565155893, -21.994945164385797], [166.52871561803065, -21.996842155783092], [166.53131449624493, -21.998094170105308], [166.53331582216907, -21.99300074820357], [166.5340673044118, -21.99657519214194], [166.5356111817598, -21.997183614234604], [166.53423586299678, -21.996235118535957], [166.53441607717951, -21.993541390751798], [166.5371477447916, -21.99471752541812], [166.53691062086696, -21.990942512537508]], [[166.5446645732034, -21.9902406257205], [166.54603040700945, -21.990743328440782], [166.5450819113108, -21.98819187501142], [166.5465425946867, -21.987584837764285], [166.5448732422571, -21.98553608705521], [166.5436876226338, -21.986162094216315], [166.5446645732034, -21.9902406257205]], [[166.55203438478188, -21.990012986752827], [166.5541969549748, -21.988353119280195], [166.55506957101755, -21.989529253946518], [166.55551536399594, -21.987252864269763], [166.55801939264035, -21.98658891728071], [166.55601295307753, -21.98446359897901], [166.55203438478188, -21.990012986752827]], [[166.542132089688, -21.978137820605763], [166.54372677193146, -21.980825767545237], [166.54615371145024, -21.982709569873247], [166.54628650084805, -21.980556484637315], [166.54475942277327, -21.9802150261858], [166.54673229382644, -21.98008223678799], [166.54513882105272, -21.978374944530426], [166.5460588618804, -21.97636413364929], [166.54287364087065, -21.97600744178199], [166.542132089688, -21.978137820605763]], [[166.54022561333377, -21.97478014583255], [166.53995054958116, -21.976496923047105], [166.54516727592372, -21.97520696889694], [166.53867956534498, -21.972873669478272], [166.54022561333377, -21.97478014583255]], [[166.54302367564478, -21.97208641804839], [166.5415914471398, -21.971678564897974], [166.5424221447593, -21.97349269338416], [166.54264974540442, -21.973312509540115], [166.54302367564478, -21.97208641804839]], [[166.5365969458489, -21.972304735619804], [166.53620873405004, -21.97050243023165], [166.5352507533944, -21.97400237935966], [166.5364268880607, -21.97357555629527], [166.5365969458489, -21.972304735619804]], [[166.5305319872936, -21.984236647948066], [166.53186428765852, -21.98664716575464], [166.53081179352463, -21.987859901516895], [166.53310715311537, -21.98868509277472], [166.53324942747017, -21.986057759689466], [166.53142431717598, -21.985509311058397], [166.53270878492194, -21.98515668877575], [166.5327230123575, -21.98271905483023], [166.5305319872936, -21.984236647948066]], [[166.5359478977329, -21.980414210282518], [166.53679932980143, -21.98021110510697], [166.53693591954035, -21.98008210368687], [166.53593841277592, -21.979920992519222], [166.5359478977329, -21.980414210282518]], [[166.53947155925343, -21.983487336346133], [166.53438762230866, -21.979636443809625], [166.5329316814112, -21.98084103334691], [166.5344087053795, -21.982473435505614], [166.5337900700185, -21.984340982474915], [166.53565386406632, -21.982036137927206], [166.53947155925343, -21.983487336346133]], [[166.53852306355478, -21.9741825935424], [166.5386368830386, -21.97388855987582], [166.5383902741569, -21.973272037671702], [166.53805830066244, -21.973935984660752], [166.53852306355478, -21.9741825935424]], [[166.5356586065448, -21.956237054924014], [166.53432122760972, -21.95678718242923], [166.53515590382455, -21.95769773829993], [166.53617111107195, -21.9570979202652], [166.5356586065448, -21.956237054924014]], [[166.53657864737252, -21.95474791667714], [166.53534560296427, -21.955193709655504], [166.53702444035088, -21.95649314876265], [166.5378405388708, -21.95489182080576], [166.53657864737252, -21.95474791667714]], [[166.5391111308879, -21.955411863666193], [166.53830490954405, -21.954937615816867], [166.53794448117856, -21.955231649483448], [166.53869452539882, -21.9561633118586], [166.5391111308879, -21.955411863666193]], [[166.54515779096678, -21.955620532719895], [166.54405753595634, -21.954596157365355], [166.54250899855737, -21.95498670819776], [166.5439512869158, -21.956134845641], [166.54515779096678, -21.955620532719895]], [[166.54281263821176, -21.956039958248997], [166.54326079956948, -21.95762185864404], [166.54537594497745, -21.957555463945134], [166.54473096790238, -21.956635423117447], [166.54281263821176, -21.956039958248997]], [[166.53892143174818, -21.96098901837424], [166.54005014162956, -21.96149172109452], [166.5402227147584, -21.95969460972043], [166.5395480067097, -21.95980706106187], [166.53892143174818, -21.96098901837424]], [[166.53323748532134, -21.949876067750115], [166.53206189669783, -21.949521194418384], [166.53209985165464, -21.951143768821638], [166.53469279919463, -21.95212992669932], [166.53619898698918, -21.950318248511213], [166.53393386204675, -21.948840954582913], [166.53323748532134, -21.949876067750115]], [[166.53779783293987, -21.953071155374747], [166.53627803799452, -21.95144728798167], [166.53708961958105, -21.950317141660225], [166.53468165597522, -21.952471527000384], [166.53586727559852, -21.954055514817124], [166.53638422623948, -21.95251675530599], [166.53779783293987, -21.953071155374747]], [[166.5378721604547, -21.99097101360035], [166.53798242100643, -21.992678259666032], [166.5396850284433, -21.99243850504199], [166.5387032777374, -21.993190447343302], [166.5389119467911, -21.995068468826624], [166.54014499119933, -21.99338014648303], [166.54400062621437, -21.99484082985894], [166.54394371647243, -21.992109162246837], [166.5425778826664, -21.99355087570878], [166.5416341294462, -21.99351293588084], [166.54271541454267, -21.99214710207479], [166.5415013400484, -21.990164746064615], [166.5378721604547, -21.99097101360035]]], [[[166.52946980162596, -21.954091428172614], [166.5293075381999, -21.953487619259977], [166.53002321833605, -21.953202230019933], [166.53037290112016, -21.954189654104937], [166.52946980162596, -21.954091428172614]]], [[[166.52336060997283, -21.9269151970678], [166.52281912341826, -21.926231222178682], [166.5241093964741, -21.925408145755164], [166.5239198302712, -21.926905718757656], [166.52336060997283, -21.9269151970678]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 66.28618697452922, "forest_fragmentation_fragment_size_distribution": {"10": 0.04960472697302067, "100": 0.04960472697302067, "1000": 0.04960472697302067, "1100": 0.04960472697302067, "1200": 0.04960472697302067, "12000": 100.0, "125": 0.04960472697302067, "1300": 0.04960472697302067, "1400": 0.04960472697302067, "150": 0.04960472697302067, "1500": 0.04960472697302067, "1600": 0.04960472697302067, "1700": 0.04960472697302067, "17000": 100.0, "175": 0.04960472697302067, "1800": 0.04960472697302067, "1900": 0.04960472697302067, "20": 0.04960472697302067, "200": 0.04960472697302067, "2000": 0.04960472697302067, "225": 0.04960472697302067, "250": 0.04960472697302067, "27000": 100.0, "275": 0.04960472697302067, "30": 0.04960472697302067, "300": 0.04960472697302067, "325": 0.04960472697302067, "350": 0.04960472697302067, "375": 0.04960472697302067, "40": 0.04960472697302067, "400": 0.04960472697302067, "425": 0.04960472697302067, "450": 0.04960472697302067, "475": 0.04960472697302067, "50": 0.04960472697302067, "500": 0.04960472697302067, "500000": 100.0, "60": 0.04960472697302067, "600": 0.04960472697302067, "70": 0.04960472697302067, "700": 0.04960472697302067, "7000": 100.0, "80": 0.04960472697302067, "800": 0.04960472697302067, "90": 0.04960472697302067, "900": 0.04960472697302067}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 61, "land_use_category_distribution": null, "name": "Massif du Kouakou\u00e9", "num_families_unique_taxonomic_count": 78, "num_occurrences_count": 4560, "num_species_unique_taxonomic_count": 406, "rainfall_mean": "3768.6884765625", "rainfall_range": "{\"min\": 3040.0, \"max\": 4710.0}", "shape_area": "7479.92126457508", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[166.5224474, -21.9162772], [166.5380632, -21.9131312], [166.539949, -21.9140665], [166.5408943, -21.9180888], [166.5533342, -21.9156741], [166.5791818, -21.9872333], [166.5768322, -21.9946022], [166.5517509, -22.0037399], [166.5340743, -22.0032302], [166.5225302, -21.9971195], [166.5118373, -22.0012962], [166.5029874, -21.9925115], [166.502793, -21.9895663], [166.5055826, -21.9853448], [166.5040879, -21.9821899], [166.5057052, -21.9807819], [166.5031451, -21.980806], [166.5024531, -21.9787142], [166.5002952, -21.9785393], [166.4990664, -21.9748197], [166.49636, -21.9728577], [166.4921623, -21.9736301], [166.4919443, -21.9698583], [166.4936375, -21.9680551], [166.4911382, -21.9636194], [166.4876985, -21.9624986], [166.4911171, -21.9604631], [166.4901622, -21.9568679], [166.4873152, -21.9557984], [166.4905059, -21.9516495], [166.4872224, -21.9502936], [166.484938, -21.9458185], [166.4812128, -21.946485], [166.4806916, -21.9399872], [166.4775311, -21.939397], [166.4772623, -21.9357791], [166.4794546, -21.9313276], [166.4780808, -21.9283449], [166.4786005, -21.9225443], [166.4821762, -21.9192022], [166.4809368, -21.9169786], [166.4828128, -21.9157187], [166.4941827, -21.9124197], [166.499568, -21.9123725], [166.5007665, -21.910631], [166.5047308, -21.9117799], [166.5107933, -21.9203808], [166.5192939, -21.9189246], [166.5224474, -21.9162772]]]}, \"bbox\": [166.4772623, -22.0037399, 166.5791818, -21.910631]}], \"bbox\": [166.4772623, -22.0037399, 166.5791818, -21.910631]}", "shape_id": 61, "type": "protected_areas"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "protected_areas";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>