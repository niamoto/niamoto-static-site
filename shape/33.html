<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - BELEP</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">BELEP</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 6464.496969438019</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 917.2929000309467</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 68</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 232</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 1592</p>
                        
                    
                
            
                
                    
                        
                        
                    
                
                    
                        
                        
                    
                
            
                
                    
                        
                        
                    
                
                    
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": null, "elevation_max": null, "elevation_median": null, "forest_area": "917.2929000309467", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[163.6066477773851, -19.59864847407052], [163.60476139159672, -19.59980977252885], [163.60261057315438, -19.598272993530518], [163.60593131536973, -19.597510064374806], [163.6066477773851, -19.59864847407052]]], [[[163.5948117341132, -19.59775686991547], [163.59705451901948, -19.596662936883074], [163.59304778712928, -19.599929381684777], [163.59188597169054, -19.59934762599466], [163.5948117341132, -19.59775686991547]]], [[[163.58918969664197, -19.594597853963425], [163.58951446942484, -19.596169840294984], [163.5859684089033, -19.59500921586809], [163.5869194587782, -19.594385771769442], [163.58918969664197, -19.594597853963425]]], [[[163.5847759937795, -19.593759045569577], [163.58427393210962, -19.593217415941282], [163.58455571853088, -19.592990390498862], [163.5855547832902, -19.59379395534654], [163.5847759937795, -19.593759045569577]]], [[[163.58620420934398, -19.590151968880395], [163.58583295529223, -19.589516394576112], [163.59186062618127, -19.58744653842276], [163.5891033508056, -19.589206857116203], [163.59457731188868, -19.58912785569955], [163.59276621818074, -19.59033258599585], [163.5886320651163, -19.58939222308117], [163.58528883375007, -19.592221095305938], [163.58620420934398, -19.590151968880395]]], [[[163.59563935869988, -19.589180165047853], [163.5957091109897, -19.585206688922582], [163.5979090878468, -19.584826162946936], [163.59799400545276, -19.58169619309112], [163.59893605079927, -19.584815698428756], [163.60194237917048, -19.585344903350922], [163.60208131858454, -19.587363983003936], [163.60615821482796, -19.590469153196917], [163.6035479966631, -19.593073572862416], [163.6012070827814, -19.592536737586737], [163.6003553057941, -19.594755593575695], [163.59945590421543, -19.593365552327345], [163.59717282641532, -19.595275895311296], [163.59563935869988, -19.589180165047853]]], [[[163.58671737594338, -19.586312160193636], [163.58883087030483, -19.58691367310478], [163.58902480147128, -19.5872162466466], [163.58620867527142, -19.58656299444885], [163.58628202884745, -19.58507220019721], [163.58671737594338, -19.586312160193636]]], [[[163.58712329380316, -19.583717496868296], [163.58890851348673, -19.584031075233906], [163.58431048671824, -19.584726450306636], [163.58507955806226, -19.584137614148027], [163.58712329380316, -19.583717496868296]]], [[[163.60410149954768, -19.583063550695506], [163.60499985989864, -19.583514367386584], [163.60212246260068, -19.583857830900147], [163.6038106754523, -19.583331071091077], [163.60410149954768, -19.583063550695506]]], [[[163.6036394277849, -19.581510084495765], [163.60461827809806, -19.582134273002914], [163.60009751837325, -19.581726543339656], [163.60266662899892, -19.58122335157975], [163.6036394277849, -19.581510084495765]]], [[[163.59228588343126, -19.578553596397573], [163.59525548115954, -19.578176069802584], [163.59323928570186, -19.57979459983702], [163.59486187671064, -19.580760706289254], [163.5932104135365, -19.580152579235172], [163.59305746359675, -19.57948209684828], [163.59225344037642, -19.580571747079787], [163.59112345885507, -19.578264668806703], [163.59228588343126, -19.578553596397573]]], [[[163.59303180418024, -19.574546567572764], [163.59357451320187, -19.57521422568993], [163.5918498444613, -19.57436539786466], [163.5931450567874, -19.5741426906999], [163.59303180418024, -19.574546567572764]]], [[[163.5966241492241, -19.573136646692323], [163.59588497498598, -19.572895221166917], [163.59586886688504, -19.572421285625705], [163.59698998079637, -19.573091305255392], [163.5966241492241, -19.573136646692323]]], [[[163.59103466743804, -19.572354842419113], [163.59312320173063, -19.571446055645428], [163.5950184035445, -19.572327975804964], [163.59347609700646, -19.572422234810436], [163.5941015075802, -19.57351185076842], [163.58936221122852, -19.573280806803535], [163.59103466743804, -19.572354842419113]]], [[[163.59693355033866, -19.569774111901324], [163.59750594297924, -19.569922081055154], [163.59749816983225, -19.57079775221418], [163.5962186474725, -19.570612568818635], [163.59693355033866, -19.569774111901324]]], [[[163.58941112410278, -19.56627789432196], [163.59395452670793, -19.566549208059065], [163.59512553264474, -19.57113013262351], [163.5892966572433, -19.571131758883215], [163.58939251434026, -19.569735499414456], [163.59297232104967, -19.56974373718557], [163.59139616103053, -19.567963968739967], [163.5889841669058, -19.568126501457773], [163.59095407291622, -19.567090096355], [163.58842268602783, -19.566266868120167], [163.58814898539723, -19.56567716848653], [163.58941112410278, -19.56627789432196]]], [[[163.5836487557678, -19.56281718007348], [163.58476789355205, -19.563578812058296], [163.58474963050995, -19.563894379964584], [163.58324320590486, -19.56423884145187], [163.58251833242792, -19.562994544050404], [163.5836487557678, -19.56281718007348]]], [[[163.58349692059087, -19.560660103431026], [163.5859109947578, -19.562873787495477], [163.5853409360577, -19.55944417782794], [163.58792920400154, -19.56449498698306], [163.5847163119323, -19.562888336683933], [163.58281847468723, -19.560046180861416], [163.58349692059087, -19.560660103431026]]], [[[163.5789011036823, -19.560417432320644], [163.58041845193938, -19.560187037074396], [163.58061816080541, -19.56064172486603], [163.5787827245018, -19.56170159290522], [163.5789011036823, -19.560417432320644]]], [[[163.57969800614984, -19.559207557047433], [163.57771663160727, -19.56068319217749], [163.57744692111103, -19.560534301429335], [163.57879164654366, -19.55890804347571], [163.57969800614984, -19.559207557047433]]], [[[163.58428418118066, -19.55797921516731], [163.58465321047376, -19.558472483097002], [163.58452197196505, -19.559057151098116], [163.583480613063, -19.55812162485789], [163.58428418118066, -19.55797921516731]]], [[[163.5717593568684, -19.55574752188811], [163.57399126853502, -19.553746855900624], [163.575957200491, -19.555528199921113], [163.57630715517791, -19.55418181385621], [163.57793420826798, -19.554646754315517], [163.57649144854523, -19.555802928812724], [163.57822729662757, -19.556850200815674], [163.575578419639, -19.55608377573076], [163.57281974222218, -19.557527197725467], [163.5717593568684, -19.55574752188811]]], [[[163.57414133748807, -19.55067989042582], [163.57434364377937, -19.55133324148564], [163.57369068127565, -19.551465551488157], [163.5734878195555, -19.551156980370994], [163.57414133748807, -19.55067989042582]]], [[[163.57482427841606, -19.54403229046528], [163.57678783854274, -19.544084415847216], [163.57498881828297, -19.544830177930752], [163.57728323119187, -19.547202233358163], [163.5776282626005, -19.54858730228096], [163.5789165239537, -19.547952675376184], [163.57986970182557, -19.54858815746384], [163.58026693428786, -19.54976188475275], [163.57898208777846, -19.548506706177523], [163.57815856490336, -19.54946670595294], [163.57958730177793, -19.55226009803852], [163.57806935444444, -19.552233681230604], [163.57715660987145, -19.548579636976818], [163.57564010348747, -19.549149849051098], [163.57482427841606, -19.54403229046528]]], [[[163.65542398201657, -19.7157794490879], [163.6566656176242, -19.717365285713985], [163.6580251063675, -19.71798160722537], [163.65575668444353, -19.71762745176111], [163.65542398201657, -19.7157794490879]]], [[[163.6499354516106, -19.698086862690545], [163.65305118308305, -19.695526152427636], [163.65470239056125, -19.699171317400705], [163.6569837844188, -19.700032464619184], [163.65502889574037, -19.706007179901285], [163.65487655382776, -19.70303236229956], [163.65074356604126, -19.702099416917946], [163.65309199504242, -19.69816964656648], [163.6505960375513, -19.6991511031652], [163.64903611103244, -19.698536425704177], [163.6499354516106, -19.698086862690545]]], [[[163.64220048638407, -19.69323041689749], [163.64408456012512, -19.695285832612065], [163.64464863822158, -19.69992505999643], [163.65081180276255, -19.704326688026445], [163.64997524015152, -19.702288089734378], [163.65259381496378, -19.703776751511516], [163.65296148742735, -19.705945043056534], [163.6510595619186, -19.706036966676447], [163.644492379562, -19.700634360444127], [163.64250629847348, -19.701628174319517], [163.64360204861626, -19.69967899361898], [163.64225634833807, -19.698704137611166], [163.64220048638407, -19.69323041689749]]], [[[163.64553432651184, -19.686522582698263], [163.6470064224113, -19.686971776440355], [163.6463031914383, -19.684999427062227], [163.64821454233078, -19.68674198942547], [163.65011596665698, -19.685884373038053], [163.64737936361567, -19.684503052976968], [163.64792823349867, -19.683457713636557], [163.6534089282558, -19.68299812741794], [163.65035371191325, -19.68530202912498], [163.64972207688388, -19.689311920849697], [163.65176360168235, -19.692654557636065], [163.65363841376177, -19.69041396887241], [163.65219458626052, -19.693038696054305], [163.6520732176746, -19.694377126194766], [163.65379443751553, -19.69323165519893], [163.6529317235341, -19.694745706933766], [163.64794830948708, -19.69636101578539], [163.65170789392957, -19.693256792727976], [163.6470488846797, -19.69361682614336], [163.6470419821008, -19.692294847429636], [163.64871207611523, -19.69228675432568], [163.6473886389822, -19.690156848491874], [163.64878134448836, -19.689464195166288], [163.64430701217105, -19.689286784809735], [163.6433870096822, -19.687761432910502], [163.64553432651184, -19.686522582698263]]], [[[163.65178571729768, -19.678154017694016], [163.6513815491789, -19.677634901413544], [163.65167386683927, -19.677343939130928], [163.65239277092377, -19.677972279571943], [163.65178571729768, -19.678154017694016]]], [[[163.64953098708463, -19.675254354356877], [163.64745894675562, -19.674127164092223], [163.64804992448674, -19.673149420890216], [163.65017492387048, -19.67429115319225], [163.64953098708463, -19.675254354356877]]], [[[163.65294484089407, -19.673522859490088], [163.6494782671046, -19.672557292502926], [163.64946260210493, -19.67171132558555], [163.65284998932847, -19.673099329891688], [163.65294484089407, -19.673522859490088]]], [[[163.6469361228577, -19.67291107014982], [163.64644808301549, -19.672655041330906], [163.64630472427189, -19.67181665425659], [163.647441221616, -19.672563663096707], [163.6469361228577, -19.67291107014982]]], [[[163.64743742797157, -19.67014457489], [163.64753522918352, -19.66951672601683], [163.64811191221028, -19.670223516004857], [163.64770829535163, -19.670550194328307], [163.64743742797157, -19.67014457489]]], [[[163.6463588927532, -19.66894791583019], [163.6456512614934, -19.66843119258565], [163.6457399519755, -19.66784651079046], [163.64716343108685, -19.668681850924088], [163.6463588927532, -19.66894791583019]]], [[[163.64974004616784, -19.662340583327364], [163.65039433246983, -19.662538543064525], [163.64861716052366, -19.662403093836364], [163.64909936708696, -19.66174732283374], [163.64974004616784, -19.662340583327364]]], [[[163.65575151730843, -19.659778598914272], [163.65587546414008, -19.66016860705427], [163.65609805185383, -19.660622062466405], [163.65520308365745, -19.659311446196522], [163.65575151730843, -19.659778598914272]]], [[[163.6411933996636, -19.655450217766433], [163.63931529104045, -19.650449957024115], [163.64414035613964, -19.65170373349385], [163.6421209043097, -19.652567938746905], [163.64209177288922, -19.65685597067245], [163.64379313835784, -19.656779337023508], [163.64823184289355, -19.662249510890923], [163.64188594279017, -19.6633294869754], [163.6411933996636, -19.655450217766433]]], [[[163.65053856700183, -19.65726085651391], [163.65083490034854, -19.657858579836084], [163.6490021220005, -19.656202693941598], [163.64974775281482, -19.65572084697306], [163.65053856700183, -19.65726085651391]]], [[[163.63984751457485, -19.647463059761133], [163.63952157933463, -19.648400156281532], [163.63912668776788, -19.648590619456044], [163.63918482251648, -19.64729177897746], [163.63984751457485, -19.647463059761133]]], [[[163.63809158197012, -19.643526498058566], [163.63847437636414, -19.64447743223827], [163.63699790807632, -19.6447521424975], [163.6368585730375, -19.643331396760736], [163.63809158197012, -19.643526498058566]]], [[[163.64095454120098, -19.640520040084414], [163.64337599605983, -19.64314189853867], [163.64322012655444, -19.64405921084085], [163.6407814340626, -19.642068091414743], [163.64002903833858, -19.638987900392124], [163.64095454120098, -19.640520040084414]]], [[[163.63211795992515, -19.638705337008282], [163.63674764767072, -19.637607732661333], [163.6341022843736, -19.639996851286508], [163.63685127095013, -19.641207235824474], [163.6359001188731, -19.64295086131065], [163.63026238870157, -19.638375816186166], [163.63211795992515, -19.638705337008282]]], [[[163.6301832588808, -19.63390617093134], [163.63028786893287, -19.632674659155263], [163.63217940746827, -19.631807106269694], [163.63277760330192, -19.633561338277943], [163.63001971169362, -19.635714782013824], [163.63133159722236, -19.636481686200298], [163.62879331872043, -19.635775547930766], [163.6301832588808, -19.63390617093134]]], [[[163.6276981073426, -19.631916367352], [163.6285689428774, -19.63141021520813], [163.62993522593143, -19.63136317289405], [163.62700412847656, -19.634111614940533], [163.6261595850854, -19.632614470425167], [163.6276981073426, -19.631916367352]]], [[[163.62626548333478, -19.627698141838682], [163.62722244638678, -19.62756994352638], [163.62832506852396, -19.627147972595065], [163.62747070998063, -19.627790963520695], [163.62489797033513, -19.62836066101863], [163.62626548333478, -19.627698141838682]]], [[[163.62253522214786, -19.62304514990088], [163.6231242563686, -19.624059112348483], [163.6256877849598, -19.623527259262204], [163.623177382665, -19.624638026799477], [163.62245293737416, -19.623728155758595], [163.62188077695222, -19.621351190606987], [163.62253522214786, -19.62304514990088]]], [[[163.61408303596554, -19.598189633501477], [163.6125008351311, -19.599145276527967], [163.61186194935178, -19.5986708765762], [163.6127891585558, -19.59818328369504], [163.61408303596554, -19.598189633501477]]], [[[163.60943982535022, -19.594708869801853], [163.60948582339967, -19.595550496547244], [163.6083362324619, -19.593117406864497], [163.6092407290053, -19.593232633359815], [163.60943982535022, -19.594708869801853]]], [[[163.67747916298146, -19.786235561434076], [163.6781314625576, -19.786303910409583], [163.67828414557866, -19.78668652731754], [163.67708654741082, -19.78696324851124], [163.67747916298146, -19.786235561434076]]], [[[163.67304657518517, -19.779614630348647], [163.67496850472767, -19.78025746775688], [163.67531992613667, -19.78271617356327], [163.6719145300831, -19.779669544484836], [163.67304657518517, -19.779614630348647]]], [[[163.6753316790222, -19.7793043382893], [163.6754033542928, -19.77887619846426], [163.67628144244492, -19.779821572550624], [163.67532232893439, -19.779520580141934], [163.6753316790222, -19.7793043382893]]], [[[163.67296360507515, -19.77772097478979], [163.673349716124, -19.777075181343857], [163.67337720346487, -19.777719016979916], [163.67242875945024, -19.778509308436213], [163.67138535210083, -19.77830812543788], [163.67296360507515, -19.77772097478979]]], [[[163.67631256576627, -19.776024780309353], [163.6760733201519, -19.77753229459014], [163.67312613459066, -19.77615633364287], [163.67581262761573, -19.775487764416848], [163.67631256576627, -19.776024780309353]]], [[[163.67376119593735, -19.772131601424284], [163.67580454499625, -19.772497893306554], [163.6731701883912, -19.77444861251452], [163.67397357484109, -19.772971770623148], [163.67376119593735, -19.772131601424284]]], [[[163.67485359330007, -19.770193972820792], [163.6740936428449, -19.77050387799568], [163.67372755579413, -19.769920579438494], [163.6747507280517, -19.769576748139478], [163.67485359330007, -19.770193972820792]]], [[[163.66700690453547, -19.766392470776886], [163.66762897648508, -19.767149965144913], [163.66600768931528, -19.767238240466995], [163.666795569439, -19.766941672391148], [163.66700690453547, -19.766392470776886]]], [[[163.67179330939524, -19.764685427162835], [163.67344556605065, -19.76546502694631], [163.67194990459782, -19.768644935309375], [163.66945357202783, -19.767342768072826], [163.67179330939524, -19.764685427162835]]], [[[163.67416104071074, -19.76604388359045], [163.67533866960355, -19.764683123978262], [163.6766660670918, -19.767032023003548], [163.67437793744125, -19.76783049916459], [163.67416104071074, -19.76604388359045]]], [[[163.67302193338256, -19.746721123104052], [163.67232661940443, -19.746231349785162], [163.67244703556148, -19.745198053026154], [163.67361982255147, -19.746232061732474], [163.67302193338256, -19.746721123104052]]], [[[163.65896518036763, -19.742665710760146], [163.65833618110233, -19.742482027722847], [163.65828039260188, -19.74190823786176], [163.65950264231984, -19.742426349472904], [163.65896518036763, -19.742665710760146]]], [[[163.67168122472134, -19.743297097386673], [163.67044889023256, -19.744121429168793], [163.6667609016237, -19.73950449769], [163.66888746899116, -19.740466077085742], [163.67168122472134, -19.743297097386673]]], [[[163.6736670759342, -19.73812209291279], [163.67365409979593, -19.741075415428185], [163.67580011098212, -19.743858848366564], [163.67239693311456, -19.741209891113957], [163.67227770969066, -19.73730779988636], [163.6736670759342, -19.73812209291279]]], [[[163.6767883244377, -19.737556881837783], [163.67784601117305, -19.7380017483451], [163.6789258121642, -19.74024693892617], [163.6771701770742, -19.738067468654016], [163.67665556898393, -19.739140118276566], [163.6767883244377, -19.737556881837783]]], [[[163.66464055659068, -19.73484882956894], [163.66522273301675, -19.735794471464065], [163.6644751692835, -19.73653234333261], [163.66417562468502, -19.736143077076715], [163.66464055659068, -19.73484882956894]]], [[[163.6714172718634, -19.734560809634765], [163.67110770063553, -19.734968055324302], [163.67007827620216, -19.73490314502038], [163.66813348745896, -19.7338059086421], [163.6714172718634, -19.734560809634765]]], [[[163.67263792371563, -19.730582626855554], [163.67149925539107, -19.73067517714271], [163.6711116687001, -19.7299411905766], [163.67308381046567, -19.729525580277617], [163.67263792371563, -19.730582626855554]]], [[[163.6573899466706, -19.71981425159964], [163.65627940441956, -19.71932979686205], [163.65611926084125, -19.717745527884116], [163.65780674316304, -19.71967993832723], [163.6573899466706, -19.71981425159964]]], [[[163.66038673349186, -19.71454306080683], [163.66038564952143, -19.7155609818924], [163.65898893506395, -19.716052317525897], [163.65967249263798, -19.71559778077585], [163.66038673349186, -19.71454306080683]]], [[[163.67084261183976, -19.711468238233458], [163.67035634627203, -19.71263360425566], [163.6693562759516, -19.711605816168955], [163.66989444195488, -19.71097320774914], [163.67084261183976, -19.711468238233458]]], [[[163.656397194669, -19.70426655207549], [163.65664431881103, -19.703850641556304], [163.6578280683796, -19.704878286262318], [163.65622223677767, -19.70573176113167], [163.656397194669, -19.70426655207549]]], [[[163.65440289645517, -19.686926893569765], [163.6568869997106, -19.68791911390449], [163.6594269981857, -19.686060579506528], [163.6581032016755, -19.682778470251964], [163.65384527200365, -19.6826033305874], [163.65919578366984, -19.678335788793497], [163.65961287440877, -19.683515602678256], [163.6610496464082, -19.683411140125713], [163.66132492862505, -19.68615172995217], [163.6636283726404, -19.688356087013652], [163.66158960252594, -19.690158698766247], [163.6651202029281, -19.688798761334454], [163.6664422954361, -19.69042541484525], [163.66611132765803, -19.69342412874252], [163.66394424856284, -19.69419377552445], [163.66710720538836, -19.699454206737112], [163.66576564173684, -19.703076898906335], [163.66823640018103, -19.70984158647624], [163.66474210311173, -19.712669191822332], [163.6596091083113, -19.708926004778334], [163.66389209232145, -19.708830816793522], [163.6628213886756, -19.708053972778476], [163.66373677662588, -19.704810648283328], [163.66086650600346, -19.703177264598295], [163.6634635423025, -19.70205563988843], [163.66396450235567, -19.69651904667824], [163.66116478606386, -19.696572144219783], [163.66166208151407, -19.692622854005613], [163.6587430749878, -19.691614221561334], [163.65906453233484, -19.694111881724485], [163.6560938673413, -19.69246034291174], [163.65440289645517, -19.686926893569765]], [[163.66498721408706, -19.711303013106786], [163.66538529174508, -19.711476773460056], [163.665020524162, -19.70996662295784], [163.66438146402834, -19.711137808545324], [163.66498721408706, -19.711303013106786]]], [[[163.65776521326993, -19.694980789000468], [163.65831465616938, -19.695012268161086], [163.6583795114649, -19.695248237370137], [163.65773502205164, -19.69553382918148], [163.65776521326993, -19.694980789000468]]], [[[163.70666611849282, -19.898077887865618], [163.70697910012885, -19.899513812690167], [163.70650278437319, -19.89977085215448], [163.70601302405697, -19.897783490309692], [163.70666611849282, -19.898077887865618]]], [[[163.70789809040366, -19.890371718039688], [163.70832287601323, -19.891330865271595], [163.7080561739723, -19.891882971632022], [163.70726468357336, -19.89085360488641], [163.70789809040366, -19.890371718039688]]], [[[163.70189917144367, -19.878336781610752], [163.70209574628652, -19.878030890497396], [163.7023411662837, -19.880363411386806], [163.7015472334655, -19.879514497438844], [163.70189917144367, -19.878336781610752]]], [[[163.69763223475755, -19.844264109557585], [163.69804637446774, -19.843328934974153], [163.6985891670973, -19.843466989990514], [163.69824856452334, -19.844442456358298], [163.69707078632538, -19.84486584579229], [163.69763223475755, -19.844264109557585]]], [[[163.69906300136617, -19.840944563243347], [163.6984723373932, -19.84219092838335], [163.6979309913799, -19.839813477024997], [163.6989594682123, -19.840036135507923], [163.69906300136617, -19.840944563243347]]], [[[163.69648309330702, -19.831176898858573], [163.69629490723935, -19.830292434333213], [163.6967865685196, -19.831580034020707], [163.69600271147237, -19.832103049990017], [163.69648309330702, -19.831176898858573]]], [[[163.68364132411187, -19.82134817267495], [163.68422070567019, -19.82170712246021], [163.68342013468188, -19.823418957200456], [163.68291413764084, -19.822508018733213], [163.68364132411187, -19.82134817267495]]], [[[163.68149388229432, -19.816791775279214], [163.68146138385137, -19.81789403665254], [163.67996855024862, -19.818568169828776], [163.679655634333, -19.816414637881643], [163.68149388229432, -19.816791775279214]]], [[[163.6782745332113, -19.783158108367846], [163.67823766707497, -19.7838944615543], [163.67818265932627, -19.78394949513039], [163.677998682105, -19.78254171613226], [163.6782745332113, -19.783158108367846]]], [[[163.67927407943168, -19.77063553862729], [163.67844760424893, -19.770787146948827], [163.6793726019234, -19.76974026149362], [163.67951544840867, -19.769827170358553], [163.67927407943168, -19.77063553862729]]], [[[163.69943741147824, -19.769310407570693], [163.69996782186126, -19.77004836305318], [163.696005378848, -19.76920941833042], [163.6982033185755, -19.768544551835184], [163.69943741147824, -19.769310407570693]]], [[[163.69120408333245, -19.764334079847835], [163.6922234396099, -19.761960233106052], [163.6918529911731, -19.76488060615695], [163.69491709852895, -19.769789211393533], [163.69088333446913, -19.76840452132958], [163.6913901206422, -19.76650670789834], [163.68922094408074, -19.76514395025576], [163.69120408333245, -19.764334079847835]]], [[[163.68540856466157, -19.76258401100378], [163.6852068257158, -19.76146655749261], [163.68472467456002, -19.76101607000488], [163.68529011210728, -19.761263890251215], [163.68575216566882, -19.76211904622134], [163.68579004326043, -19.76315308714047], [163.68540856466157, -19.76258401100378]]], [[[163.68743892693718, -19.76058449157745], [163.68866825104, -19.759722114006927], [163.6870165025765, -19.76262379548938], [163.6900409970531, -19.761763888919546], [163.68939661846238, -19.763975739421316], [163.68643657242964, -19.76284973623798], [163.68743892693718, -19.76058449157745]]], [[[163.68416087078288, -19.756579850584497], [163.6855696709297, -19.758351650042982], [163.6882889855916, -19.75539874059627], [163.68503053531964, -19.760277108529884], [163.68416087078288, -19.756579850584497]]], [[[163.68756738514415, -19.757475493637372], [163.68893102854398, -19.75358366304068], [163.68977814474496, -19.75711833595609], [163.69064950521818, -19.75477139818737], [163.69182570989145, -19.75488548448061], [163.690413866301, -19.758200294894937], [163.68756738514415, -19.757475493637372]]], [[[163.688326072098, -19.752513292069683], [163.68461404251897, -19.75002240099521], [163.68115923297248, -19.751235310733584], [163.6797724408687, -19.75243423610268], [163.6818787202922, -19.75332160437994], [163.67999670659944, -19.753227033171747], [163.680116049512, -19.755390553938923], [163.6765698452559, -19.757778339331026], [163.67332137375067, -19.75032484093346], [163.67895556832474, -19.744937701700046], [163.69123518960646, -19.750124000829675], [163.69489179177444, -19.749419132034458], [163.69596486752582, -19.747479192926537], [163.70149916066626, -19.757693694740748], [163.69991083292422, -19.763980821433808], [163.69832032360705, -19.764930176586375], [163.69960110247183, -19.759998361527444], [163.6986401200489, -19.758319544593796], [163.6940591167046, -19.759836217368346], [163.6978997549211, -19.75707717098613], [163.6947716564513, -19.755826835786326], [163.69160787462314, -19.758512871399567], [163.69446588910736, -19.75478259711585], [163.6895801962522, -19.751423904562845], [163.688326072098, -19.752513292069683]]], [[[163.67832469060752, -19.74372955780815], [163.67721864788, -19.74342564916541], [163.6772954653068, -19.742358018678814], [163.67909608688393, -19.743475575086595], [163.67832469060752, -19.74372955780815]]], [[[163.69403416650889, -19.74068108892279], [163.69503925795317, -19.740752696257015], [163.692642712154, -19.74120808574463], [163.69323224410465, -19.740409643710443], [163.69403416650889, -19.74068108892279]]], [[[163.6912019667052, -19.740473245367365], [163.69046716408246, -19.73956475758982], [163.69242246572398, -19.74028890975867], [163.69187959789537, -19.74067855693227], [163.6912019667052, -19.740473245367365]]], [[[163.6877738577209, -19.73899807361347], [163.68832736900472, -19.739316673765646], [163.6900812537541, -19.739446957802166], [163.68653584337056, -19.739614235027155], [163.6877738577209, -19.73899807361347]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 0.9351479273723403, "forest_fragmentation_fragment_size_distribution": {"10": 21.056836673294466, "100": 59.79877353264864, "1000": 100.0, "1100": 100.0, "1200": 100.0, "12000": 100.0, "125": 59.79877353264864, "1300": 100.0, "1400": 100.0, "150": 59.79877353264864, "1500": 100.0, "1600": 100.0, "1700": 100.0, "17000": 100.0, "175": 78.47128528433326, "1800": 100.0, "1900": 100.0, "20": 31.852945034161795, "200": 100.0, "2000": 100.0, "225": 100.0, "250": 100.0, "27000": 100.0, "275": 100.0, "30": 34.697750492265115, "300": 100.0, "325": 100.0, "350": 100.0, "375": 100.0, "40": 38.56324392927022, "400": 100.0, "425": 100.0, "450": 100.0, "475": 100.0, "50": 38.56324392927022, "500": 100.0, "500000": 100.0, "60": 44.0994412589738, "600": 100.0, "70": 50.65066342341288, "700": 100.0, "7000": 100.0, "80": 50.65066342341288, "800": 100.0, "90": 59.79877353264864, "900": 100.0}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 33, "land_use_category_distribution": null, "name": "BELEP", "num_families_unique_taxonomic_count": 68, "num_occurrences_count": 1592, "num_species_unique_taxonomic_count": 232, "rainfall_mean": null, "rainfall_range": null, "shape_area": "6464.496969438019", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"MultiPolygon\", \"coordinates\": [[[[163.70240834076097, -19.769357183543082], [163.6918493634693, -19.76951054052816], [163.68867338453, -19.765964482644428], [163.68280613651424, -19.767558558839923], [163.6792925160442, -19.77136137623211], [163.67915822461276, -19.787436864883176], [163.6758919301214, -19.7873707641694], [163.6750626193886, -19.782449750590512], [163.67088326574546, -19.77815172498682], [163.6729489523563, -19.777318219315134], [163.67297404160962, -19.771391907246144], [163.6638180777733, -19.765858123128154], [163.6639236008253, -19.762378816616543], [163.65985717519482, -19.757439250626913], [163.6535005207784, -19.754665414813484], [163.65256574126047, -19.737553748945896], [163.64224715627466, -19.72778238827057], [163.64004493953766, -19.721840382843126], [163.64397347145535, -19.71597303759095], [163.6460199235706, -19.71536421598545], [163.64597541176514, -19.713659054086364], [163.64454344090706, -19.71161667869267], [163.63788844989682, -19.709663603727545], [163.63272360957657, -19.710481136096988], [163.63506318787034, -19.708582616039795], [163.63543144723295, -19.70519768324301], [163.63073524554005, -19.69681720991503], [163.63199705276685, -19.693931740118078], [163.62935187961443, -19.68902103624729], [163.63806588115276, -19.67755436978523], [163.64497294897913, -19.674471000125983], [163.64618138042317, -19.67086490329605], [163.64083566201353, -19.661979912569276], [163.6415174516014, -19.656480282806527], [163.63805155002828, -19.649689170210298], [163.63872476555267, -19.647590151748215], [163.62398710133732, -19.631722687740723], [163.62177428753964, -19.620974696061754], [163.6339697446217, -19.627004860484853], [163.64525445472194, -19.647427387830877], [163.65332077732245, -19.65608292684732], [163.65943395492775, -19.667912650750143], [163.6671641821038, -19.676049966890627], [163.6699303676837, -19.68338867540765], [163.67263548632616, -19.684793881058425], [163.67467545627477, -19.693944610965264], [163.6732592402197, -19.694800846015053], [163.6752281012058, -19.702275347226482], [163.67452315406584, -19.708279906997927], [163.67580631221128, -19.70991402269441], [163.67439195278232, -19.711353957529834], [163.67615373115345, -19.71658364834075], [163.67276493347572, -19.72301354241097], [163.67656048445946, -19.728801184960254], [163.67878178439048, -19.729654943632234], [163.67785900368125, -19.729984698139436], [163.67744642256483, -19.731245115732886], [163.68031337740885, -19.728550039614536], [163.6816582566589, -19.729135926812624], [163.68903053790834, -19.739002520489308], [163.69449506151966, -19.74067194710698], [163.69912809213295, -19.73834511704577], [163.70007934995587, -19.745356442661134], [163.70524863826412, -19.756212034455928], [163.7048925756332, -19.765904765803224], [163.70365563886787, -19.769461985068748], [163.70240834076097, -19.769357183543082]], [[163.62937151885194, -19.637044782537906], [163.629403184755, -19.63709820710602], [163.62947922891308, -19.63707855625049], [163.6294511779026, -19.636982932617006], [163.62937151885194, -19.637044782537906]]], [[[163.57398075153955, -19.563443886264018], [163.56968423052402, -19.555135167885343], [163.5714521091554, -19.551337626051986], [163.57579640116256, -19.548298321759006], [163.57543023265674, -19.54529770035336], [163.5721319779747, -19.543649986563434], [163.57269140885992, -19.541614481015934], [163.57783853039373, -19.539528112669448], [163.57939078635465, -19.543399266461954], [163.58191727253234, -19.544675632463427], [163.58283334121305, -19.550902344129895], [163.58742048356157, -19.555525326271752], [163.58730545810144, -19.558138612432398], [163.58935354764827, -19.562656902179768], [163.59819922694695, -19.568115700158327], [163.59850131603105, -19.575606335509402], [163.60582706730278, -19.58092869335161], [163.60502539411155, -19.582260127542064], [163.60523585956793, -19.583479900251746], [163.60973986161076, -19.589005822493768], [163.6132871178363, -19.589354486678534], [163.61755196719764, -19.59256227776737], [163.61313268371757, -19.597076487937944], [163.60478553232855, -19.60005512371735], [163.60246808214734, -19.59916592190438], [163.59715457386423, -19.603837099938975], [163.59425974498757, -19.604045279076892], [163.59234950848085, -19.600102329908136], [163.58878404479634, -19.59639922141389], [163.58468274415364, -19.59496350437935], [163.58375289111973, -19.592299731978002], [163.58554386156808, -19.59054529986792], [163.58375827109833, -19.587673580513748], [163.5846449433421, -19.585552393983978], [163.58187638406082, -19.58151209104753], [163.58497771785758, -19.57933759286507], [163.5879283417312, -19.579781168360856], [163.59015702400572, -19.577354674502967], [163.59043251125073, -19.574324341641063], [163.58686961265474, -19.56954133864292], [163.5867734630214, -19.56672443813226], [163.58379944867568, -19.566796803875217], [163.5821479533466, -19.56955524193262], [163.58275973166639, -19.570656182856137], [163.57966997719626, -19.571380960443893], [163.57398075153955, -19.563443886264018]]], [[[163.6794839630365, -19.814839371184856], [163.68175513212978, -19.813701997154702], [163.684130902356, -19.809031711352123], [163.68630561052393, -19.816351762770886], [163.68888893711335, -19.818211838697486], [163.6814585190857, -19.825496951281224], [163.67789683073275, -19.825266757355262], [163.6735324029008, -19.827474311563297], [163.67225945241933, -19.826445788701548], [163.67360075576823, -19.825242034457702], [163.67300411807628, -19.82226870340393], [163.6783337198681, -19.82049041254142], [163.67991077131177, -19.81786608883731], [163.6794839630365, -19.814839371184856]]], [[[163.69558231108016, -19.83391294468735], [163.69525420750017, -19.827903368422124], [163.69735055820624, -19.827370528379824], [163.70044056040888, -19.833099951420756], [163.69558231108016, -19.83391294468735]]], [[[163.6977631721142, -19.846636329687414], [163.6973562455356, -19.839600770269374], [163.69916713300395, -19.838061563226127], [163.70078116899495, -19.840169052505704], [163.69966926303962, -19.84282417003457], [163.69832213819552, -19.842656405762366], [163.69957959446756, -19.84489029447165], [163.6977631721142, -19.846636329687414]]], [[[163.70652572053228, -19.902092905029747], [163.70586604502026, -19.897085546968697], [163.7074783879885, -19.895692955553205], [163.70749850694634, -19.89968339395855], [163.70652572053228, -19.902092905029747]]], [[[163.70201473779537, -19.880386974923145], [163.70098979175341, -19.87902018912404], [163.70293481894777, -19.876544122620313], [163.70357153754944, -19.87950921073807], [163.70201473779537, -19.880386974923145]]], [[[163.6121193927778, -19.598441256017086], [163.61511253407718, -19.59800391929979], [163.61571065270743, -19.598900811501803], [163.61263734857323, -19.59922689867625], [163.6121193927778, -19.598441256017086]]], [[[163.70796464750046, -19.88982043773181], [163.7088254212376, -19.89112790129059], [163.7080716353654, -19.892764277670892], [163.7070871483433, -19.890894107440403], [163.70796464750046, -19.88982043773181]]], [[[163.6206809953907, -19.619980325742425], [163.62029959055164, -19.618446640577087], [163.62148210794146, -19.618173459783044], [163.62143701695672, -19.62062343616813], [163.6206809953907, -19.619980325742425]]], [[[163.5728104704829, -19.526831452325133], [163.57331331724083, -19.526173287609893], [163.5741344721566, -19.526548548544817], [163.57355251872104, -19.52730995704253], [163.5728104704829, -19.526831452325133]]], [[[163.69776304112483, -19.84716406960496], [163.69834022106775, -19.847511899929838], [163.69832241743953, -19.848247899804154], [163.69788258831957, -19.847957056209662], [163.69776304112483, -19.84716406960496]]], [[[163.57156837260123, -19.525460227242], [163.57198963170555, -19.525088525530354], [163.5721597257331, -19.52630616290487], [163.57164252170747, -19.526137710889206], [163.57156837260123, -19.525460227242]]], [[[163.58273409536966, -19.571575783925894], [163.5834713640169, -19.570785133532908], [163.584139896882, -19.571290828324504], [163.58324193442803, -19.571393020099226], [163.58273409536966, -19.571575783925894]]], [[[163.58287226092932, -19.570006995130527], [163.58332771056536, -19.569071447485527], [163.58339949419775, -19.569060627086138], [163.58329700825863, -19.570108653201817], [163.58287226092932, -19.570006995130527]]], [[[163.70785088804345, -19.88733484511638], [163.70801437573894, -19.886873532769556], [163.70840191773343, -19.886952355028406], [163.70828670660083, -19.887391135216422], [163.70785088804345, -19.88733484511638]]], [[[163.6712556359973, -19.77479987062685], [163.67184858228302, -19.774816810584785], [163.67238971860493, -19.774687526468718], [163.67161828146018, -19.775005690270927], [163.6712556359973, -19.77479987062685]]], [[[163.70825074706164, -19.892817436154672], [163.7084888240704, -19.892795312038757], [163.70859859151764, -19.893110677023625], [163.7083837302826, -19.89321622734431], [163.70825074706164, -19.892817436154672]]], [[[163.60536028677495, -19.58193794936969], [163.60558281391715, -19.581762830782164], [163.60581560409366, -19.58169701062334], [163.60579909063188, -19.581946631010588], [163.60536028677495, -19.58193794936969]]], [[[163.7031078754959, -19.87647750039913], [163.70323372152762, -19.876178338195725], [163.7032146211179, -19.875993280423845], [163.70347548046735, -19.876458425448057], [163.7031078754959, -19.87647750039913]]], [[[163.70813648622462, -19.886691681680517], [163.7082661455696, -19.88638502063725], [163.7085516469781, -19.886619836541797], [163.7082788970177, -19.886811129395472], [163.70813648622462, -19.886691681680517]]], [[[163.59607368833704, -19.56646366367268], [163.59640586923945, -19.566154860711904], [163.59648269906884, -19.566041944235394], [163.5963798394871, -19.566377410182426], [163.59607368833704, -19.56646366367268]]], [[[163.67892777799227, -19.788979037901537], [163.67928326468058, -19.78886625033254], [163.6793708623654, -19.788960247513682], [163.67925161973864, -19.789201239441446], [163.67892777799227, -19.788979037901537]]], [[[163.67482542644666, -19.70771697819077], [163.67508179237592, -19.707610384958482], [163.6752176555037, -19.70773991663424], [163.67505085012615, -19.707835969119625], [163.67482542644666, -19.70771697819077]]], [[[163.69568777961484, -19.82576453028265], [163.6958057246038, -19.825680463519358], [163.6960805989109, -19.825891029119337], [163.69596801996437, -19.82596947485743], [163.69568777961484, -19.82576453028265]]], [[[163.58806553324158, -19.558587886070466], [163.5882842539742, -19.558493640694515], [163.58835399829732, -19.55857939212521], [163.58825095965295, -19.558735816136586], [163.58806553324158, -19.558587886070466]]], [[[163.57489942378805, -19.539013387649813], [163.57495985979483, -19.538835557214043], [163.57504350654906, -19.538830775983506], [163.57506198433376, -19.539107156538176], [163.57489942378805, -19.539013387649813]]], [[[163.5708121632544, -19.552261138527793], [163.57092507609588, -19.552028369259556], [163.57107520151902, -19.552107978444784], [163.5709949772453, -19.55227112820302], [163.5708121632544, -19.552261138527793]]], [[[163.70757824355366, -19.88801247899546], [163.70769881376143, -19.888039214204113], [163.7078078626696, -19.887829283567946], [163.70773963102033, -19.888097915698147], [163.70757824355366, -19.88801247899546]]], [[[163.70789649283694, -19.889259397842388], [163.70799327494808, -19.88916260325653], [163.70804542363803, -19.889356265237716], [163.70792530497837, -19.88937719522939], [163.70789649283694, -19.889259397842388]]], [[[163.57214430919402, -19.525703630615215], [163.572234796375, -19.525674327014187], [163.57235462929654, -19.525739241254424], [163.57223463273655, -19.525873627386378], [163.57214430919402, -19.525703630615215]]], [[[163.7075426392141, -19.895499518696305], [163.70765812470964, -19.89542333255598], [163.70767526344633, -19.89561707480423], [163.70759196432925, -19.89564027838458], [163.7075426392141, -19.895499518696305]]], [[[163.58403867174488, -19.58891302046615], [163.5841689604054, -19.588924859820402], [163.58421923443848, -19.589087841588675], [163.58414939467048, -19.58907948490843], [163.58403867174488, -19.58891302046615]]], [[[163.58513007162736, -19.595398024604446], [163.58528832198593, -19.595298936384925], [163.5853099163138, -19.59546219192008], [163.58526831964372, -19.595505387500157], [163.58513007162736, -19.595398024604446]]], [[[163.7078859577223, -19.888278991714664], [163.70798874308662, -19.88819042330522], [163.70804994771012, -19.88824244326488], [163.70798349569, -19.888362341311424], [163.7078859577223, -19.888278991714664]]], [[[163.57248277674785, -19.541778270458703], [163.5725417666442, -19.54171281013381], [163.57259093697422, -19.541943390730623], [163.57254828187797, -19.541936168788315], [163.57248277674785, -19.541778270458703]]]]}, \"bbox\": [163.56968423052402, -19.902092905029747, 163.7088254212376, -19.525088525530354]}], \"bbox\": [163.56968423052402, -19.902092905029747, 163.7088254212376, -19.525088525530354]}", "shape_id": 33, "type": "communes"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "communes";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>