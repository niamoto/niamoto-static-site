<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - FARINO</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">FARINO</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 4799.207192183444</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 2878.927723865439</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 76</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 370</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 3446</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 1484.642822265625</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 920.0, "max": 2005.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 318.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 684.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [10.0, 110.0, 210.0, 310.0, 410.0, 510.0, 610.0], "forest": [157.80190149523412, 325.60533195847603, 466.7380185070305, 600.0917380804678, 880.1345491846861, 332.2730179371479, 134.4650005698826], "non_forest": [538.9712832759757, 263.37359615753866, 578.977399148007, 331.1617369407026, 154.4680585058982, 36.67227288269525, 12.224090960898419]}, "elevation_max": 684.0, "elevation_median": 318.0, "forest_area": "2878.927723865439", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[165.76190237122813, -21.678444322454503], [165.76178906648204, -21.679312992174538], [165.76098862609902, -21.680009533775443], [165.760573121715, -21.677943893159252], [165.76190237122813, -21.678444322454503]]], [[[165.71757661035073, -21.67171213212423], [165.71695343424724, -21.670862346528544], [165.71893626730383, -21.67214646698425], [165.71816201820556, -21.67349668187517], [165.72042811312738, -21.673043462890803], [165.71989935764563, -21.673968784983884], [165.72249592474355, -21.67434646747086], [165.72422382212144, -21.67569668236178], [165.7181714602677, -21.674100973854326], [165.71962508350015, -21.676902724755912], [165.71782494769104, -21.6744277012819], [165.71757661035073, -21.67171213212423]]], [[[165.72784249244987, -21.673411703315594], [165.72815415616094, -21.67365410001764], [165.727937859017, -21.673975937203757], [165.7276819773929, -21.673487239813], [165.72784249244987, -21.673411703315594]]], [[[165.72279807073312, -21.66949324751327], [165.72479978791407, -21.671806552745974], [165.7246392728571, -21.672703548652528], [165.72208991607005, -21.67121170282899], [165.72279807073312, -21.66949324751327]]], [[[165.7242545088235, -21.66817135880887], [165.72457553893744, -21.670626294974184], [165.72603905857446, -21.671419428196828], [165.7245188865644, -21.67085290446637], [165.72369742715523, -21.66947436338892], [165.7237068692174, -21.66731213115101], [165.7242545088235, -21.66817135880887]]], [[[165.7529391905375, -21.66759664504203], [165.75264165833352, -21.667585894490866], [165.75344712102992, -21.66755475420233], [165.7529391905375, -21.66759664504203]]], [[[165.7605754005295, -21.66212966283354], [165.759883136079, -21.66062825811625], [165.76055741963467, -21.659432528610868], [165.7614834357178, -21.66313659294334], [165.7605754005295, -21.66212966283354]]], [[[165.76144084347314, -21.658168022182803], [165.76316835794276, -21.655109471974292], [165.76684050618692, -21.655402111037453], [165.76270579942357, -21.65836626154817], [165.76144084347314, -21.658168022182803]]], [[[165.71410553024398, -21.641784079612485], [165.71415049681477, -21.64177799195762], [165.7142784341134, -21.64179814859416], [165.7140614459627, -21.641810959986827], [165.71410553024398, -21.641784079612485]]], [[[165.71435703277794, -21.641737086345728], [165.7144455039336, -21.641723114640634], [165.71427864232922, -21.641798055080816], [165.71430847882314, -21.641772471363716], [165.71435703277794, -21.641737086345728]]], [[[165.7151878451292, -21.641486452278183], [165.71519022527085, -21.641487459079265], [165.7151840313922, -21.641485394453042], [165.7151878451292, -21.641486452278183]]], [[[165.71510248490083, -21.64147181455917], [165.71513246968388, -21.6414718475817], [165.71516592590515, -21.641480372491824], [165.7150615510054, -21.64148689592306], [165.71510248490083, -21.64147181455917]]], [[[165.7884338536455, -21.6398997223319], [165.78692891955163, -21.63977706312675], [165.78804228772137, -21.641050831795532], [165.78244242324044, -21.64074890144443], [165.78344747211514, -21.64279952392391], [165.78750211545255, -21.642098152700985], [165.78551126219986, -21.644711737302856], [165.78739832689433, -21.64474947859674], [165.7846546209158, -21.645346893046558], [165.78364945567435, -21.64337933555257], [165.78232824556972, -21.6437120143559], [165.78102604568238, -21.647694654887207], [165.78103555079105, -21.644101723811236], [165.77655864460908, -21.643721519464563], [165.77940304837753, -21.646002745544557], [165.77564853045422, -21.646268888587215], [165.7802751420977, -21.64855011466719], [165.77859273786373, -21.65011845759718], [165.7736334474169, -21.646563546955882], [165.77014507253628, -21.647019792171882], [165.77561051001956, -21.64407320848523], [165.77384321533023, -21.643011346425027], [165.77321908159357, -21.64470542371019], [165.77124761153655, -21.64397231424176], [165.76999934406328, -21.642060285493], [165.772456251471, -21.642932091347358], [165.77255532031808, -21.641634289450543], [165.769033186926, -21.640870044058726], [165.76878787359036, -21.646899091038485], [165.76601394587198, -21.646068799748623], [165.770316364374, -21.65187140364935], [165.76795758230054, -21.65259790852797], [165.7672315090341, -21.651401852587846], [165.76646050827938, -21.652949979920642], [165.76491275573318, -21.651826915573096], [165.7653185689008, -21.65416741942345], [165.76406337933588, -21.65269516700145], [165.76238484045118, -21.653245077942866], [165.76410112939797, -21.650666101163445], [165.76246843921206, -21.65054341346161], [165.7584955729021, -21.65540683102234], [165.7563338198226, -21.65439255871382], [165.7565701562088, -21.652213199341507], [165.75107735797263, -21.64971291209536], [165.74789920682483, -21.653566036915375], [165.7508727973053, -21.65423627476969], [165.75340742919107, -21.65913561908519], [165.74974472091668, -21.657417544585343], [165.74925547006913, -21.661175303589943], [165.7512173562023, -21.659390498269236], [165.752897670823, -21.660466654824084], [165.75123348564702, -21.661846180767444], [165.75427790602242, -21.66162800972209], [165.75390022353542, -21.656803115951025], [165.75675895560437, -21.656456690518514], [165.75737490241556, -21.6587576228211], [165.76001540803657, -21.655680590145945], [165.75910917093776, -21.656888906277697], [165.76020420743214, -21.657502504313364], [165.76028916716015, -21.6587674602638], [165.75909973096796, -21.657974502802336], [165.75643305671366, -21.659994532965932], [165.75898241350072, -21.661712988281653], [165.75725451612283, -21.664479512498723], [165.75925623330377, -21.663488095970425], [165.75996438796685, -21.665489813151364], [165.75683906538717, -21.666415135244446], [165.75687683363586, -21.66783144457059], [165.7545824125275, -21.66345032772172], [165.75665022414367, -21.662515563566462], [165.75341631784897, -21.662638310374735], [165.75352018053292, -21.66600912657096], [165.74664635927002, -21.667208268467093], [165.74437082228602, -21.665895821824865], [165.74536223881432, -21.663931872892615], [165.74365558607622, -21.66546148696485], [165.74594749307283, -21.661646651046496], [165.74256798389183, -21.661552251348695], [165.74507901585312, -21.662411288598626], [165.7432665416555, -21.66345912524413], [165.73981030625575, -21.662506121504297], [165.7433251139001, -21.668020285814073], [165.73948572105465, -21.67009266263336], [165.73813906125088, -21.667774792197548], [165.73393789925362, -21.672777335265206], [165.73249978961732, -21.670154191865475], [165.7326296179722, -21.672543033595566], [165.73082064939013, -21.67356700571219], [165.72634120456414, -21.669058912653252], [165.72794635513378, -21.66879453491237], [165.72656781405635, -21.66755762476754], [165.72745536790072, -21.665348182218757], [165.72169658400517, -21.665057326603613], [165.71926673947993, -21.658738738696744], [165.71444838746413, -21.653049120877977], [165.7157451016286, -21.650172628744933], [165.71913530763078, -21.648002696851044], [165.7158553427647, -21.647060334213588], [165.71421868255342, -21.64431794722155], [165.71436270376978, -21.64238316394863], [165.7163413056566, -21.642924409479075], [165.71484991271092, -21.64346244364302], [165.71580327149266, -21.644708417496364], [165.72261129150561, -21.64200880748078], [165.72231867643399, -21.640904421565317], [165.71882145436837, -21.64250908486129], [165.71616904033206, -21.641923854718055], [165.71701853861705, -21.63537502127517], [165.71689591063026, -21.637421965363036], [165.72777524836977, -21.642573304537688], [165.72778940046484, -21.643941340394786], [165.72466650481866, -21.644714988258794], [165.7275252280235, -21.64537541936221], [165.72757240167374, -21.64689441090009], [165.72290221029954, -21.647215191721745], [165.72347733772577, -21.650324739032275], [165.72213697191384, -21.65134417218502], [165.7238834222246, -21.651989165126512], [165.72622289373956, -21.647273664278913], [165.73142177153366, -21.649772003565015], [165.73287636716293, -21.646891329373798], [165.7298650410756, -21.64693214982029], [165.73070473204996, -21.645582983423296], [165.7290347848313, -21.645413158282413], [165.73242185291886, -21.64260160872784], [165.72971408539482, -21.641299615981087], [165.73325210916315, -21.641205268680597], [165.73226614488047, -21.637128687214357], [165.73589947917367, -21.636100028933956], [165.73319785946532, -21.63430848101485], [165.72557459758582, -21.637582332341815], [165.72536318938157, -21.634917806429517], [165.7270558502035, -21.635987862963546], [165.72888535200278, -21.633995224724362], [165.7308580464132, -21.634817956437484], [165.73368013302922, -21.631955972151708], [165.7355691760561, -21.63561873010551], [165.73560795191278, -21.630203230565023], [165.7405614717472, -21.630135698354003], [165.74122974150555, -21.62634783186111], [165.7429037233726, -21.625172625492315], [165.74425411311154, -21.625600213884624], [165.74838259286338, -21.620989428548864], [165.75088590065945, -21.62134103510066], [165.75256404539613, -21.618095822373988], [165.75613641170375, -21.619192017702336], [165.75961459249532, -21.614651646581795], [165.7703570268261, -21.60988886303497], [165.77306857624947, -21.604348433205487], [165.77498929421222, -21.607017594423787], [165.7751180622333, -21.601359396208036], [165.78260586755943, -21.607229775785708], [165.78689403391817, -21.607054223614906], [165.7919873732156, -21.613237812047927], [165.79961934925544, -21.61768237131594], [165.79918215103615, -21.619665383320257], [165.79192620976718, -21.621914316644673], [165.78780876346548, -21.628171615255603], [165.78644258067072, -21.631670297677417], [165.78815551160304, -21.63376676207479], [165.7888730386754, -21.6359330729115], [165.78743023787047, -21.63595037186503], [165.7884338536455, -21.6398997223319]], [[165.77786779830583, -21.60768712363148], [165.7770756792432, -21.608196343028876], [165.77784893832816, -21.6085263926383], [165.77893338704484, -21.606234905349996], [165.77786779830583, -21.60768712363148]], [[165.77668904970074, -21.612666157739376], [165.7783675877144, -21.613297966991716], [165.7790371169221, -21.612996207348797], [165.77783950833933, -21.611638288955746], [165.77668904970074, -21.612666157739376]], [[165.78467625024885, -21.615212254726373], [165.7847328301819, -21.614476715596805], [165.78335605181115, -21.6136657365565], [165.78311087210128, -21.6142221058981], [165.78467625024885, -21.615212254726373]], [[165.7867529528472, -21.610616319816625], [165.78598842699327, -21.61174840617725], [165.78812027793214, -21.612160073944757], [165.78825259971453, -21.61151316745297], [165.7867529528472, -21.610616319816625]], [[165.7606985715074, -21.616006335403085], [165.76183997595257, -21.617147739848257], [165.76252859185752, -21.617110007469897], [165.76124569099352, -21.615572413052032], [165.7606985715074, -21.616006335403085]], [[165.77742344821226, -21.62512813786987], [165.7773951489285, -21.624599884572934], [165.77678199778026, -21.624769680275513], [165.77696122657744, -21.625109271680685], [165.77742344821226, -21.62512813786987]], [[165.768759150833, -21.627665640314095], [165.76974019267018, -21.62795806624633], [165.76990055527818, -21.62770337269245], [165.7693251365083, -21.62718455249009], [165.768759150833, -21.627665640314095]], [[165.7704382416697, -21.63012767800161], [165.77062690356146, -21.629486227569615], [165.76978735814313, -21.6290994706915], [165.76942890054877, -21.629618290893845], [165.7704382416697, -21.63012767800161]], [[165.74577453735898, -21.6248646261783], [165.74666139312734, -21.624723106640808], [165.74691612829483, -21.624562717831633], [165.7457556680873, -21.624468371473295], [165.74577453735898, -21.6248646261783]], [[165.75346612422229, -21.622166320329903], [165.7518056283156, -21.6222512320524], [165.75399446382897, -21.624109855311612], [165.75450393416398, -21.623213564907427], [165.75346612422229, -21.622166320329903]], [[165.79137531573807, -21.620991334093056], [165.79182821126474, -21.620227072891783], [165.79031855950913, -21.619528858954826], [165.79025251224485, -21.61969869477733], [165.79137531573807, -21.620991334093056]], [[165.77930753701673, -21.62781307296365], [165.7788452061666, -21.626897846586825], [165.77908108925342, -21.628926441133395], [165.77938301960452, -21.628567898841435], [165.77930753701673, -21.62781307296365]], [[165.77960946736786, -21.630973906326922], [165.77940189025148, -21.629671831687723], [165.7787791589023, -21.631851391409864], [165.7798076091608, -21.632634523258076], [165.77960946736786, -21.630973906326922]], [[165.78749503895997, -21.63468198845161], [165.7880705936918, -21.63455932924647], [165.78789132254582, -21.634125304366737], [165.78700440213942, -21.634361187453546], [165.78749503895997, -21.63468198845161]], [[165.72591660655016, -21.64254500034754], [165.72541656585756, -21.64252613088744], [165.72541656585756, -21.642818607518958], [165.72589773709004, -21.642978997929788], [165.72591660655016, -21.64254500034754]], [[165.72206251932516, -21.64625284925676], [165.72264747258822, -21.64585659059471], [165.7226286031281, -21.64556411396319], [165.72207195405522, -21.645479201392757], [165.72206251932516, -21.64625284925676]], [[165.72581754188462, -21.649432353283263], [165.72611945324618, -21.650215435877314], [165.72770448789439, -21.64919648503202], [165.7265440160984, -21.648781356909883], [165.72581754188462, -21.649432353283263]], [[165.72777996573478, -21.650960779551184], [165.72796866033576, -21.650602259809318], [165.7276101405939, -21.650309783177814], [165.72742144599295, -21.651243821452645], [165.72777996573478, -21.650960779551184]], [[165.72964804228448, -21.65050791250883], [165.7294216087633, -21.64976256883497], [165.7291102626717, -21.649800307755157], [165.72911969740173, -21.6507532154901], [165.72964804228448, -21.65050791250883]], [[165.73054434163913, -21.650083349656626], [165.73000656202635, -21.64993239397585], [165.72981786742537, -21.650149392766973], [165.7302424302776, -21.650649433459566], [165.73054434163913, -21.650083349656626]], [[165.74065365488653, -21.644177208646013], [165.74104047881855, -21.643648863763264], [165.73911579388857, -21.64326203983126], [165.7400875710836, -21.643620559573126], [165.74065365488653, -21.644177208646013]], [[165.73735149936942, -21.647007627660674], [165.73751188978025, -21.64606415465578], [165.7387950130669, -21.646818933059702], [165.74105934827864, -21.645299941521827], [165.73692865192268, -21.644203797430684], [165.73606837608276, -21.646498152238046], [165.73654954731526, -21.64788505755523], [165.73735149936942, -21.647007627660674]], [[165.73878019422042, -21.640337346070652], [165.73834608155164, -21.640186350359766], [165.73702486908138, -21.64090357998647], [165.73813846244917, -21.64079977043524], [165.73878019422042, -21.640337346070652]], [[165.74244419951737, -21.63826115504598], [165.74248194844512, -21.64057327686891], [165.74390697046655, -21.640375094998376], [165.7438880960027, -21.63923318993481], [165.74244419951737, -21.63826115504598]], [[165.74331242485496, -21.642441848791115], [165.74289718665003, -21.643064706098524], [165.74396359385815, -21.64303639440273], [165.74349173226165, -21.642366350935664], [165.74331242485496, -21.642441848791115]], [[165.74420896188835, -21.64365925171012], [165.74528480632839, -21.644735096150182], [165.74562454667787, -21.644602974903165], [165.745067749994, -21.643715875101712], [165.74420896188835, -21.64365925171012]], [[165.74745772898035, -21.644735096150175], [165.74682543444104, -21.644669035526675], [165.74664612703435, -21.645055962035812], [165.74701417907963, -21.645169208818977], [165.74745772898035, -21.644735096150175]], [[165.7415175250898, -21.648344893896727], [165.74189212144944, -21.64772669867211], [165.7404482249641, -21.647773884831764], [165.74052372281952, -21.64798150393423], [165.7415175250898, -21.648344893896727]], [[165.7436978718742, -21.64695740048848], [165.74438355067906, -21.647122715828562], [165.7449249068611, -21.646419392840382], [165.7447078160557, -21.64633444426437], [165.7436978718742, -21.64695740048848]], [[165.74542164619137, -21.63294799346923], [165.74634649492054, -21.633448166761536], [165.74666736080616, -21.633202798731347], [165.74612943858614, -21.632730937134834], [165.74542164619137, -21.63294799346923]], [[165.7599565935073, -21.632689787827974], [165.76004408059922, -21.633160884040844], [165.76050636582107, -21.633283531140528], [165.76010068695294, -21.63225518238169], [165.7599565935073, -21.632689787827974]], [[165.7556075576282, -21.645963354368735], [165.75627739948027, -21.646218082960374], [165.75634344022623, -21.645614281854265], [165.75602267088863, -21.645576544285124], [165.7556075576282, -21.645963354368735]], [[165.76295696430478, -21.646559426419902], [165.76255125378813, -21.646408464367198], [165.76247577276177, -21.646682083087732], [165.76332493430823, -21.646549991291607], [165.76295696430478, -21.646559426419902]], [[165.72621422332043, -21.651345602281285], [165.72573291002863, -21.651128539424196], [165.7253554094076, -21.651326727250236], [165.72578953512178, -21.65191185321283], [165.72621422332043, -21.651345602281285]], [[165.72640297363094, -21.651694790355734], [165.72659172394145, -21.652298791349377], [165.7270919122643, -21.65245922911331], [165.72685597437618, -21.651789165510987], [165.72640297363094, -21.651694790355734]], [[165.7369588347464, -21.65126066464156], [165.73676064692032, -21.651222914579456], [165.7369588347464, -21.652119478554383], [165.73729858530527, -21.65160041520048], [165.7369588347464, -21.65126066464156]], [[165.73838389959073, -21.65240260402016], [165.73879915027385, -21.65176085296441], [165.73822346182678, -21.65144941495207], [165.73783652369022, -21.65218554116306], [165.73838389959073, -21.65240260402016]], [[165.74279175373002, -21.648326016435377], [165.7420456556147, -21.648712535449643], [165.74194184294396, -21.648967348368835], [165.7431881804181, -21.64881683043014], [165.74279175373002, -21.648326016435377]], [[165.73716155088633, -21.65917111797328], [165.7363403813182, -21.659274944010626], [165.73719664108737, -21.66066489418945], [165.73780338457178, -21.659803512928047], [165.73716155088633, -21.65917111797328]], [[165.75200087369396, -21.66057993446143], [165.7515666350841, -21.660457214854294], [165.75084919738086, -21.661070812889957], [165.75126455605115, -21.66119353249709], [165.75200087369396, -21.66057993446143]], [[165.72624329918574, -21.655329554591265], [165.72571473026832, -21.65555608412731], [165.72660197095115, -21.6560657755834], [165.72674355191117, -21.655480574281967], [165.72624329918574, -21.655329554591265]], [[165.77908367285977, -21.625694123545166], [165.78030054206167, -21.624496120532456], [165.7792396817318, -21.623896030592118], [165.77793283532003, -21.62477911337011], [165.77908367285977, -21.625694123545166]], [[165.77518780479485, -21.622543469952703], [165.77582925522685, -21.624165962221873], [165.77612168115908, -21.62178882238565], [165.77429166080898, -21.62032669272448], [165.77518780479485, -21.622543469952703]], [[165.77354644633652, -21.616544021794606], [165.77311252398545, -21.619619210630358], [165.77385773845793, -21.620288960346127], [165.77465955149793, -21.61756279601014], [165.77354644633652, -21.616544021794606]], [[165.76959397970404, -21.620449322954116], [165.7696222789878, -21.61900605948214], [165.76736776938125, -21.619090957333423], [165.7678677233944, -21.623194353479285], [165.77000903586594, -21.62354337797905], [165.76799035362407, -21.621241702899535], [165.76959397970404, -21.620449322954116]], [[165.72004147043322, -21.651070435505105], [165.71983380812432, -21.65219369981229], [165.7233947447619, -21.654874431436152], [165.72381950857553, -21.65838581229558], [165.72404604927613, -21.655167046507774], [165.72004147043322, -21.651070435505105]], [[165.7301794028379, -21.66085376062379], [165.72973562591574, -21.66260054212604], [165.72664807158472, -21.661864061276443], [165.7262373418801, -21.6641962506335], [165.72787081863638, -21.663091529359104], [165.7316476435061, -21.664016851452182], [165.7332079442804, -21.666981658974912], [165.73440944669204, -21.666405693182273], [165.73355021903419, -21.66431899744176], [165.73591309509328, -21.661306979608153], [165.7301794028379, -21.66085376062379]], [[165.722602147943, -21.66311985554562], [165.7246133071862, -21.6651121306644], [165.7257085863984, -21.66469667992873], [165.72358412240914, -21.663979083203476], [165.7226729634093, -21.66045719401247], [165.722602147943, -21.66311985554562]], [[165.73466674288642, -21.669937024435463], [165.73433627071037, -21.67022972836287], [165.7342324080264, -21.670692389409396], [165.73487446825428, -21.670286380735913], [165.73466674288642, -21.669937024435463]], [[165.73687382491954, -21.666084663068354], [165.7355236100286, -21.664998825918307], [165.73480601330337, -21.665697538519208], [165.73643004799735, -21.66654732411489], [165.73687382491954, -21.666084663068354]], [[165.7360051551995, -21.663799684022173], [165.73874335323006, -21.663204834105194], [165.7389794047844, -21.662770499245166], [165.7371004344117, -21.661958481898186], [165.7360051551995, -21.663799684022173]], [[165.73142339452946, -21.66795419137886], [165.73110236441553, -21.667755908073207], [165.73056718833152, -21.667168234123476], [165.7308555346581, -21.667845251359626], [165.73142339452946, -21.66795419137886]], [[165.72909828671902, -21.665404834591797], [165.7283051534964, -21.665423718716152], [165.72833347968293, -21.665971358322263], [165.7284939947399, -21.665980800384432], [165.72909828671902, -21.665404834591797]], [[165.73325515459126, -21.668161916746698], [165.73318906015604, -21.667718139824505], [165.73275472529602, -21.668775650788028], [165.73312296572084, -21.66886062934759], [165.73325515459126, -21.668161916746698]], [[165.72194818799656, -21.649305305879537], [165.72188211362553, -21.648946616436906], [165.72084380208108, -21.648861663674186], [165.72118361313198, -21.64926754909611], [165.72194818799656, -21.649305305879537]], [[165.72212753271785, -21.6518727671531], [165.7217310864918, -21.651929402328253], [165.72162725533735, -21.652174821420573], [165.72240126939778, -21.65220313900816], [165.72212753271785, -21.6518727671531]], [[165.72457464424423, -21.653194254573314], [165.72378175179207, -21.653203693769164], [165.72580173970584, -21.653732288737256], [165.72578286131412, -21.653590700799374], [165.72457464424423, -21.653194254573314]], [[165.72881063392754, -21.659841267850727], [165.7302453209891, -21.65943540243199], [165.7293769577676, -21.657670359797006], [165.72878231773552, -21.658453774442485], [165.72881063392754, -21.659841267850727]], [[165.73623814701307, -21.65350400282824], [165.73618495847325, -21.65049622588398], [165.7349486439394, -21.652185541163064], [165.73216457685933, -21.649807287250614], [165.73130855477308, -21.653527026124483], [165.72794979087567, -21.65259298784964], [165.73106649055725, -21.654225223103083], [165.72931088665294, -21.654423436447114], [165.72924481553827, -21.657358881684956], [165.73164225312803, -21.65474435328983], [165.73623814701307, -21.65350400282824]], [[165.72771574117, -21.6607757021869], [165.72772517990066, -21.659548667200003], [165.7256864140763, -21.658982343359916], [165.72654533856712, -21.65819892871445], [165.72448769528143, -21.658113980138417], [165.72771574117, -21.6607757021869]], [[165.74737764849448, -21.658918499780263], [165.74897064339478, -21.657257065099092], [165.74783312703636, -21.65560507038771], [165.7460914526121, -21.656785066610126], [165.74782368706659, -21.65430235455816], [165.7456147341382, -21.652773079453898], [165.7441232189131, -21.654047475374107], [165.74131010791882, -21.65099836513538], [165.74133842782817, -21.655189711717416], [165.73642020357306, -21.65379259619007], [165.7374232003621, -21.656379147909615], [165.7405195104497, -21.657106025582625], [165.74097262899912, -21.659654817423046], [165.7437998999481, -21.65889017987093], [165.74721716900822, -21.660362815156507], [165.74737764849448, -21.658918499780263]], [[165.7391955546882, -21.652782519423674], [165.73809107822402, -21.653103478396172], [165.7391955546882, -21.654358994376835], [165.74054547036664, -21.653216758033526], [165.7391955546882, -21.652782519423674]], [[165.75791029477577, -21.651649723050152], [165.75682469825114, -21.650743485951338], [165.7573816564681, -21.652574840088533], [165.75969444906406, -21.651753562717733], [165.75791029477577, -21.651649723050152]], [[165.75401242530108, -21.649675162033244], [165.75769317547085, -21.650280927432153], [165.75781048822626, -21.64893518793784], [165.75602738808482, -21.649057835037514], [165.75665005797546, -21.646586024259395], [165.75401242530108, -21.649675162033244]], [[165.74759476779937, -21.662175289354142], [165.7459570887313, -21.663695821338255], [165.74682575845134, -21.665678654394853], [165.75177339903067, -21.665310413970065], [165.75088584518627, -21.662940456364307], [165.7480667662884, -21.662250809112376], [165.74884084381029, -21.660976413192166], [165.74759476779937, -21.662175289354142]], [[165.77993295818573, -21.64249536044658], [165.7817294237237, -21.64364547859523], [165.78164985606875, -21.64064511288623], [165.77934763714146, -21.639144896454095], [165.77670102890747, -21.64058850094537], [165.77813991573703, -21.637701291962795], [165.77665856995185, -21.63695590140847], [165.77563011969335, -21.63839950589976], [165.77688793123062, -21.63640722837575], [165.77426496556492, -21.63588829631958], [165.7760334797718, -21.634304575512708], [165.77283082606428, -21.633831438351535], [165.7724628560608, -21.635567501957595], [165.77393237729257, -21.6347490045781], [165.77411070121732, -21.63619540974555], [165.77095040499532, -21.638117345379005], [165.77575071037242, -21.642495360446574], [165.77993295818573, -21.64249536044658]], [[165.77039561945162, -21.638365017496724], [165.76751271600145, -21.6370672155999], [165.76738392650023, -21.634273474112092], [165.77149528365427, -21.635204721274697], [165.77198166451782, -21.63420884348328], [165.76980214988194, -21.634001270660825], [165.77356676607118, -21.633510643989542], [165.77301971220945, -21.632479355496933], [165.7715240607956, -21.63154813730442], [165.7685260487802, -21.633123803729486], [165.76937521032664, -21.63174627499858], [165.76683480203351, -21.631161297044365], [165.76516478432552, -21.633067192959718], [165.76489116560498, -21.630963159350202], [165.76282487250865, -21.631255648327315], [165.7618153137812, -21.629802638570066], [165.76383443123612, -21.627047581108254], [165.75864296632713, -21.626065041157293], [165.76044722017858, -21.62430195877475], [165.75796547312638, -21.622464869838755], [165.75776838834707, -21.624900274611488], [165.7561072452073, -21.62467503486373], [165.75830333274803, -21.628236638375302], [165.7523344794322, -21.626786657499043], [165.75193569553127, -21.630786867357195], [165.75541179398832, -21.628368212761142], [165.75994973667636, -21.62824556566147], [165.76296639943305, -21.632859620137257], [165.76587241894754, -21.634256019124745], [165.76850481974154, -21.639983141999103], [165.7714160285766, -21.640267139360756], [165.77039561945162, -21.638365017496724]], [[165.7695436273667, -21.636770009058647], [165.76895912116888, -21.63652233694093], [165.7684189978146, -21.637100899007923], [165.76926623459485, -21.637423863449396], [165.7695436273667, -21.636770009058647]], [[165.77299140511712, -21.63108287227647], [165.7741708672966, -21.628865483379105], [165.7738783606761, -21.627931349332975], [165.77175993900295, -21.63102920524825], [165.77299140511712, -21.63108287227647]], [[165.74566701422154, -21.647075529668932], [165.74676173312545, -21.65035968638068], [165.74825281577046, -21.650227565133655], [165.74748926306876, -21.646246386137218], [165.74566701422154, -21.647075529668932]], [[165.74985006727468, -21.631664529926717], [165.75083153939542, -21.63143803636039], [165.74969907156378, -21.63063587164631], [165.7479909325844, -21.631579594839348], [165.74985006727468, -21.631664529926717]], [[165.7459336160236, -21.63110773324283], [165.74496158113476, -21.631381412968814], [165.7475190709879, -21.631230417257918], [165.748179677223, -21.630239507905234], [165.7459336160236, -21.63110773324283]], [[165.74148160186047, -21.64028072267907], [165.74190155868135, -21.637015440431195], [165.74382675399517, -21.637477864795787], [165.7400801729188, -21.63637370865994], [165.74025004309354, -21.63374072095138], [165.74262822554, -21.632693188207124], [165.73934406882825, -21.63039994084804], [165.7417316885066, -21.632334573393774], [165.73929688266858, -21.633514227385046], [165.73932755367238, -21.636232150180966], [165.74105456711564, -21.638714142178642], [165.7391671207296, -21.640129726968183], [165.74148160186047, -21.64028072267907]], [[165.72395165731754, -21.64266955119089], [165.72519013233637, -21.642592173997784], [165.7244070497423, -21.64123357287074], [165.72294166336067, -21.641791705976036], [165.72395165731754, -21.64266955119089]], [[165.78372326840184, -21.63912602580714], [165.78576837476453, -21.63773903325669], [165.78257215893822, -21.634842388950638], [165.78525414963528, -21.631530590411796], [165.78318781379483, -21.629266112778403], [165.78298023667844, -21.630492704829827], [165.78134792571768, -21.63010585656745], [165.78172533865657, -21.633861115309497], [165.77942311972927, -21.63490843621494], [165.77912590703988, -21.63858821236921], [165.78223248729321, -21.635361331741624], [165.78323263158128, -21.636304864088864], [165.78035249909132, -21.638861836749907], [165.78311479331182, -21.637828352091272], [165.78372326840184, -21.63912602580714]], [[165.74438740484513, -21.629322724719255], [165.74417982772874, -21.626501563000975], [165.74224244130903, -21.626017216396082], [165.74175494959633, -21.626501563000982], [165.74438740484513, -21.629322724719255]], [[165.7508126328941, -21.623921162594947], [165.7495483916924, -21.62204367006406], [165.74963330341492, -21.6234871693466], [165.74769920306903, -21.623515473254102], [165.7508126328941, -21.623921162594947]], [[165.7799609506565, -21.625845053058573], [165.7813098831826, -21.62567525735598], [165.78149854507436, -21.623986733424694], [165.78085709464236, -21.62408106437058], [165.7799609506565, -21.625845053058573]]], [[[165.716024814836, -21.636927342777224], [165.7160528465965, -21.6368952530095], [165.71606765266165, -21.636898784226805], [165.716024814836, -21.636927342777224]]], [[[165.72407447550805, -21.63703511799898], [165.72364047792578, -21.637270986250208], [165.7225554839702, -21.63676151082755], [165.72345846360892, -21.636143910363007], [165.72407447550805, -21.63703511799898]]], [[[165.72442900310486, -21.636496386503012], [165.7244725592007, -21.63648972651793], [165.7244978918642, -21.636499689769774], [165.72439900341192, -21.63651620784629], [165.72442900310486, -21.636496386503012]]], [[[165.7233881192407, -21.633931784199397], [165.72161472989268, -21.63698805094809], [165.71820001210557, -21.636884288805383], [165.72271744352884, -21.633595265125344], [165.7233881192407, -21.633931784199397]]], [[[165.72340460967456, -21.635110433068995], [165.7230366552027, -21.635176476179346], [165.72460469231547, -21.63357322108145], [165.72426317010903, -21.634497175615817], [165.72340460967456, -21.635110433068995]]], [[[165.7236994056688, -21.633063955369522], [165.7235956435261, -21.63306395536952], [165.72350233032083, -21.63304395968267], [165.72375002809937, -21.63303634313467], [165.7236994056688, -21.633063955369522]]], [[[165.7857528478222, -21.684822401264185], [165.78552621576145, -21.686323838666663], [165.7845802811425, -21.68725778793625], [165.78268387199952, -21.687985807112177], [165.7857528478222, -21.684822401264185]]], [[[165.7774736953529, -21.684312479127495], [165.77624610502383, -21.684548554190776], [165.77585894192003, -21.6841330620794], [165.77690259857764, -21.6833318727204], [165.7774736953529, -21.684312479127495]]], [[[165.769752736864, -21.677081001635756], [165.76855386070204, -21.676023725020467], [165.7695356175591, -21.675759405866646], [165.7678836228477, -21.67337109351247], [165.76995097622938, -21.675495086712825], [165.7704040947788, -21.678695236468027], [165.7719050499737, -21.676684522905024], [165.77094473916722, -21.67876223341908], [165.77211951291764, -21.68007257099093], [165.7705047594848, -21.68107352925925], [165.769752736864, -21.677081001635756]]], [[[165.7755181984068, -21.676665642965464], [165.77598075692597, -21.67569332607819], [165.77627339598914, -21.678544196951556], [165.77605164924802, -21.67842221773419], [165.7755181984068, -21.676665642965464]]], [[[165.78779725787024, -21.675318019216412], [165.7879955609234, -21.67681945661889], [165.78648468051838, -21.676488951530295], [165.78541762123237, -21.678509754071996], [165.78652245252852, -21.67545022125185], [165.78779725787024, -21.675318019216412]]], [[[165.7849832431159, -21.675110273160723], [165.78505878713617, -21.673826024816464], [165.78371788077672, -21.672258486396267], [165.78674908458927, -21.674420933975938], [165.7849832431159, -21.675110273160723]]], [[[165.77195224982262, -21.67572164598753], [165.77160297094076, -21.676193644476495], [165.76758154381474, -21.67043526291108], [165.7671874250765, -21.673607092756946], [165.76378903595594, -21.67409797118547], [165.7633453573763, -21.675797165745756], [165.7604189667447, -21.673937491699224], [165.76108920459905, -21.67175685868019], [165.76271287940108, -21.67487204870738], [165.76354359674167, -21.674003571487678], [165.76008856780243, -21.67031254330395], [165.76383623580483, -21.672587576020774], [165.76052988638958, -21.6686888685019], [165.7616060429444, -21.66737671270257], [165.76333355741403, -21.66932134647712], [165.7624178803455, -21.665384879079127], [165.77535771892056, -21.669217506809545], [165.77518071948714, -21.67377701221298], [165.77346028499488, -21.67453220979533], [165.7750461999178, -21.674418930157977], [165.7744609217915, -21.67657124326767], [165.77309915593818, -21.674435199042055], [165.77195224982262, -21.67572164598753]]], [[[165.78067242190622, -21.66091033340372], [165.77758555178835, -21.66247736838709], [165.77969066504915, -21.664912880590165], [165.78096506096935, -21.663638484669953], [165.7834062616932, -21.669642774695095], [165.7778915482149, -21.667782503196428], [165.77678671691874, -21.668679588436902], [165.77901098722504, -21.665129999895093], [165.77322664574274, -21.661420091771802], [165.77407624302288, -21.660410015005414], [165.7782935495218, -21.66148617156026], [165.7818108969722, -21.65904036193214], [165.78067242190622, -21.66091033340372]]], [[[165.78161641888414, -21.663336405637015], [165.78160697891437, -21.66327032584856], [165.78166828601383, -21.663199822684188], [165.781673067464, -21.663387389358864], [165.78161641888414, -21.663336405637015]]], [[[165.76399177054486, -21.66042147782585], [165.76557408928883, -21.659567385322003], [165.76929613451614, -21.660259649772488], [165.76448624515237, -21.66213865328095], [165.76303878311953, -21.660808067064433], [165.76399177054486, -21.66042147782585]]], [[[165.77586747728847, -21.657908423013883], [165.77779323112344, -21.6582199420166], [165.77812363006572, -21.6588146601127], [165.77487628046163, -21.659645377453284], [165.77586747728847, -21.657908423013883]]], [[[165.76584694936764, -21.65809250242457], [165.76711190531807, -21.65604402898245], [165.7687072602108, -21.655864669556642], [165.76617734830992, -21.659074259281624], [165.76584694936764, -21.65809250242457]]], [[[165.78235981650425, -21.654783793016914], [165.78319997381462, -21.656539627395876], [165.78006590384788, -21.657190985310653], [165.77954670551, -21.65943769811814], [165.77662031487841, -21.656964426035948], [165.77812127007334, -21.65662458712389], [165.77716075314822, -21.655095312019636], [165.77888590762547, -21.653075158486853], [165.77902750717215, -21.655331311264117], [165.78077390158134, -21.65542571096191], [165.78143469946588, -21.65354715697582], [165.779615145291, -21.651678042959507], [165.78027594317555, -21.65047916679753], [165.78128601994194, -21.651479803594142], [165.7812577000326, -21.649233090786655], [165.78484724854115, -21.650413087009074], [165.78235981650425, -21.654783793016914]], [[165.78280821506883, -21.652291640995166], [165.7819586177887, -21.65164028308039], [165.78159989893706, -21.651857402385318], [165.78301589440397, -21.652622039937444], [165.78280821506883, -21.652291640995166]]], [[[165.77041769283034, -21.650693813729404], [165.7726832855774, -21.649866692567784], [165.77415771895247, -21.652500893658598], [165.77128976622902, -21.651763676971065], [165.77041769283034, -21.650693813729404]]], [[[165.7839292114801, -21.648534533022985], [165.78495816818608, -21.64848733317409], [165.78561896607061, -21.64922365081688], [165.78408969096637, -21.64940301024269], [165.7839292114801, -21.648534533022985]]], [[[165.77077240970826, -21.647438016953213], [165.77240966467608, -21.647609108909215], [165.77297997119607, -21.648597640210543], [165.77009041816143, -21.64935804890387], [165.77077240970826, -21.647438016953213]]], [[[165.7835710385278, -21.646535031629885], [165.78348549254983, -21.645365903263894], [165.78543403982647, -21.647323955649213], [165.78301023711649, -21.64782772640854], [165.7835710385278, -21.646535031629885]]], [[[165.77407458529467, -21.60360393846344], [165.77405810838764, -21.6038820719874], [165.77405836936538, -21.603239080054347], [165.77407458529467, -21.60360393846344]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 23.84194571573963, "forest_fragmentation_fragment_size_distribution": {"10": 2.3681486790353166, "100": 5.575229756195162, "1000": 9.11207122154025, "1100": 9.11207122154025, "1200": 9.11207122154025, "12000": 100.0, "125": 9.11207122154025, "1300": 9.11207122154025, "1400": 9.11207122154025, "150": 9.11207122154025, "1500": 9.11207122154025, "1600": 9.11207122154025, "1700": 9.11207122154025, "17000": 100.0, "175": 9.11207122154025, "1800": 9.11207122154025, "1900": 9.11207122154025, "20": 2.7759105089032508, "200": 9.11207122154025, "2000": 9.11207122154025, "225": 9.11207122154025, "250": 9.11207122154025, "27000": 100.0, "275": 9.11207122154025, "30": 2.7759105089032508, "300": 9.11207122154025, "325": 9.11207122154025, "350": 9.11207122154025, "375": 9.11207122154025, "40": 2.7759105089032508, "400": 9.11207122154025, "425": 9.11207122154025, "450": 9.11207122154025, "475": 9.11207122154025, "50": 2.7759105089032508, "500": 9.11207122154025, "500000": 100.0, "60": 2.7759105089032508, "600": 9.11207122154025, "70": 2.7759105089032508, "700": 9.11207122154025, "7000": 100.0, "80": 2.7759105089032508, "800": 9.11207122154025, "90": 5.575229756195162, "900": 9.11207122154025}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 19, "land_use_category_distribution": null, "name": "FARINO", "num_families_unique_taxonomic_count": 76, "num_occurrences_count": 3446, "num_species_unique_taxonomic_count": 370, "rainfall_mean": "1484.642822265625", "rainfall_range": "{\"min\": 920.0, \"max\": 2005.0}", "shape_area": "4799.207192183444", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[165.7751180622333, -21.601359396208036], [165.78260586755943, -21.607229775785708], [165.78689403391817, -21.607054223614906], [165.7919873732156, -21.613237812047927], [165.79961934925544, -21.61768237131594], [165.79918215103615, -21.619665383320257], [165.79084470955038, -21.622905451189784], [165.78675057081526, -21.63055264746366], [165.7888730386754, -21.6359330729115], [165.78846090691908, -21.644816376947666], [165.78175493779227, -21.658590467143352], [165.7814247387165, -21.664330601853656], [165.78826896066028, -21.671474039040863], [165.78868938111736, -21.682464690640828], [165.79058661446604, -21.682801178435742], [165.79340231771116, -21.684330112398357], [165.79007114972921, -21.683507840344635], [165.7886190626554, -21.684670033256584], [165.78684262566318, -21.694017985347273], [165.78400241996619, -21.69289896577023], [165.77071242929142, -21.694375588180815], [165.76782284330224, -21.690936596203024], [165.76850410212268, -21.68921318977855], [165.76039651443597, -21.67919976951919], [165.7609335841201, -21.675576355216574], [165.7585305481695, -21.669778051339463], [165.75398121105573, -21.667380202495373], [165.74952153530157, -21.668723512251557], [165.7448909603511, -21.666914950160372], [165.73184071481361, -21.67406315377671], [165.72829266160224, -21.673497859612837], [165.7208138190329, -21.67916916154359], [165.71560638427422, -21.669372917467765], [165.72306419537955, -21.667012039922547], [165.71917731345292, -21.658641325146224], [165.71444838746413, -21.653049120877977], [165.71902758103684, -21.648010879168037], [165.7156609202891, -21.646928966525564], [165.71398185804136, -21.64336407400952], [165.71407133216223, -21.6418003749888], [165.71685842302585, -21.64082697108856], [165.71568279176415, -21.63817348795608], [165.71669704540068, -21.635558897372444], [165.71788702051964, -21.63482386711884], [165.71945880959925, -21.63636629715366], [165.72371508926162, -21.63302983470855], [165.72358262400104, -21.6363543882674], [165.72551548598426, -21.63490047154778], [165.72747485119854, -21.635936814534944], [165.72886456367831, -21.63400245297825], [165.73099804320188, -21.634697713084403], [165.7329912356979, -21.63219346018877], [165.73469971792582, -21.632435293616666], [165.73549205601253, -21.63021531400497], [165.7400820883078, -21.629585560373986], [165.74198352544488, -21.62564035753923], [165.74425411311154, -21.625600213884624], [165.74838259286338, -21.620989428548864], [165.75088590065945, -21.62134103510066], [165.75256404539613, -21.618095822373988], [165.75613641170375, -21.619192017702336], [165.76223480815477, -21.61268141380766], [165.77187192813005, -21.608714619680384], [165.771530523513, -21.60573127527687], [165.7751180622333, -21.601359396208036]]]}, \"bbox\": [165.71398185804136, -21.694375588180815, 165.79961934925544, -21.601359396208036]}], \"bbox\": [165.71398185804136, -21.694375588180815, 165.79961934925544, -21.601359396208036]}", "shape_id": 19, "type": "communes"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "communes";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>