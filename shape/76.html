<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - Haute Pourina</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">Haute Pourina</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 4462.088617327983</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 3931.360056443456</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 69</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 240</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 509</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 3474.4736328125</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 2890.0, "max": 4185.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 501.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 990.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [75.0, 175.0, 275.0, 375.0, 475.0, 575.0, 675.0, 775.0, 875.0, 975.0], "forest": [92.2363227049608, 288.9330590757808, 650.0993829205067, 714.5536807143349, 789.0095074761706, 522.302068329296, 395.6160347345306, 358.94376185183535, 111.12809964453108, 2.2225619928906215], "non_forest": [5.556404982226554, 24.448181921796838, 61.12045480449209, 75.56710775828113, 152.24549651300757, 104.4604136658592, 84.45735572984361, 21.114338932460903, 1.1112809964453108, 0.0]}, "elevation_max": 990.0, "elevation_median": 501.0, "forest_area": "3931.360056443456", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[166.69950658046946, -22.081838424752615], [166.69914859263318, -22.081766274977582], [166.69932891663376, -22.081741500063384], [166.69950658046946, -22.081838424752615]]], [[[166.69300190200494, -22.080079652708832], [166.6931520588546, -22.08017147331188], [166.69267246547835, -22.080323473635758], [166.6927691647763, -22.080051154272663], [166.69300190200494, -22.080079652708832]]], [[[166.68478738036995, -22.055355299684937], [166.68616384283817, -22.05557363511093], [166.68298373989435, -22.05654190526099], [166.68288245977118, -22.056213586254522], [166.68478738036995, -22.055355299684937]]], [[[166.69056140310306, -22.05086518418513], [166.69015965471237, -22.050416317664617], [166.69070048117118, -22.04936803770591], [166.6910935957038, -22.05057624572736], [166.69056140310306, -22.05086518418513]]], [[[166.71497967896045, -22.064607695051738], [166.71603527803148, -22.065293378071146], [166.71385785350552, -22.06565643523276], [166.71417947908012, -22.069602293238983], [166.71364889048854, -22.066663257041757], [166.71194330263404, -22.069483939754267], [166.71204367458552, -22.066121852861446], [166.71009445099793, -22.06967930742265], [166.70956083199346, -22.067895570855242], [166.70600659738574, -22.066525289136322], [166.70828652123816, -22.06158535521958], [166.70584578026876, -22.061470824947975], [166.70646234478778, -22.063230615209168], [166.70467733412983, -22.06348697312281], [166.70241758659478, -22.060401183421586], [166.70281636557155, -22.05815093062408], [166.70000592325906, -22.058521225388226], [166.7006230811993, -22.062138720391815], [166.7046764160544, -22.06610807803714], [166.70423959569158, -22.06706718361641], [166.7028056853701, -22.065832691286655], [166.70183708369598, -22.06767493368644], [166.70474524922486, -22.06996082407647], [166.7034609159144, -22.071459127481866], [166.7062775128392, -22.07284518384007], [166.7072189093503, -22.071463493809894], [166.70806445659593, -22.073100400492777], [166.70346853601947, -22.07335189755077], [166.70237291682966, -22.07494383811299], [166.70187424210837, -22.077631826609085], [166.70516230146956, -22.077610378623053], [166.70584250585773, -22.078926637381684], [166.7011524547495, -22.078649981161], [166.70296033081314, -22.080635502715857], [166.70194894563326, -22.082868478784366], [166.69798449038882, -22.08016928183238], [166.69551796837374, -22.080161983822798], [166.69531802870625, -22.078573580542987], [166.6938568550901, -22.07963792694821], [166.690304745837, -22.078414747125606], [166.6905636339801, -22.079613752815735], [166.68924798229264, -22.0772151820498], [166.6895662085131, -22.07926227907974], [166.68727520988492, -22.078406374775632], [166.68649318814568, -22.076208257292627], [166.68590220160735, -22.077899040352275], [166.68524596119065, -22.07540754314552], [166.683779439726, -22.076661305019414], [166.6824208049603, -22.074548374474368], [166.68094892897986, -22.075982266558533], [166.6797144523511, -22.07397861603033], [166.67892628650353, -22.074985189281467], [166.671949, -22.0748733], [166.665524, -22.0716464], [166.6550463, -22.0742838], [166.6516317, -22.0771895], [166.6459196, -22.0695177], [166.6291733, -22.0640289], [166.6204146, -22.0539406], [166.6244488, -22.0509471], [166.625808, -22.0476398], [166.6252098, -22.0438035], [166.6277163, -22.0391533], [166.6266955, -22.0355191], [166.629552, -22.0287642], [166.63244709020813, -22.029388831051744], [166.63203905048667, -22.031818090788875], [166.634158741001, -22.032977227224414], [166.639390882445, -22.03225459839789], [166.63716564256868, -22.028639176679736], [166.63060715346228, -22.027618264841887], [166.6317735, -22.0247656], [166.6450606, -22.0251148], [166.6482744, -22.0207652], [166.652707, -22.0211615], [166.6635861, -22.0173189], [166.6650142, -22.019938], [166.6688927, -22.0208238], [166.673266, -22.0252229], [166.67798771119547, -22.025542282253053], [166.6806303, -22.0281178], [166.6873162, -22.0286596], [166.6880188473002, -22.03082911724308], [166.6900404592791, -22.02810129915462], [166.69227147874733, -22.028016780869184], [166.69836967406584, -22.03445607519685], [166.69736439876363, -22.037860711445873], [166.69469553693003, -22.040090805554566], [166.6976274774291, -22.041384022067298], [166.6978091899616, -22.04563462680589], [166.70024885102595, -22.04760913848444], [166.70219488417067, -22.047219931855494], [166.69880593864548, -22.0457580337858], [166.70119813548678, -22.043802507796464], [166.69984065870779, -22.04509353466321], [166.7027256756076, -22.045656965404596], [166.70487974284654, -22.04898860975413], [166.70473904992386, -22.053071246038993], [166.70888825022982, -22.05775215164731], [166.70686587113332, -22.05928080439161], [166.71005164733896, -22.058693445375038], [166.70899743971154, -22.061265204537932], [166.71497967896045, -22.064607695051738]], [[166.6755647116837, -22.074178031485744], [166.67548874389115, -22.074548374474368], [166.67743541857496, -22.07335188174189], [166.67570715129472, -22.07366524888611], [166.6755647116837, -22.074178031485744]], [[166.67128914935992, -22.068651374578554], [166.67046299961606, -22.068993229644978], [166.67057695130487, -22.069572484063084], [166.6719918514409, -22.069354076659536], [166.67128914935992, -22.068651374578554]], [[166.69989517774152, -22.066262543602114], [166.6998761857934, -22.066765830227716], [166.70074031943358, -22.06678482217585], [166.70062636774477, -22.06646195905754], [166.69989517774152, -22.066262543602114]], [[166.69792558385575, -22.079433266302654], [166.69805857391802, -22.07981323790914], [166.69878051997034, -22.079632751396062], [166.69846704339497, -22.079328774110873], [166.69792558385575, -22.079433266302654]], [[166.6882600561158, -22.07339646740464], [166.6884880390797, -22.07370994397999], [166.68920048584184, -22.07358645320788], [166.68900100074845, -22.073329972373504], [166.6882600561158, -22.07339646740464]], [[166.6501822443603, -22.06784514427733], [166.65006828581954, -22.069469053483278], [166.6520340706478, -22.068842281509053], [166.6533825800469, -22.06548050455639], [166.6501822443603, -22.06784514427733]], [[166.6463836263347, -22.06824399917002], [166.64782710118445, -22.067284848118554], [166.64431337951075, -22.067826151187205], [166.64492115839485, -22.068414936981174], [166.6463836263347, -22.06824399917002]], [[166.6958567229531, -22.061331667700724], [166.69622701771726, -22.062110236179187], [166.6969106388203, -22.062015288803764], [166.69681569144487, -22.061815899315377], [166.6958567229531, -22.061331667700724]], [[166.6817095640152, -22.048974266789525], [166.68137724820122, -22.04907870890249], [166.68125381661315, -22.049610414204853], [166.6818519850783, -22.049354056291214], [166.6817095640152, -22.048974266789525]], [[166.6737529739549, -22.064378291609597], [166.67516254406792, -22.06403838134624], [166.67483970884302, -22.0627422928699], [166.67464547928387, -22.064007996845447], [166.6737529739549, -22.064378291609597]], [[166.68829891186962, -22.063514270493254], [166.6873019644277, -22.063314881004867], [166.68687470123828, -22.0638845652574], [166.68823244870683, -22.06383709156969], [166.68829891186962, -22.063514270493254]], [[166.66957984330728, -22.061848405397104], [166.66978868588865, -22.06230406193831], [166.66963680037492, -22.062693268567255], [166.66997854278083, -22.06205724797849], [166.66957984330728, -22.061848405397104]], [[166.64692991607154, -22.05866830245327], [166.64647425953032, -22.057491189721826], [166.64412003406744, -22.057510175411043], [166.64502185430524, -22.05981693665089], [166.64692991607154, -22.05866830245327]], [[166.6795028324368, -22.046057651693747], [166.68032870991775, -22.046124101606004], [166.67817383419165, -22.04500394594221], [166.67909464011865, -22.045962723247662], [166.6795028324368, -22.046057651693747]], [[166.67534496649833, -22.04707338606685], [166.67518358814, -22.04651330823495], [166.67484184573408, -22.04638990125504], [166.67468996022035, -22.046893022019287], [166.67534496649833, -22.04707338606685]], [[166.642151161519, -22.063221501124982], [166.64503765981547, -22.061588350773047], [166.6434899650052, -22.059423477050707], [166.64193277513473, -22.061569360652673], [166.642151161519, -22.063221501124982]], [[166.67704138929594, -22.04443812746885], [166.67686108814064, -22.044618428624155], [166.67602600910553, -22.044656386762114], [166.6771552637098, -22.045178311159052], [166.67704138929594, -22.04443812746885]], [[166.69964495537508, -22.072337296551563], [166.69993353937474, -22.073040095111427], [166.70048089290935, -22.07276476460886], [166.70011396055543, -22.07179613854984], [166.69964495537508, -22.072337296551563]], [[166.69978501999339, -22.078535889997028], [166.70040798804223, -22.07892334573472], [166.7008182352939, -22.078042073860757], [166.699845797364, -22.077935713462175], [166.69978501999339, -22.078535889997028]], [[166.68813341277897, -22.075065608089012], [166.68839176371054, -22.074432395021393], [166.68753312679084, -22.07454130766902], [166.68773828782474, -22.075392346031908], [166.68813341277897, -22.075065608089012]], [[166.68501980256696, -22.03119925251079], [166.6852570687642, -22.03012680929922], [166.68380294142426, -22.030445346315584], [166.68395447734133, -22.031915796426496], [166.68501980256696, -22.03119925251079]], [[166.71154976199998, -22.065181519285122], [166.71187270484438, -22.06551396044847], [166.7123286241541, -22.065428475577896], [166.71210066449925, -22.064744596613295], [166.71154976199998, -22.065181519285122]], [[166.70115573889095, -22.073415323019784], [166.70274031963964, -22.072329001022666], [166.70326149792268, -22.070053705444916], [166.7016083287446, -22.069974400836188], [166.70115573889095, -22.073415323019784]], [[166.63351938063894, -22.034209393342614], [166.63358081965853, -22.035121467849834], [166.634165496897, -22.03513665427161], [166.6344777995196, -22.034019607425652], [166.63351938063894, -22.034209393342614]], [[166.63795265158575, -22.034789645143565], [166.63818997270093, -22.036982492248104], [166.640952390482, -22.035264287373984], [166.6379603710959, -22.032814466852933], [166.63795265158575, -22.034789645143565]], [[166.6577992231482, -22.026373645095404], [166.6579321229727, -22.02556675330369], [166.6562139180986, -22.024940225559533], [166.65652143377494, -22.026504085113892], [166.6577992231482, -22.026373645095404]], [[166.67145532890606, -22.06757832950896], [166.67224349475364, -22.066087461580395], [166.66810325006034, -22.065745606513957], [166.66942765212696, -22.063531969360913], [166.6660230382413, -22.064078469566486], [166.6669346517518, -22.06727861282738], [166.6654532797972, -22.066946253735004], [166.66498797706788, -22.063755606448176], [166.66381997225753, -22.06439183671073], [166.6642093071943, -22.070041941281147], [166.66879645616723, -22.068936253800587], [166.66852997539522, -22.067468532308737], [166.6699258835832, -22.06875048880791], [166.67003026641186, -22.067184829671298], [166.67145532890606, -22.06757832950896]], [[166.6733806376482, -22.066771171713242], [166.67264232566453, -22.06651478041341], [166.67155978462085, -22.06813859197892], [166.6731812221928, -22.068015144316057], [166.6733806376482, -22.066771171713242]], [[166.68817061725804, -22.0769508559134], [166.68902949861894, -22.076445739546678], [166.68907699506977, -22.07613226297133], [166.68774329842503, -22.07610571422141], [166.68817061725804, -22.0769508559134]], [[166.6964606026188, -22.065498711188223], [166.69570092469343, -22.064359194300145], [166.69327945130627, -22.065204335992135], [166.6956077570562, -22.066837207547703], [166.69486737706447, -22.065555907756266], [166.6964606026188, -22.065498711188223]], [[166.6942283754646, -22.058084467461285], [166.69602144556177, -22.056922572895562], [166.69063022622643, -22.05713995447132], [166.6918073389579, -22.05665581939629], [166.68986079619518, -22.055435435687002], [166.69374414384995, -22.055236046198615], [166.6936681859496, -22.05316619341441], [166.69217276478668, -22.053792846092193], [166.68918192246088, -22.053707393454314], [166.69208313749547, -22.053309969803657], [166.6908657674332, -22.052171043621573], [166.69206186585384, -22.051620458634286], [166.6947203788481, -22.051928427505437], [166.69449422811584, -22.054305561919477], [166.69882760682677, -22.055153518357507], [166.69600139636634, -22.05143060174212], [166.70036810488622, -22.050471824436666], [166.69904787729527, -22.048985945240336], [166.6932348487012, -22.05112208730859], [166.69074317288388, -22.048416908511143], [166.69396043477553, -22.04745309985119], [166.69303955110203, -22.046076624450134], [166.6907001811927, -22.047545924356204], [166.6893089409174, -22.046010187470706], [166.6886349489502, -22.05001616789546], [166.68808436396293, -22.04647533685652], [166.68421610279373, -22.054650056185892], [166.6808360481613, -22.05176571962694], [166.68186833065286, -22.056931111889934], [166.68020708284638, -22.058271027849507], [166.67660938977662, -22.05669141545931], [166.6783037675024, -22.061231370497556], [166.67981312979515, -22.060937092314695], [166.67957732753504, -22.058775002026685], [166.68194893884456, -22.059671000620288], [166.6850721657082, -22.056617848017854], [166.68782034422233, -22.060196650435234], [166.6884753505003, -22.05797532479686], [166.6942283754646, -22.058084467461285]], [[166.63672332820897, -22.044973094197243], [166.634951132781, -22.044200613967227], [166.63442902632752, -22.044627791974612], [166.6353614705503, -22.045435495195033], [166.63672332820897, -22.044973094197243]], [[166.63507631966937, -22.041425143524847], [166.63364954413194, -22.04099036656105], [166.63336386219456, -22.04205948301383], [166.63409004347915, -22.042608062439594], [166.63507631966937, -22.041425143524847]], [[166.6371603146457, -22.039890241260913], [166.63586897219415, -22.03924178926491], [166.63393055233618, -22.040549867213844], [166.6381786975739, -22.040583136273973], [166.6371603146457, -22.039890241260913]], [[166.63264140502727, -22.039858824164458], [166.63388022124872, -22.04014360950271], [166.6328360083418, -22.038947511082046], [166.63533811206239, -22.03754662662786], [166.63512378389242, -22.03625154321326], [166.63327075759702, -22.038226054891805], [166.63168737414418, -22.03752358439079], [166.63264140502727, -22.039858824164458]], [[166.6306467298609, -22.037379619494473], [166.6306846860276, -22.037592174027875], [166.63129957592778, -22.037660495127895], [166.63125070329218, -22.037191334829487], [166.6306467298609, -22.037379619494473]], [[166.65932104479944, -22.033071440269428], [166.65969126573918, -22.03377391077045], [166.66039373624005, -22.033830867838102], [166.66044120046325, -22.033185354404726], [166.65932104479944, -22.033071440269428]], [[166.69072337476408, -22.0461146087614], [166.69061895347338, -22.045801344889323], [166.6912238276333, -22.045344677724525], [166.69025822537824, -22.045782359200107], [166.69072337476408, -22.0461146087614]], [[166.665222627632, -22.05237454647789], [166.66188114632985, -22.054538915048614], [166.66063758368614, -22.05371303756768], [166.6613944813764, -22.056058370126586], [166.66463809931818, -22.054398624103733], [166.6637512367177, -22.05358013774316], [166.665222627632, -22.05237454647789]], [[166.66940710465948, -22.05279907893844], [166.66930455081365, -22.053684559033854], [166.670168399673, -22.05382695170298], [166.67023484958526, -22.0524979534578], [166.66940710465948, -22.05279907893844]], [[166.66490777810128, -22.060620126024027], [166.6656782841732, -22.057244375762018], [166.66529857038887, -22.056722269308555], [166.66322913026423, -22.05886765219006], [166.66490777810128, -22.060620126024027]], [[166.68310714687425, -22.06066179982105], [166.68383809590912, -22.061060499294605], [166.68434121667335, -22.05883917365623], [166.68215786241342, -22.060462450084273], [166.68310714687425, -22.06066179982105]], [[166.67621217895407, -22.059263638427748], [166.67680859104092, -22.057804109665334], [166.67455409388208, -22.057918367729215], [166.67457307957127, -22.058222138756687], [166.67621217895407, -22.059263638427748]], [[166.67469211720376, -22.060406690213817], [166.67571485094035, -22.06103975746281], [166.6757122209243, -22.05944671571117], [166.6751426502478, -22.059494179934216], [166.67469211720376, -22.060406690213817]], [[166.70614427108012, -22.0578850779729], [166.70410290250854, -22.054713835633798], [166.70355695509986, -22.048760635194824], [166.70220870236886, -22.053545982916106], [166.70614427108012, -22.0578850779729]], [[166.71093237126806, -22.066007873034014], [166.70920813938622, -22.06564975012702], [166.7095297384352, -22.063721077745527], [166.7082954225547, -22.0636261303701], [166.70797393498916, -22.066815537103032], [166.70973761920735, -22.067864779806733], [166.71093237126806, -22.066007873034014]], [[166.70418045529084, -22.05920416966412], [166.70319615507324, -22.060534109747177], [166.7048678223019, -22.061622740748653], [166.70582765384248, -22.05930081683286], [166.70418045529084, -22.05920416966412]], [[166.6996057353951, -22.06594131603928], [166.69926366396663, -22.065656256515563], [166.69863653301445, -22.06601733191227], [166.6990654986752, -22.066523730972353], [166.6996057353951, -22.06594131603928]], [[166.7003952074983, -22.064512404777368], [166.69966411270755, -22.0642275626511], [166.6994552284816, -22.064379478451777], [166.700461894329, -22.064937349515283], [166.7003952074983, -22.064512404777368]], [[166.69406315516326, -22.06702971495328], [166.6933469259976, -22.06667571961495], [166.69288146077966, -22.066742214646084], [166.69382852904772, -22.06755665334035], [166.69406315516326, -22.06702971495328]], [[166.69940747312103, -22.06757815218035], [166.70004392556189, -22.068433088294938], [166.7008124873788, -22.067832210879942], [166.7003669014274, -22.06722667844435], [166.69940747312103, -22.06757815218035]], [[166.6703063160439, -22.064938448718248], [166.67306846370087, -22.06433553068451], [166.6724229502675, -22.06270276141186], [166.66998285942762, -22.063527703070548], [166.66939470253345, -22.06546072729195], [166.6703063160439, -22.064938448718248]]], [[[166.70112219272988, -22.042957644626313], [166.69998305137688, -22.042615902220412], [166.7004576936073, -22.041685603448787], [166.7013974852235, -22.042483002395894], [166.70112219272988, -22.042957644626313]]], [[[166.70576291117797, -22.07939100443849], [166.70586595352094, -22.079305135819357], [166.70570156071435, -22.07972310184394], [166.70565587110084, -22.07954672771923], [166.70576291117797, -22.07939100443849]]], [[[166.7050938689787, -22.067895570855242], [166.70571206475307, -22.067825774558138], [166.70611090073652, -22.068653359223816], [166.70573001237233, -22.06877301001886], [166.7050938689787, -22.067895570855242]]], [[[166.70727988314584, -22.052892400385456], [166.70619385701931, -22.052740508619504], [166.70624930467497, -22.052415857872532], [166.70683820660753, -22.05201771887628], [166.70727988314584, -22.052892400385456]]], [[[166.70584518684754, -22.05124825643089], [166.7057027657844, -22.051067856417585], [166.7060225390111, -22.050756145286698], [166.70628842037218, -22.051167377637444], [166.70584518684754, -22.05124825643089]]], [[[166.70528499733254, -22.050013940550397], [166.70510459731923, -22.049691119473962], [166.70524297319704, -22.0495504094617], [166.70564177327293, -22.050167224013908], [166.70528499733254, -22.050013940550397]]], [[[166.7025863084199, -22.045441409504097], [166.7023372768398, -22.045235927332335], [166.70237444492352, -22.045113725294495], [166.7025863084199, -22.045441409504097]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 39.19825487288602, "forest_fragmentation_fragment_size_distribution": {"10": 0.14684110306639608, "100": 0.14684110306639608, "1000": 0.14684110306639608, "1100": 0.14684110306639608, "1200": 0.14684110306639608, "12000": 100.0, "125": 0.14684110306639608, "1300": 0.14684110306639608, "1400": 0.14684110306639608, "150": 0.14684110306639608, "1500": 0.14684110306639608, "1600": 0.14684110306639608, "1700": 0.14684110306639608, "17000": 100.0, "175": 0.14684110306639608, "1800": 0.14684110306639608, "1900": 0.14684110306639608, "20": 0.14684110306639608, "200": 0.14684110306639608, "2000": 0.14684110306639608, "225": 0.14684110306639608, "250": 0.14684110306639608, "27000": 100.0, "275": 0.14684110306639608, "30": 0.14684110306639608, "300": 0.14684110306639608, "325": 0.14684110306639608, "350": 0.14684110306639608, "375": 0.14684110306639608, "40": 0.14684110306639608, "400": 0.14684110306639608, "425": 0.14684110306639608, "450": 0.14684110306639608, "475": 0.14684110306639608, "50": 0.14684110306639608, "500": 0.14684110306639608, "500000": 100.0, "60": 0.14684110306639608, "600": 0.14684110306639608, "70": 0.14684110306639608, "700": 0.14684110306639608, "7000": 100.0, "80": 0.14684110306639608, "800": 0.14684110306639608, "90": 0.14684110306639608, "900": 0.14684110306639608}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 76, "land_use_category_distribution": null, "name": "Haute Pourina", "num_families_unique_taxonomic_count": 69, "num_occurrences_count": 509, "num_species_unique_taxonomic_count": 240, "rainfall_mean": "3474.4736328125", "rainfall_range": "{\"min\": 2890.0, \"max\": 4185.0}", "shape_area": "4462.088617327983", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[166.7090265, -22.0554023], [166.7096486, -22.0609591], [166.7154215, -22.0641887], [166.7169817, -22.0669934], [166.7048351, -22.0761313], [166.7052161, -22.081385], [166.7025874, -22.0831138], [166.6891249, -22.0799891], [166.682068, -22.075648], [166.671949, -22.0748733], [166.665524, -22.0716464], [166.6550463, -22.0742838], [166.6516317, -22.0771895], [166.6461639, -22.0715539], [166.6459196, -22.0695177], [166.6291733, -22.0640289], [166.6204146, -22.0539406], [166.6244488, -22.0509471], [166.625808, -22.0476398], [166.6252098, -22.0438035], [166.6277163, -22.0391533], [166.6266955, -22.0355191], [166.6317735, -22.0247656], [166.6450606, -22.0251148], [166.6482744, -22.0207652], [166.652707, -22.0211615], [166.6635861, -22.0173189], [166.6650142, -22.019938], [166.6688927, -22.0208238], [166.673266, -22.0252229], [166.6783039, -22.0255469], [166.6806303, -22.0281178], [166.6881699, -22.0293098], [166.6920334, -22.0271985], [166.6983737, -22.0344616], [166.6959979, -22.0397511], [166.7016442, -22.0420404], [166.7090265, -22.0554023]]]}, \"bbox\": [166.6204146, -22.0831138, 166.7169817, -22.0173189]}], \"bbox\": [166.6204146, -22.0831138, 166.7169817, -22.0173189]}", "shape_id": 76, "type": "protected_areas"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "protected_areas";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>