<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - 46.0</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">46.0</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 2948.1884381968425</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 2736.1615437795426</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 47</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 162</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 634</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 2308.888916015625</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 1930.0, "max": 2850.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 735.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 1121.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [447.0, 547.0, 647.0, 747.0, 847.0, 947.0, 1047.0], "forest": [78.90095074761706, 457.84777053546804, 836.794590323319, 572.309713169335, 397.83859672742125, 243.37053822152305, 68.89942177960927], "non_forest": [6.667685978671864, 43.33995886136712, 118.90706661964825, 38.89483487558588, 2.2225619928906215, 1.1112809964453108, 0.0]}, "elevation_max": 1121.0, "elevation_median": 735.0, "forest_area": "2736.1615437795426", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[166.02600478650527, -21.656734225353468], [166.02598891920516, -21.656770715993186], [166.02598891920516, -21.656752737203583], [166.02600478650527, -21.656734225353468]]], [[[166.01177749002204, -21.65553971853231], [166.01167370338655, -21.65724748044358], [166.011222243414, -21.657296241926375], [166.01152974034656, -21.655125496261896], [166.01177749002204, -21.65553971853231]]], [[[166.0116076573458, -21.655049090800897], [166.0115462904648, -21.655087445101525], [166.01170118524323, -21.654731319183128], [166.01182466576546, -21.654964174462755], [166.0116076573458, -21.655049090800897]]], [[[166.0144370983274, -21.62962972568445], [166.01476361980457, -21.6296277327326], [166.0145334181, -21.62971397729999], [166.0144370983274, -21.62962972568445]]], [[[166.0757869344, -21.61242813029998], [166.0755510907, -21.616409172799976], [166.07789660999865, -21.615849098188622], [166.0765037103, -21.617081590399977], [166.0779499687463, -21.617800243857126], [166.0734463079, -21.620725596799975], [166.07770386980002, -21.623859766499972], [166.08019565416328, -21.62366938588929], [166.0787139787, -21.625917745399967], [166.07953195030004, -21.62784078399997], [166.0794125587, -21.625606216499975], [166.08087455838412, -21.625722139246463], [166.07982309374975, -21.630552057304378], [166.0774771113, -21.630271879799974], [166.07910969530533, -21.631213208101418], [166.0782383428255, -21.63205450115053], [166.07167466253185, -21.633992258509803], [166.06969221942694, -21.63841190429932], [166.06459842964475, -21.6407675706569], [166.0590040203707, -21.640803320788425], [166.056658325767, -21.638798975686335], [166.0562227362209, -21.64012773063184], [166.04922063613108, -21.63765138834646], [166.04628491149424, -21.6399330974551], [166.04665471867975, -21.644255002714885], [166.0427613945, -21.642906136199983], [166.04506994952825, -21.64535728313632], [166.04656569061092, -21.644688694331006], [166.04453868613362, -21.648681334858498], [166.0426953667, -21.64688666839998], [166.04317261390153, -21.650465177228224], [166.03798297419908, -21.651526964817574], [166.0337222269525, -21.6549911370386], [166.03445334841825, -21.65301618398162], [166.03389653263758, -21.652440493089763], [166.03228334438634, -21.65569422788129], [166.02642976701642, -21.65520044545324], [166.0259511595559, -21.656526179307978], [166.02237343278782, -21.65512907228509], [166.0256207203511, -21.657382935604172], [166.01987674941327, -21.66124332552514], [166.01761571698012, -21.659065515721213], [166.01963664363842, -21.66131265545548], [166.01761129531843, -21.661961399319136], [166.01301924439463, -21.66104438371528], [166.01181373227865, -21.659689359263403], [166.01123923431192, -21.657782071321286], [166.01183410091414, -21.658285346798504], [166.01385578867772, -21.651469400870166], [166.01615539901005, -21.651784529357247], [166.0172970520005, -21.649661620904006], [166.01481907935164, -21.650500493645335], [166.01561319210728, -21.649067115003586], [166.01058789598102, -21.6475647471081], [166.00943096086192, -21.645792204794454], [166.0127657744, -21.645312406799988], [166.00888690493164, -21.64500845343779], [166.0014119999, -21.635127340456634], [166.0015818573, -21.634092400299984], [165.99324917301533, -21.63618981012896], [165.98903477678087, -21.633026938787314], [165.98870208076383, -21.629012357387225], [165.9901664291, -21.62893267919998], [165.9911474873, -21.628366684099987], [165.9884395784448, -21.62864871456542], [165.98816720192616, -21.6240530856293], [165.99053904154243, -21.62162141461457], [165.99447007284192, -21.621089840153918], [166.00141752115331, -21.62331012765995], [166.003223778, -21.625823307199983], [166.0017615488, -21.62623839169998], [166.0019407898, -21.628398717399982], [166.0042331879, -21.625247849299985], [166.0035916938, -21.62548369269998], [166.00276968656192, -21.624305033225326], [166.0081399548, -21.624568875699982], [166.0080424772, -21.628153536299994], [166.0095360858, -21.62634233929998], [166.00890346213666, -21.62449282784059], [166.01123926721397, -21.625319078232167], [166.0119517407, -21.62754690139998], [166.01259744639114, -21.626684916168724], [166.01403091271501, -21.629650531083968], [166.01201852610004, -21.63013819629999], [166.0121176795, -21.63189380389998], [166.01484226434417, -21.629627252718905], [166.01953197213402, -21.630989521254644], [166.0183364617202, -21.631641801307683], [166.01934969750985, -21.63358712642584], [166.01984637759463, -21.63147193577182], [166.0209574458164, -21.63156410791895], [166.0207205726, -21.638817138299988], [166.02263972196232, -21.636435784208988], [166.02137516741755, -21.63250056596127], [166.02327997525234, -21.635637858385245], [166.02838162742145, -21.633206706236447], [166.03432954210703, -21.632971320238465], [166.03880458033, -21.627859135937634], [166.03801255295892, -21.620713785166522], [166.04142873762484, -21.62117619690307], [166.0378325439707, -21.61899032354579], [166.03928409404304, -21.614546977615525], [166.044747076, -21.614329607899993], [166.0423980616085, -21.609367173599974], [166.0464829845, -21.609225659299984], [166.04345962987614, -21.606856220717273], [166.0466469544, -21.605895831999984], [166.04994820110002, -21.607442701799982], [166.0488352093, -21.604660222499984], [166.04696545227412, -21.60503918877214], [166.04806499185594, -21.60336309046957], [166.05194605007668, -21.60168319513006], [166.0529918028412, -21.598187231483323], [166.052523959, -21.602591429399986], [166.0512223936, -21.60349686619998], [166.053759503, -21.604656957199985], [166.0539824223618, -21.597301039954484], [166.0565229717, -21.59815856149997], [166.0581074862, -21.596630636799983], [166.0590034914, -21.60008261479998], [166.05939632541848, -21.596109393778285], [166.06144778158966, -21.594892985590757], [166.0637306021, -21.598239770499976], [166.0631551434, -21.595871899299976], [166.06405647025417, -21.594677850570182], [166.0646362421, -21.59740016679998], [166.0647000315046, -21.59470660789078], [166.06642837443985, -21.595013801646854], [166.0653060383, -21.597192624299975], [166.0695229245, -21.596843575599987], [166.06933986524385, -21.595328559856124], [166.07136397171433, -21.596899792415197], [166.0701717642, -21.599112718199976], [166.07321547109458, -21.600499331199984], [166.0732000362065, -21.602250031913115], [166.067738117, -21.60614954309997], [166.06866260238436, -21.60821449771292], [166.06741707321393, -21.609169689837636], [166.06946785311555, -21.612256826852466], [166.0709464377009, -21.611392345865234], [166.07286194421567, -21.611076095420483], [166.0757869344, -21.61242813029998]], [[166.04158916618647, -21.62130831454208], [166.041173939321, -21.62247849934477], [166.04238301540215, -21.622743266060837], [166.04241108296756, -21.622576919196497], [166.04158916618647, -21.62130831454208]], [[166.05313435906118, -21.614121797294498], [166.05420325119215, -21.615743887984454], [166.0554971732454, -21.613840509891617], [166.05347190394463, -21.613634232462825], [166.05313435906118, -21.614121797294498]], [[166.06165736736858, -21.60437050066118], [166.06157298114772, -21.60491432297342], [166.06214493220025, -21.6047174217914], [166.06202304099233, -21.60390168832304], [166.06165736736858, -21.60437050066118]], [[166.02378159584242, -21.639342372267254], [166.0230021989499, -21.638907186244808], [166.02249763162445, -21.639764999178887], [166.02434225312072, -21.640256677416804], [166.02378159584242, -21.639342372267254]], [[166.02743300155998, -21.63719889320901], [166.02742343401337, -21.63685935698382], [166.02658871189513, -21.637020109057772], [166.02722937437866, -21.637316499824237], [166.02743300155998, -21.63719889320901]], [[166.018833465669, -21.655195151671307], [166.01819155163147, -21.654732595967786], [166.01787059461267, -21.655157392022048], [166.0179838735605, -21.655289550794485], [166.018833465669, -21.655195151671307]], [[166.0171190920465, -21.64708069112369], [166.01554311735256, -21.646882514665172], [166.01466547875057, -21.648326371720096], [166.01785517603528, -21.64876047253399], [166.0191649786296, -21.646941520795174], [166.0171190920465, -21.64708069112369]], [[166.0298118223659, -21.63392554906776], [166.0288775619186, -21.633916112093544], [166.02839627623362, -21.633444263382792], [166.02904759366155, -21.63414607643091], [166.0298118223659, -21.63392554906776]], [[166.0138445551, -21.633686734899985], [166.01303388131006, -21.63474706537383], [166.0154204471, -21.63256379389998], [166.01513735280002, -21.632478865599985], [166.0138445551, -21.633686734899985]], [[166.0073961135, -21.629682523299977], [166.0073772404, -21.629050271999983], [166.0079056892, -21.628502950099993], [166.0078113233, -21.628304781799987], [166.0070752696, -21.629267313499994], [166.0073961135, -21.629682523299977]], [[165.9924775759, -21.623602891599987], [165.9939302968, -21.622668999599988], [165.99379672408008, -21.62165098882486], [165.9916724841, -21.622372214999988], [165.9924775759, -21.623602891599987]], [[165.998601247, -21.622502631899984], [165.99820503, -21.622663005399986], [165.99809268280003, -21.625323319199982], [165.9989691627, -21.623285631999988], [165.998601247, -21.622502631899984]], [[165.9933548684, -21.6277723892], [165.992100998, -21.6281236446], [165.9937502447, -21.6298460641], [165.9941846655, -21.628105733999988], [165.9933548684, -21.6277723892]], [[166.0006200667, -21.625087475799983], [166.0011766571, -21.625795005999986], [166.0014985834, -21.626061509099987], [166.0011722547, -21.62437051179998], [166.0006200667, -21.625087475799983]], [[166.0045684964, -21.62793991929999], [166.004521314, -21.627534150699994], [166.0037824948, -21.628233021199986], [166.0041249819, -21.628355124299986], [166.0045684964, -21.62793991929999]], [[166.0083158315, -21.6396091824], [166.0072211932, -21.639283963799983], [166.0060437561, -21.639944940999985], [166.00630923218463, -21.64145273427574], [166.0083158315, -21.6396091824]], [[166.0344519368837, -21.649196156908975], [166.0346421243, -21.650323419399978], [166.03542677458688, -21.65038005059998], [166.03523666553346, -21.64959978885288], [166.0344519368837, -21.649196156908975]], [[166.0265061127, -21.64281035079999], [166.02592378898925, -21.642692498113643], [166.02619590712362, -21.64340571990595], [166.0263739733, -21.643414416599978], [166.0265061127, -21.64281035079999]], [[166.0315104777246, -21.636247044724684], [166.03090651137484, -21.63594506154981], [166.0306988979421, -21.636133801034102], [166.03126511639502, -21.63648296908006], [166.0315104777246, -21.636247044724684]], [[166.01699279693105, -21.633171852886484], [166.01651646257577, -21.634572689651524], [166.01660005846466, -21.63519010361259], [166.0171285290207, -21.633783994454536], [166.01699279693105, -21.633171852886484]], [[166.0442505607, -21.626553020399978], [166.0438259243, -21.625860391199986], [166.0436766388338, -21.62597644786895], [166.0435239606, -21.62659076579998], [166.0442505607, -21.626553020399978]], [[166.059523235, -21.60750400439998], [166.0602213005, -21.608088870099984], [166.0632725685, -21.607568396999977], [166.0627682962, -21.60680593889998], [166.059523235, -21.60750400439998]], [[166.0467990331, -21.618513713599985], [166.0466473843658, -21.617911003824627], [166.04541114074365, -21.618250734896378], [166.0470248633344, -21.61950585246699], [166.0467990331, -21.618513713599985]], [[166.04299330339188, -21.61908030834824], [166.0431880646995, -21.61737718433708], [166.04224224828772, -21.616928914879452], [166.0424592617, -21.61865522789998], [166.04299330339188, -21.61908030834824]], [[166.04092890889316, -21.618772570346664], [166.04074927548132, -21.619184995343673], [166.04118022251672, -21.619426856512053], [166.04141000442598, -21.619085414008563], [166.04092890889316, -21.618772570346664]], [[166.04008868728627, -21.61925105416319], [166.04062659481653, -21.620175877636267], [166.0411173174757, -21.62005319697148], [166.0407304015329, -21.61955303733807], [166.04008868728627, -21.61925105416319]], [[166.0447093388, -21.609753979299974], [166.0446619958, -21.610447141999984], [166.0466433674, -21.610235127899976], [166.0463603388, -21.609706807899975], [166.0447093388, -21.609753979299974]], [[166.0459169274, -21.614810756499978], [166.04667167020003, -21.61448055649998], [166.0467188417, -21.613103150799976], [166.0457848474, -21.613367310799976], [166.0459169274, -21.614810756499978]], [[166.06594517390002, -21.599224336099986], [166.066482777, -21.598535826799985], [166.0656096063, -21.598024698499977], [166.06547359220002, -21.598479236999975], [166.06594517390002, -21.599224336099986]], [[166.0617575285, -21.609278457699986], [166.0648888309, -21.609589701599983], [166.0662375545, -21.608033482099977], [166.0606257324, -21.60958026999997], [166.0617575285, -21.609278457699986]], [[166.0637098767, -21.61705955559998], [166.06369911321403, -21.617676466875142], [166.0644581196, -21.617785791399985], [166.0639319196082, -21.616990898018603], [166.0637098767, -21.61705955559998]], [[166.0710288245, -21.615559925799978], [166.0691424977, -21.61480539509998], [166.067068784, -21.61544816979998], [166.07013871400002, -21.61606274979997], [166.0710288245, -21.615559925799978]], [[166.0526465703, -21.607392130999976], [166.0517543694, -21.60770052159998], [166.0527597499, -21.607995755499978], [166.0534671224, -21.605854774699978], [166.0526465703, -21.607392130999976]], [[166.05695298190707, -21.626130360093402], [166.0578194125, -21.626447008199975], [166.05753796112532, -21.625149104630573], [166.0562907001, -21.62473900219998], [166.05695298190707, -21.626130360093402]], [[166.0692965145, -21.597447335499982], [166.069013502, -21.597136021799983], [166.0677112344, -21.59749450429998], [166.0688719958, -21.598145432999974], [166.0692965145, -21.597447335499982]], [[166.0667965708, -21.61178663529998], [166.0661833771, -21.61285264909998], [166.066656574, -21.613243960999977], [166.0680606933, -21.61171116529998], [166.0667965708, -21.61178663529998]], [[166.0704662995, -21.611871539099987], [166.0706644083, -21.61252246779998], [166.0719503291, -21.61242043679998], [166.071164397, -21.61178663529998], [166.0704662995, -21.611871539099987]]], [[[166.04171474239433, -21.612498389175578], [166.0412375217, -21.613008807899977], [166.0437093045, -21.614150356499987], [166.0407092017, -21.61313145359998], [166.04171474239433, -21.612498389175578]]], [[[166.04239031299423, -21.61123019113591], [166.0424828474, -21.61127289929998], [166.0423912630539, -21.611362764832183], [166.04239031299423, -21.61123019113591]]], [[[166.0429532856301, -21.607575263369654], [166.0429734302, -21.607602962199984], [166.04292795032765, -21.607620862952157], [166.04293887088042, -21.607595733277062], [166.0429532856301, -21.607575263369654]]], [[[166.04490838701008, -21.605729056785094], [166.0449114418, -21.605782646399977], [166.04471640035152, -21.60585077101084], [166.04490838701008, -21.605729056785094]]], [[[166.05728715475817, -21.640146689993287], [166.05680583584754, -21.640149752286554], [166.0569837949411, -21.640029429844386], [166.05728715475817, -21.640146689993287]]], [[[166.07972573381878, -21.630644361464242], [166.07964434419907, -21.630721524629752], [166.0796496296, -21.6306950977], [166.07972573381878, -21.630644361464242]]], [[[166.06926622110004, -21.60696075879997], [166.0697661564, -21.607309770199976], [166.07008543081332, -21.607210602045704], [166.06941330109822, -21.607525538029893], [166.06926622110004, -21.60696075879997]]], [[[166.07145753113795, -21.606014792035367], [166.0709988279579, -21.606522520800347], [166.0711832645, -21.60607921669998], [166.07145753113795, -21.606014792035367]]], [[[166.0462885333, -21.60532990399998], [166.0457320374, -21.605763782099977], [166.0451758702799, -21.60562347139952], [166.04674410040752, -21.60520259487731], [166.0462885333, -21.60532990399998]]], [[[166.0719545523, -21.598697677599976], [166.07207889619303, -21.598281665791397], [166.07264785674258, -21.59903006905139], [166.0721149089, -21.598744841299972], [166.0719545523, -21.598697677599976]]], [[[166.0628060946, -21.594692680599977], [166.06222921027154, -21.594742427816875], [166.0628914743616, -21.594685295512033], [166.06349350291777, -21.594681448230148], [166.0628060946, -21.594692680599977]]], [[[166.0638249396, -21.594711548099987], [166.0637683371, -21.594758716799976], [166.06359018799188, -21.594680830361227], [166.06383069938008, -21.59467929336585], [166.0638249396, -21.594711548099987]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 27.361615437795425, "forest_fragmentation_fragment_size_distribution": {"10": 0.0, "100": 0.0, "1000": 0.0, "1100": 0.0, "1200": 0.0, "12000": 100.0, "125": 0.0, "1300": 0.0, "1400": 0.0, "150": 0.0, "1500": 0.0, "1600": 0.0, "1700": 0.0, "17000": 100.0, "175": 0.0, "1800": 0.0, "1900": 0.0, "20": 0.0, "200": 0.0, "2000": 0.0, "225": 0.0, "250": 0.0, "27000": 100.0, "275": 0.0, "30": 0.0, "300": 0.0, "325": 0.0, "350": 0.0, "375": 0.0, "40": 0.0, "400": 0.0, "425": 0.0, "450": 0.0, "475": 0.0, "50": 0.0, "500": 0.0, "500000": 100.0, "60": 0.0, "600": 0.0, "70": 0.0, "700": 0.0, "7000": 100.0, "80": 0.0, "800": 0.0, "90": 0.0, "900": 0.0}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 232, "land_use_category_distribution": null, "name": "46.0", "num_families_unique_taxonomic_count": 47, "num_occurrences_count": 634, "num_species_unique_taxonomic_count": 162, "rainfall_mean": "2308.888916015625", "rainfall_range": "{\"min\": 1930.0, \"max\": 2850.0}", "shape_area": "2948.1884381968425", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[165.988881922145, -21.62926058265014], [165.98856628292984, -21.62329946483226], [165.99494369565488, -21.62110875745105], [166.00306700674457, -21.62465509626353], [166.01071067156877, -21.62499345950072], [166.01336487349423, -21.62964367084899], [166.02098088450518, -21.631574728727127], [166.02327997525234, -21.635637858385245], [166.02838162742145, -21.633206706236447], [166.03432954210703, -21.632971320238465], [166.03880458033, -21.627859135937634], [166.03802000404454, -21.61797108468174], [166.0398048954177, -21.613807475362798], [166.04239826433627, -21.612283624841275], [166.04345962987614, -21.606856220717273], [166.05194605007668, -21.60168319513006], [166.05412876309293, -21.597191736510972], [166.0628914743616, -21.594685295512033], [166.06997833564478, -21.595632748293838], [166.0729076673193, -21.599470687029076], [166.0720097460696, -21.605119287512235], [166.06741707321393, -21.609169689837636], [166.06946785311555, -21.612256826852466], [166.07385311477694, -21.61116568827629], [166.0770255918496, -21.613250914008887], [166.0779499687463, -21.617800243857126], [166.07629249990578, -21.620367429545443], [166.08088990062845, -21.625977853130046], [166.07982309374975, -21.630552057304378], [166.07167466253185, -21.633992258509803], [166.0682433505605, -21.639539285308498], [166.05993414068365, -21.6409701366795], [166.04922063613108, -21.63765138834646], [166.04628491149424, -21.6399330974551], [166.04654297027545, -21.64479937424504], [166.04317261390153, -21.650465177228224], [166.03798297419908, -21.651526964817574], [166.03228334438634, -21.65569422788129], [166.02642976701642, -21.65520044545324], [166.02470074721882, -21.658374567371457], [166.01668338046764, -21.66205126669863], [166.01301924439463, -21.66104438371528], [166.01125017664307, -21.657965852006374], [166.01177793312723, -21.654554864489487], [166.01561319210728, -21.649067115003586], [166.01058789598102, -21.6475647471081], [166.0030777944676, -21.635833050819304], [165.99060784393342, -21.63519803766427], [165.988881922145, -21.62926058265014]]]}, \"bbox\": [165.98856628292984, -21.66205126669863, 166.08088990062845, -21.594685295512033]}], \"bbox\": [165.98856628292984, -21.66205126669863, 166.08088990062845, -21.594685295512033]}", "shape_id": 232, "type": "hotspots"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "hotspots";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>