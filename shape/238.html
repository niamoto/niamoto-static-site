<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - 74.0</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">74.0</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 3358.9848601568865</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 3104.2197422805316</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 37</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 104</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 364</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 2373.076904296875</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 1890.0, "max": 2660.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 546.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 887.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [142.0, 242.0, 342.0, 442.0, 542.0, 642.0, 742.0, 842.0], "forest": [37.78355387914056, 85.56863672628893, 411.173968684765, 946.8114089714047, 1034.6026076905844, 486.7410764430461, 91.12504170851548, 10.001528968007797], "non_forest": [5.556404982226554, 11.112809964453108, 48.896363843593676, 75.56710775828113, 100.01528968007797, 21.114338932460903, 1.1112809964453108, 0.0]}, "elevation_max": 887.0, "elevation_median": 546.0, "forest_area": "3104.2197422805316", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[165.1760152815478, -21.055633001394035], [165.1767484733867, -21.055402737015225], [165.17758418401058, -21.057498403930243], [165.17590417802066, -21.05622735833558], [165.1760152815478, -21.055633001394035]]], [[[165.17553351768157, -21.055267729162264], [165.17555429903075, -21.05573699169513], [165.17501014957838, -21.05464082519527], [165.17565545824368, -21.05500941204658], [165.17553351768157, -21.055267729162264]]], [[[165.12318442395443, -21.054220824239493], [165.12437800914762, -21.054913983452824], [165.12389169723556, -21.055435854399086], [165.12318503178508, -21.054959538536412], [165.12318442395443, -21.054220824239493]]], [[[165.15993442886634, -21.05329834297984], [165.1600944190254, -21.052875045454183], [165.16074193911146, -21.05312810336996], [165.15982441178582, -21.053793470225987], [165.15993442886634, -21.05329834297984]]], [[[165.104395550396, -21.046855180997667], [165.1058743641903, -21.047922173229008], [165.1061925899435, -21.04875517593592], [165.10344900539627, -21.04846122395682], [165.1035211131248, -21.046265684008976], [165.104395550396, -21.046855180997667]]], [[[165.12203304056803, -21.04070820570254], [165.12159330491633, -21.04101695626649], [165.1213164191355, -21.039862226040203], [165.1219981497064, -21.040123195515214], [165.12203304056803, -21.04070820570254]]], [[[165.14767493320664, -21.036153506449203], [165.1477409614501, -21.03616934004223], [165.1477353455323, -21.03617550273142], [165.14767493320664, -21.036153506449203]]], [[[165.104745144564, -21.05216559755033], [165.10353844940323, -21.049330430416987], [165.10780243787147, -21.04928867205159], [165.10507879980727, -21.05021527056827], [165.10593052167616, -21.051169947827898], [165.1095058816092, -21.04941970618526], [165.10409604380473, -21.045928582480983], [165.10468269619236, -21.04451897377586], [165.10827832919819, -21.043038704562406], [165.11037632264012, -21.045376367203353], [165.11296892657063, -21.04569459295656], [165.1138300080205, -21.044440409105697], [165.1123418346452, -21.044646319887175], [165.11114491248634, -21.043134229708514], [165.11345119092144, -21.041397642907896], [165.11403591880193, -21.043541889331927], [165.11394547387354, -21.041180980996916], [165.11651013636637, -21.039528163773035], [165.12070670871879, -21.03961348213536], [165.12106000848775, -21.04246714830927], [165.1218459190141, -21.043608589788104], [165.12332417929, -21.0424016557654], [165.1214903880617, -21.042382943610008], [165.12296864833758, -21.041606389161302], [165.12244979177416, -21.039943750395544], [165.12471908936908, -21.039603366557692], [165.12361260596822, -21.039856080613568], [165.1246465830687, -21.042666934196234], [165.12744750534466, -21.039485044430844], [165.12721096456684, -21.042256449652218], [165.12882400377524, -21.040992744060393], [165.1283134615572, -21.038975371950173], [165.1304484014639, -21.037688197514196], [165.1334514328256, -21.037872734782574], [165.13559362143087, -21.040121101854645], [165.13598714269148, -21.037261105430485], [165.13856453672435, -21.036762812791547], [165.14349901969416, -21.039793817747764], [165.14391884543193, -21.036428424690477], [165.14411051995896, -21.040151900224863], [165.14570324591708, -21.03594031599357], [165.1473077798498, -21.03641254965497], [165.14731725237314, -21.038277260652574], [165.15020514715897, -21.038489893450237], [165.1507002421369, -21.037033540144577], [165.14905811389613, -21.03735772767404], [165.15074153941023, -21.0358005798156], [165.1526254183542, -21.03710354269354], [165.15351477901243, -21.035322934089088], [165.1508778097144, -21.033744956037705], [165.1515533247434, -21.03193381572234], [165.1575859826525, -21.027418173871126], [165.15837455802887, -21.024572960258748], [165.16093110168126, -21.023735608266286], [165.162804296486, -21.018363292147022], [165.16426843649762, -21.019852039890537], [165.16323970824612, -21.017972272812735], [165.16645506513007, -21.013436439345732], [165.16702321574135, -21.009652503829734], [165.1707920998963, -21.007282391443248], [165.16968328793104, -21.00870436647396], [165.1705997912824, -21.010369035826447], [165.17150929951038, -21.007255935456875], [165.1780051672674, -21.00924492271495], [165.18370551800348, -21.006402733753106], [165.1890862115756, -21.00740058088062], [165.1924902162118, -21.013042460690297], [165.19338547188858, -21.017298295254694], [165.19192294095234, -21.019117886910813], [165.19677153156258, -21.017943308856236], [165.1989083559794, -21.019513245325], [165.19785179019703, -21.02144523911458], [165.20009447979734, -21.022682893105383], [165.19755245927595, -21.02700463558885], [165.18935588351042, -21.02841760145253], [165.1941741440964, -21.030483359554843], [165.19571506262704, -21.034719480553616], [165.1958412078528, -21.03187205654991], [165.1992521965797, -21.03235754167343], [165.2012103354918, -21.034397739220477], [165.1995205954072, -21.0363708066675], [165.2030994448938, -21.035477254175195], [165.20932337279262, -21.041650238894764], [165.2080151064929, -21.04594653647693], [165.20620364558982, -21.04751063073754], [165.20557843135518, -21.047837482087992], [165.2068840906965, -21.04618859246893], [165.20601869861156, -21.044662013434227], [165.20392930705827, -21.04751180668494], [165.20485213088918, -21.04810362007054], [165.20224616179962, -21.048993190115677], [165.19625633205445, -21.047766793516683], [165.1980217770888, -21.04674974365995], [165.19699513242207, -21.044504558127162], [165.19457724030985, -21.04945548007126], [165.19738181812122, -21.048508075498965], [165.19912164879156, -21.054307284739274], [165.19854620762078, -21.055518514279623], [165.1962843726064, -21.055270123708052], [165.1948195242117, -21.056863986690164], [165.1990306352542, -21.057569983344877], [165.19919810054782, -21.059801436420678], [165.19405212244845, -21.060156797451626], [165.19894440107768, -21.0608621521608], [165.1976483082133, -21.06271754597946], [165.19370172871038, -21.060981973304823], [165.19624498375552, -21.06355508777989], [165.19499357819964, -21.063878941332224], [165.19292882533247, -21.063888222201935], [165.18959865531193, -21.06088978138264], [165.18941013146582, -21.062605480117032], [165.18825177807133, -21.062621307670888], [165.18728488189407, -21.060012113899447], [165.18513154532351, -21.061800319486295], [165.182088787126, -21.06079854986434], [165.17984500415986, -21.06220973513224], [165.1776540119628, -21.05876544749831], [165.18071807062265, -21.058977374456425], [165.17746690964677, -21.05561714726567], [165.17819864785756, -21.054167642571706], [165.17635831494118, -21.05497282402235], [165.17682988982477, -21.053179340087], [165.17299051888114, -21.05392056745338], [165.17089136756246, -21.051978772101727], [165.17229610057592, -21.050401270613733], [165.1700174832739, -21.048725322279907], [165.167291028622, -21.04961018197427], [165.16683367133425, -21.05054298917633], [165.1687975588339, -21.050906820618145], [165.16765079888205, -21.051505013582606], [165.1631483845052, -21.05125644116117], [165.16131743000255, -21.052885816952013], [165.1593486309306, -21.050737872817244], [165.15915496733405, -21.05409864008339], [165.1573567642025, -21.05443643840857], [165.14964583942265, -21.05321163554848], [165.14889643171153, -21.04958523750936], [165.14710701011788, -21.049351018648935], [165.1482229944398, -21.050339762000362], [165.1468640003715, -21.051094017417917], [165.14440999906395, -21.049289018676614], [165.14896033627303, -21.052855585998092], [165.14647783310238, -21.055288258783214], [165.14662884456467, -21.053001951537624], [165.14329996853036, -21.05145790309256], [165.14198332791264, -21.052661641826138], [165.14581904130145, -21.053052852357126], [165.14577501753016, -21.054767006815023], [165.14419501314512, -21.056110012551652], [165.14098002217997, -21.056712342171675], [165.14268161166643, -21.055845417675155], [165.14173974571324, -21.0535081479449], [165.14211501797308, -21.05451900582048], [165.13985600370034, -21.05675901708399], [165.1355611929998, -21.053681473827393], [165.1379105735524, -21.05203386159094], [165.13641191793099, -21.05071542565051], [165.13792498307595, -21.05112298454188], [165.13770887034568, -21.04839809210358], [165.13608100851357, -21.047804024372127], [165.13561000750417, -21.051125015991442], [165.13264582685, -21.049787860682393], [165.13015607148714, -21.052086408662664], [165.12808729007662, -21.048897270005238], [165.12590535635962, -21.050676827187115], [165.12793701020195, -21.049856984028878], [165.1277403693741, -21.05254689837832], [165.12944145392578, -21.052387605532793], [165.1248798807443, -21.053423495816368], [165.1208230370944, -21.051588382214725], [165.12126283317923, -21.049801125784825], [165.1185772698526, -21.05109244194884], [165.12380949866335, -21.055501628507983], [165.12218900786687, -21.05641397528834], [165.12012504636579, -21.054420193860707], [165.1182860338843, -21.05813238280601], [165.1167802502346, -21.058707733913103], [165.11581152310788, -21.058800872058328], [165.11328867613415, -21.05846920902883], [165.10722513674878, -21.05567045339494], [165.10545737792245, -21.054110653267802], [165.10523161347743, -21.051866232065148], [165.104745144564, -21.05216559755033]], [[165.1088316696417, -21.05601744797902], [165.10932763163038, -21.05466057084008], [165.10659516180579, -21.05452020423951], [165.10871937636122, -21.055530843763673], [165.1088316696417, -21.05601744797902]], [[165.1054344638844, -21.04562907588973], [165.10693199684064, -21.046686708540083], [165.10842017021594, -21.04673350644498], [165.10702559265042, -21.04378523843733], [165.10715662678408, -21.045338928879456], [165.1054344638844, -21.04562907588973]], [[165.10769753257597, -21.047150259648244], [165.10716099887165, -21.047142017390183], [165.10633826009825, -21.0470651152869], [165.10704835227605, -21.0474375496852], [165.10769753257597, -21.047150259648244]], [[165.10960836483156, -21.05323818928755], [165.11061900435573, -21.053509564715334], [165.10990781357944, -21.05195617433559], [165.10943056713748, -21.05233048527047], [165.10960836483156, -21.05323818928755]], [[165.11229795141136, -21.055059971213343], [165.1138162538865, -21.057064909097207], [165.11451700887505, -21.056860522225552], [165.1139622445091, -21.055712062661], [165.11229795141136, -21.055059971213343]], [[165.1110035012242, -21.054378681641154], [165.11151933475742, -21.053473539780956], [165.11245367474214, -21.053317816450168], [165.11081857976887, -21.053580599570875], [165.1110035012242, -21.054378681641154]], [[165.11295020740863, -21.044290655810055], [165.11322163525696, -21.043963070475876], [165.11299700531353, -21.04347637226508], [165.11270685830326, -21.043607406398767], [165.11295020740863, -21.044290655810055]], [[165.11705655014256, -21.058246458968323], [165.11741204665626, -21.05583282474396], [165.11578424683051, -21.053484676719474], [165.1156719847736, -21.05519667308792], [165.11705655014256, -21.058246458968323]], [[165.12540507109128, -21.045036575679593], [165.1263672894489, -21.04398597235616], [165.12609766460233, -21.04201652802859], [165.12506616911233, -21.043122591180055], [165.12540507109128, -21.045036575679593]], [[165.12720160317264, -21.04302408397842], [165.12701561124115, -21.043554507992717], [165.12723755674645, -21.044020521739707], [165.12751997393204, -21.043726258244085], [165.12720160317264, -21.04302408397842]], [[165.13046872975605, -21.039785041577648], [165.12933447431936, -21.03862897670914], [165.12984878711293, -21.0414830401034], [165.13337610085262, -21.04251059704], [165.13046872975605, -21.039785041577648]], [[165.13130619261915, -21.048754705407635], [165.13292497572084, -21.04841599356869], [165.13244298679598, -21.04747001531134], [165.13103032181868, -21.047571267871277], [165.13130619261915, -21.048754705407635]], [[165.14007571208526, -21.05523796770093], [165.13956357879894, -21.054980305010744], [165.13867022191306, -21.05546895097755], [165.13919747230105, -21.05565466458967], [165.14007571208526, -21.05523796770093]], [[165.13729992239618, -21.04600734330274], [165.13751557799483, -21.04556665577505], [165.13635291302816, -21.045529150453543], [165.1365029343142, -21.04589482733822], [165.13729992239618, -21.04600734330274]], [[165.13703651491642, -21.04043131290893], [165.13781306334508, -21.039261812263373], [165.13774757130892, -21.03903726813943], [165.13690553084413, -21.040075784712688], [165.1368587508183, -21.040852333141334], [165.13703651491642, -21.04043131290893]], [[165.13850009268432, -21.046438654500044], [165.13915643581066, -21.045735429721823], [165.138715748283, -21.04521973155112], [165.13791876020102, -21.045997966972358], [165.13850009268432, -21.046438654500044]], [[165.13858025576857, -21.0413107773944], [165.1378037073399, -21.041413693451204], [165.13776628331925, -21.041713085616472], [165.13930066816621, -21.0418627816991], [165.13858025576857, -21.0413107773944]], [[165.13901100972947, -21.052469982630615], [165.13940084750234, -21.052527512511492], [165.1405745802156, -21.053952552629884], [165.1400955657947, -21.0519603542131], [165.13901100972947, -21.052469982630615]], [[165.14665584833574, -21.051965847072665], [165.1462460076402, -21.051776019071173], [165.1456171472509, -21.052422664724027], [165.14622335705485, -21.052557637969404], [165.14665584833574, -21.051965847072665]], [[165.1488063694134, -21.041797289662952], [165.14918060961995, -21.042564482086433], [165.1505652983843, -21.041937629740417], [165.15036882227582, -21.04161016955965], [165.1488063694134, -21.041797289662952]], [[165.15518583310697, -21.030705538229213], [165.15463111524943, -21.030754728319533], [165.15374400113896, -21.031337275889037], [165.15602266774513, -21.031280382956112], [165.15652736216936, -21.03009091196657], [165.15518583310697, -21.030705538229213]], [[165.1572310967275, -21.030033122792343], [165.1580675382945, -21.029019314349043], [165.1574178787933, -21.027791738002723], [165.15667075053008, -21.028940447707402], [165.1572310967275, -21.030033122792343]], [[165.16117219831585, -21.029491454801505], [165.16089202521715, -21.02926731632255], [165.16003282771447, -21.029360707355444], [165.16134030217506, -21.03000510548246], [165.16117219831585, -21.029491454801505]], [[165.16327349677857, -21.049585554497554], [165.16454895043537, -21.050233403974016], [165.16538913022518, -21.04775335519689], [165.1593965225678, -21.048684638819324], [165.16364803475716, -21.05105333846769], [165.16327349677857, -21.049585554497554]], [[165.1659863664613, -21.044220551020484], [165.16616857412657, -21.04327914474998], [165.1657839134999, -21.042499700848605], [165.16498422430237, -21.043491720359455], [165.1659863664613, -21.044220551020484]], [[165.16971224813244, -21.031701177219077], [165.16993319427138, -21.031184572846193], [165.16942806680512, -21.030539131991397], [165.16892634246793, -21.03251239530066], [165.16971224813244, -21.031701177219077]], [[165.17322086488997, -21.04221830989528], [165.17283726867822, -21.042302513941756], [165.17236946842002, -21.0428170942258], [165.1731834408693, -21.04308841837557], [165.17322086488997, -21.04221830989528]], [[165.17454941762333, -21.04330360649436], [165.17404419334443, -21.04303228234459], [165.17325828891063, -21.04335974252534], [165.17493301383507, -21.04358428664928], [165.17454941762333, -21.04330360649436]], [[165.17101128258304, -21.0113510037029], [165.17196519423447, -21.009873375850706], [165.17192778593443, -21.0092000264497], [165.17088970560786, -21.0108085833521], [165.17101128258304, -21.0113510037029]], [[165.17737246522844, -21.053286354163504], [165.17702923659834, -21.05377440646306], [165.1770372923011, -21.054125824848278], [165.17772420859762, -21.053537005730885], [165.17737246522844, -21.053286354163504]], [[165.17461183146338, -21.015409804258955], [165.17498591446395, -21.015391100108918], [165.17550963066472, -21.014998312958344], [165.17473340843858, -21.014820623533073], [165.17461183146338, -21.015409804258955]], [[165.19255281762608, -21.035009970644523], [165.1930639865966, -21.03450017992941], [165.19233777925953, -21.034120887668838], [165.19216275969376, -21.034651812599872], [165.19255281762608, -21.035009970644523]], [[165.1972957169416, -21.059019862498694], [165.19656688628055, -21.05908059838712], [165.195038366422, -21.058068333580135], [165.19650615039214, -21.059262806052377], [165.1972957169416, -21.059019862498694]], [[165.19572630490194, -21.043325845979613], [165.19616968353506, -21.04354049417589], [165.1965973606109, -21.04343242036114], [165.19628337554914, -21.04285185300425], [165.19572630490194, -21.043325845979613]]], [[[165.18356345230347, -21.062924851093594], [165.1836185271711, -21.062839954322925], [165.18370026604669, -21.062906346314197], [165.18356345230347, -21.062924851093594]]], [[[165.18230389790867, -21.062475600229195], [165.182983971291, -21.062525072664798], [165.18308360602197, -21.062775984101236], [165.18157095648377, -21.062819622908517], [165.18230389790867, -21.062475600229195]]], [[[165.18470330678264, -21.062688166809878], [165.18487896070388, -21.06262342800664], [165.18491049434908, -21.062658863793317], [165.18469144173437, -21.06273012686288], [165.18470330678264, -21.062688166809878]]], [[[165.17761609252452, -21.057666140101013], [165.17766831375783, -21.057940655853493], [165.17757810889933, -21.058186554244667], [165.1775777971861, -21.057923808773424], [165.17761609252452, -21.057666140101013]]], [[[165.19875444567805, -21.05698852391716], [165.19888873104688, -21.057113508827513], [165.19849475166174, -21.05704620328122], [165.19865516940712, -21.057024499868184], [165.19875444567805, -21.05698852391716]]], [[[165.1976613907229, -21.056616856994722], [165.19833497106197, -21.05616752967411], [165.19869604656844, -21.05674725263135], [165.1982027400229, -21.056601882327275], [165.1976613907229, -21.056616856994722]]], [[[165.20222745943929, -21.03513937357536], [165.20206542881192, -21.03522001803227], [165.20194685679087, -21.035087318069987], [165.20222745943929, -21.03513937357536]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 31.042197422805312, "forest_fragmentation_fragment_size_distribution": {"10": 0.0, "100": 0.0, "1000": 0.0, "1100": 0.0, "1200": 0.0, "12000": 100.0, "125": 0.0, "1300": 0.0, "1400": 0.0, "150": 0.0, "1500": 0.0, "1600": 0.0, "1700": 0.0, "17000": 100.0, "175": 0.0, "1800": 0.0, "1900": 0.0, "20": 0.0, "200": 0.0, "2000": 0.0, "225": 0.0, "250": 0.0, "27000": 100.0, "275": 0.0, "30": 0.0, "300": 0.0, "325": 0.0, "350": 0.0, "375": 0.0, "40": 0.0, "400": 0.0, "425": 0.0, "450": 0.0, "475": 0.0, "50": 0.0, "500": 0.0, "500000": 100.0, "60": 0.0, "600": 0.0, "70": 0.0, "700": 0.0, "7000": 100.0, "80": 0.0, "800": 0.0, "90": 0.0, "900": 0.0}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 238, "land_use_category_distribution": null, "name": "74.0", "num_families_unique_taxonomic_count": 37, "num_occurrences_count": 364, "num_species_unique_taxonomic_count": 104, "rainfall_mean": "2373.076904296875", "rainfall_range": "{\"min\": 1890.0, \"max\": 2660.0}", "shape_area": "3358.9848601568865", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[165.10332943594082, -21.04865677232162], [165.10543243644216, -21.043957427384708], [165.11096461326616, -21.043460108519323], [165.11638913233517, -21.039550846725046], [165.12712486977983, -21.03998660828975], [165.1304484014639, -21.037688197514196], [165.1385214911433, -21.03675886792421], [165.14182553845146, -21.03840594689878], [165.1449092382991, -21.036058864594665], [165.15020227167477, -21.036734485792064], [165.15216120043908, -21.031194906773262], [165.15808278984855, -21.02475639693444], [165.16093110168126, -21.023735608266286], [165.16149953724062, -21.02005235352235], [165.16645506513007, -21.013436439345732], [165.16821261328428, -21.008288700451438], [165.17451341634415, -21.007278616628962], [165.1780051672674, -21.00924492271495], [165.18374854622425, -21.006398707355515], [165.18975391777442, -21.008026082677418], [165.1934274275001, -21.017415278336607], [165.19758180219424, -21.018331888747543], [165.20002093897833, -21.021901683289244], [165.19755245927595, -21.02700463558885], [165.18935588351042, -21.02841760145253], [165.1992521965797, -21.03235754167343], [165.20757861942667, -21.038562497710885], [165.20932337279262, -21.041650238894764], [165.20900367588413, -21.044503999177945], [165.20620364558982, -21.04751063073754], [165.19714314670503, -21.048774961390343], [165.19918350204256, -21.052016477712733], [165.1991939144316, -21.05984185018765], [165.19746149296776, -21.062893338640418], [165.19483819016133, -21.063904080753048], [165.18633221223075, -21.061923897081922], [165.17984500415986, -21.06220973513224], [165.17495927980966, -21.054402127239776], [165.16920571031903, -21.050664290514465], [165.1631483845052, -21.05125644116117], [165.1573567642025, -21.05443643840857], [165.14836421584408, -21.052423752687396], [165.14591556654688, -21.055641628255575], [165.13962150076702, -21.056776864997406], [165.13592795543045, -21.05447373297336], [165.13522737060413, -21.050124459133027], [165.13264582685, -21.049787860682393], [165.12966490246993, -21.052317443599403], [165.12534938587547, -21.05259076219151], [165.12252993526343, -21.056307511250292], [165.1150758955678, -21.058801371996893], [165.10644032302426, -21.05517891084462], [165.10332943594082, -21.04865677232162]]]}, \"bbox\": [165.10332943594082, -21.063904080753048, 165.20932337279262, -21.006398707355515]}], \"bbox\": [165.10332943594082, -21.063904080753048, 165.20932337279262, -21.006398707355515]}", "shape_id": 238, "type": "hotspots"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "hotspots";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>