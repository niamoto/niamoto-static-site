<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - LIFOU</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">LIFOU</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 113719.69562019811</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 50</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 153</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 1616</p>
                        
                    
                
            
                
                    
                        
                        
                    
                
                    
                        
                        
                    
                
            
                
                    
                        
                        
                    
                
                    
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
            

    
        
    
        
            
            

            
            
                
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": null, "elevation_max": null, "elevation_median": null, "forest_area": null, "forest_coordinates": null, "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": null, "forest_fragmentation_fragment_size_distribution": null, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 17, "land_use_category_distribution": null, "name": "LIFOU", "num_families_unique_taxonomic_count": 50, "num_occurrences_count": 1616, "num_species_unique_taxonomic_count": 153, "rainfall_mean": null, "rainfall_range": null, "shape_area": "113719.69562019811", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"MultiPolygon\", \"coordinates\": [[[[167.01773118417262, -20.92843525394777], [167.0177047224172, -20.928470166806086], [167.01770238167242, -20.928430394331738], [167.01773118417262, -20.92843525394777]]], [[[167.01607000265844, -20.92457000461758], [167.01605963036806, -20.92453224581328], [167.0160902980965, -20.924514031768446], [167.01609482829988, -20.924582831338974], [167.01607000265844, -20.92457000461758]]], [[[167.030065253065, -20.762429653218078], [167.03004238257395, -20.76238223515619], [167.03006916392286, -20.762376103085725], [167.0300920202948, -20.762401491412167], [167.030065253065, -20.762429653218078]]], [[[167.03257625467126, -20.761202718066702], [167.03249557576737, -20.761189705490906], [167.03250451773658, -20.761159385924486], [167.03257625467126, -20.761202718066702]]], [[[167.03629277675296, -20.755816972377236], [167.03629576795612, -20.755615020883894], [167.0365223507398, -20.755702909496144], [167.03629277675296, -20.755816972377236]]], [[[167.037667951453, -20.753017894813837], [167.0375961538979, -20.75297269734356], [167.03764885882947, -20.752809380790048], [167.03780929852533, -20.752962550564227], [167.037667951453, -20.753017894813837]]], [[[167.03761991637023, -20.752519174385604], [167.03754201413923, -20.752552303955998], [167.0373277327626, -20.75233276367501], [167.03752661487582, -20.752319277471432], [167.03761991637023, -20.752519174385604]]], [[[167.0388156197808, -20.74836680102337], [167.0388266483025, -20.748298026840573], [167.03890191627696, -20.748335348137033], [167.0388156197808, -20.74836680102337]]], [[[167.03888128704298, -20.748240865236436], [167.03881152130788, -20.7481695548054], [167.03886247560843, -20.748137686053088], [167.0389239129896, -20.74820177812727], [167.03888128704298, -20.748240865236436]]], [[[167.0385608547752, -20.74742847029242], [167.03842823341344, -20.747369066461452], [167.03847173944828, -20.747264259455555], [167.0385864080647, -20.74726915576688], [167.0385608547752, -20.74742847029242]]], [[[167.0391188725103, -20.745089263514544], [167.03898689881967, -20.74507423724151], [167.0391630307333, -20.744936139212015], [167.0391188725103, -20.745089263514544]]], [[[167.0392690542268, -20.744939769425457], [167.03921177687351, -20.744942264747106], [167.03922187802561, -20.7448790180337], [167.03928729044696, -20.744898808729154], [167.0392690542268, -20.744939769425457]]], [[[167.03923491355187, -20.742023334264214], [167.0391571437843, -20.741983602633844], [167.03922924426556, -20.74194327703517], [167.03923491355187, -20.742023334264214]]], [[[167.03903131981286, -20.741949639811388], [167.03899318364734, -20.741968193797486], [167.03894757675, -20.74191617074766], [167.03902445517716, -20.741896490244013], [167.03903131981286, -20.741949639811388]]], [[[167.038993837726, -20.741228499901815], [167.0387442776992, -20.741129711604454], [167.03892137226512, -20.740982131674286], [167.038993837726, -20.741228499901815]]], [[[167.03893213303846, -20.74055696986012], [167.03890313600473, -20.740521779217133], [167.03896468495373, -20.74051458649304], [167.0389760540221, -20.740545613984903], [167.03893213303846, -20.74055696986012]]], [[[167.0380636473809, -20.73745559729924], [167.0380003051001, -20.737470680993454], [167.03795099957298, -20.737443167461635], [167.03803374154944, -20.737425937480193], [167.0380636473809, -20.73745559729924]]], [[[167.03811533639032, -20.737241584134342], [167.03810373839156, -20.737165414577873], [167.0381788882234, -20.73714888772389], [167.038191447425, -20.7372163564271], [167.03811533639032, -20.737241584134342]]], [[[167.05447673405502, -20.9860693238652], [167.05438087984592, -20.986015286895785], [167.05440677029134, -20.98592697318882], [167.0544892668696, -20.985939631308376], [167.05447673405502, -20.9860693238652]]], [[[167.05414709465765, -20.9525901217626], [167.0536176643533, -20.953102870148278], [167.0534024630179, -20.952416145915183], [167.05410106772254, -20.95239058725844], [167.05414709465765, -20.9525901217626]]], [[[167.0545909125462, -20.951867588430005], [167.05458078874412, -20.951746778880132], [167.0546148930459, -20.95173912602534], [167.05470824645894, -20.95185400736595], [167.0545909125462, -20.951867588430005]]], [[[167.0521627209919, -20.950183036403345], [167.05210751496904, -20.95015468544045], [167.052147539256, -20.950122851817785], [167.0521947366777, -20.950145345032297], [167.0521627209919, -20.950183036403345]]], [[[167.0522538660574, -20.95007266698494], [167.05227584046364, -20.950036381369145], [167.05231146310933, -20.950074662151202], [167.0522538660574, -20.95007266698494]]], [[[167.048237356705, -20.776330651878716], [167.04822249202596, -20.776272185680664], [167.04826008440278, -20.77617924142114], [167.04835411666204, -20.77628281715823], [167.048237356705, -20.776330651878716]]], [[[167.05417273873095, -20.773807738996783], [167.05418051778258, -20.773716072723037], [167.05426593677078, -20.773785097240847], [167.05417273873095, -20.773807738996783]]], [[[167.03939033227138, -20.745124943989047], [167.03937648302048, -20.74509073174289], [167.03943550323686, -20.74508429534751], [167.03943400088096, -20.74513339280612], [167.03939033227138, -20.745124943989047]]], [[[167.03934543973236, -20.745082446024952], [167.03933898814603, -20.74512513414031], [167.03922700893204, -20.745124596065004], [167.03926369063294, -20.745089394870508], [167.03934543973236, -20.745082446024952]]], [[[167.0398517374032, -20.744934802036475], [167.03981403474336, -20.74492010784405], [167.03984744208344, -20.74487773971036], [167.039869215312, -20.744886705692252], [167.0398517374032, -20.744934802036475]]], [[[167.0398479547934, -20.74427346153978], [167.0398170166872, -20.744258846059996], [167.03990876337238, -20.744259937588865], [167.0398479547934, -20.74427346153978]]], [[[167.03954330141892, -20.74370042174279], [167.03951065984404, -20.74368577982994], [167.03945104870226, -20.743547272670398], [167.03960432685386, -20.743606905916103], [167.03954330141892, -20.74370042174279]]], [[[167.03966773093194, -20.743461137440303], [167.0397475285036, -20.743412983618533], [167.039769980155, -20.743433052841944], [167.03966773093194, -20.743461137440303]]], [[[167.03929034662778, -20.742347114116804], [167.0392538260856, -20.742307875164624], [167.03928455722632, -20.74227656090988], [167.03933546809662, -20.742309632673738], [167.03929034662778, -20.742347114116804]]], [[[167.04330569268865, -20.72906296253311], [167.04334297460352, -20.72923419268273], [167.0432351806349, -20.729112852725624], [167.04330569268865, -20.72906296253311]]], [[[167.04459808300425, -20.728632958147305], [167.04436346099456, -20.72846131754233], [167.04447803988722, -20.72836584748788], [167.04475712793575, -20.728525848883464], [167.04459808300425, -20.728632958147305]]], [[[167.0466402727586, -20.727285116531384], [167.0466162574116, -20.72720848659986], [167.0466637414633, -20.72716527154128], [167.04673854475138, -20.72723202408038], [167.0466402727586, -20.727285116531384]]], [[[167.05077976834664, -20.72442833651058], [167.05067104898322, -20.72437028193849], [167.05079398037205, -20.724246486114144], [167.05077976834664, -20.72442833651058]]], [[[167.41376307716828, -21.13316471158105], [167.413732715537, -21.133063125430457], [167.41379005612185, -21.133043824898486], [167.41387336616245, -21.133133702068964], [167.41376307716828, -21.13316471158105]]], [[[167.7938061233397, -21.091691797878585], [167.81608658942335, -21.08794810111814], [167.83971701897602, -21.1185428600468], [167.8228731801981, -21.128838050745074], [167.7938061233397, -21.091691797878585]]], [[[167.45570785770173, -21.051465099515795], [167.45569613583524, -21.051429727409303], [167.45574603023687, -21.051430358043046], [167.45573086541714, -21.05147792132785], [167.45570785770173, -21.051465099515795]]], [[[167.09455046296407, -21.0408740797418], [167.09447087613566, -21.04083084402317], [167.09443245242642, -21.04069104819675], [167.09450297210043, -21.040681055000082], [167.09455046296407, -21.0408740797418]]], [[[167.0549191025866, -20.984039780470496], [167.0548838066951, -20.983986910925406], [167.05491218334637, -20.983959990258878], [167.05497920186795, -20.984028086832883], [167.0549191025866, -20.984039780470496]]], [[[167.05783883802064, -20.980133270069597], [167.05762043156898, -20.98008182401], [167.05767501840816, -20.979951221763926], [167.05783853311522, -20.979958268828703], [167.05783883802064, -20.980133270069597]]], [[[167.05904079044961, -20.978048242939423], [167.0588538718456, -20.977998159944324], [167.05891326294088, -20.977858390009107], [167.05905650185, -20.97783427057737], [167.05904079044961, -20.978048242939423]]], [[[167.3716476660141, -20.95106123442985], [167.37162348554995, -20.95103516314736], [167.37166794482297, -20.951033208693918], [167.3716476660141, -20.95106123442985]]], [[[167.35539478655528, -20.941786696417033], [167.35533907123744, -20.941682581089847], [167.35542942473043, -20.941661782930378], [167.35545654184665, -20.941757001572867], [167.35539478655528, -20.941786696417033]]], [[[167.30143322058757, -20.732390041621603], [167.25877556593204, -20.910585860257868], [167.29325792305704, -20.915095782689562], [167.37001026567611, -20.94907620347107], [167.46040846046682, -21.06018622188795], [167.35866390239687, -21.186605808042774], [167.26335339146553, -21.091791895982055], [167.14071350078913, -21.079397279784704], [167.05598875868066, -20.95238225523108], [167.01102070985155, -20.918428933270576], [167.12072766523897, -20.909564045678053], [167.17985371113906, -20.812189106226544], [167.02893001813933, -20.76295808886772], [167.211144049367, -20.679820681963747], [167.30143322058757, -20.732390041621603]], [[167.26925178311254, -20.914241483678108], [167.26825919400892, -20.915244708574363], [167.26957374263938, -20.914943474316697], [167.26925178311254, -20.914241483678108]], [[167.3901636814525, -21.019613483019004], [167.39100930933108, -21.020088296406513], [167.38930257820027, -21.018775749078422], [167.3901636814525, -21.019613483019004]], [[167.38799340572712, -21.017774628262163], [167.38761293694932, -21.017727223114644], [167.38842480173005, -21.018289242787954], [167.38799340572712, -21.017774628262163]], [[167.38888367173436, -21.01821763352691], [167.38851325505584, -21.018322600171796], [167.3892317487839, -21.01872489174673], [167.38888367173436, -21.01821763352691]], [[167.40947331410374, -21.03276105718956], [167.4093036067895, -21.03281316170535], [167.40937949161014, -21.03296200498442], [167.40956473005465, -21.032864546915857], [167.40947331410374, -21.03276105718956]], [[167.40810471490934, -21.031766359857286], [167.40786141115598, -21.031782318210723], [167.40806732368833, -21.031971419324346], [167.40810471490934, -21.031766359857286]], [[167.44067266900757, -21.052299712557648], [167.44049430315968, -21.05242956897221], [167.44075808553038, -21.05243374106201], [167.44067266900757, -21.052299712557648]], [[167.28358761953797, -20.915613206276962], [167.28356904545402, -20.915795855015478], [167.28372657847643, -20.915760339794428], [167.28370972077767, -20.915607849813973], [167.28358761953797, -20.915613206276962]], [[167.3948480300801, -21.022503992698095], [167.39467039550843, -21.022547093165244], [167.3949917747824, -21.022601576034884], [167.3948480300801, -21.022503992698095]], [[167.43957434567696, -21.049180279106], [167.4395465356739, -21.049345334496348], [167.43971846772016, -21.049272242301342], [167.43957434567696, -21.049180279106]], [[167.43859485326072, -21.054001336994855], [167.43849945946448, -21.054097833563002], [167.43860138678167, -21.054193493636596], [167.43868296668325, -21.054036881355014], [167.43859485326072, -21.054001336994855]], [[167.1062527423259, -20.914552494240603], [167.10615898239132, -20.91473767736729], [167.1064016738912, -20.914519768835603], [167.1062527423259, -20.914552494240603]], [[167.08046560102557, -20.927389158908223], [167.08031204454923, -20.927409588315502], [167.0804561761784, -20.927555918236997], [167.08046560102557, -20.927389158908223]], [[167.276640809877, -20.767340620668076], [167.27653135721116, -20.76734103319331], [167.2766036909983, -20.76751815543933], [167.27665502525815, -20.767510035389332], [167.276640809877, -20.767340620668076]], [[167.4392575737355, -21.049917908094752], [167.4390866625231, -21.04989826596382], [167.43916513816455, -21.050028149456185], [167.4392575737355, -21.049917908094752]], [[167.26642779435423, -20.916329005021407], [167.2664083336311, -20.91644910197268], [167.26651132563788, -20.91642283796518], [167.26652046334564, -20.916295066646065], [167.26642779435423, -20.916329005021407]], [[167.26592488544486, -20.91622157776502], [167.26595429161742, -20.9163095946274], [167.26600764213848, -20.916164913342914], [167.26592488544486, -20.91622157776502]], [[167.26796116319463, -20.91699448838198], [167.26787735555374, -20.917074154142675], [167.26796363982, -20.91714573722255], [167.26800793863342, -20.91710108598721], [167.26796116319463, -20.91699448838198]], [[167.1053118789887, -20.91536594766274], [167.10538989430995, -20.91538027028289], [167.10535727632166, -20.915246204924102], [167.10526994258655, -20.915286412168403], [167.1053118789887, -20.91536594766274]], [[167.27624337637735, -20.770222618808482], [167.2762013685448, -20.770251421777548], [167.27622433776958, -20.770351681103644], [167.2763326456333, -20.770205972370185], [167.27624337637735, -20.770222618808482]], [[167.39516299942588, -21.022623891781404], [167.39511045056824, -21.022728245131134], [167.3952584567251, -21.022747706697988], [167.39516299942588, -21.022623891781404]], [[167.07422819360383, -20.771387435487163], [167.0741695271754, -20.771446042212872], [167.07422799803493, -20.771497766815983], [167.0743045415522, -20.771432211275027], [167.07422819360383, -20.771387435487163]], [[167.08643865039576, -20.924865170274575], [167.08633983514028, -20.924840888490085], [167.08638209585473, -20.924949563829134], [167.08643865039576, -20.924865170274575]], [[167.4383818499047, -21.05308396523353], [167.43827397187204, -21.05309894879863], [167.43833670505174, -21.05317004616744], [167.4383818499047, -21.05308396523353]], [[167.3042067654125, -20.924928047464846], [167.30419911969315, -20.924979417121083], [167.3043266906013, -20.924963960802273], [167.30432322962463, -20.924920347162832], [167.3042067654125, -20.924928047464846]], [[167.10198174780206, -20.91610226252493], [167.10192998548433, -20.916163605878776], [167.10208048660903, -20.91611819457615], [167.10198174780206, -20.91610226252493]], [[167.10094817015968, -20.91607071033518], [167.10079150482377, -20.91608447332549], [167.1009981978584, -20.91610994849214], [167.10094817015968, -20.91607071033518]], [[167.27747450581586, -20.91847851975379], [167.27745392581494, -20.91855823421426], [167.27752436813816, -20.918574750173093], [167.27752884012028, -20.91849225621482], [167.27747450581586, -20.91847851975379]], [[167.2760846892549, -20.919078723567804], [167.27600702324156, -20.919075065644872], [167.27604003132103, -20.91914080782126], [167.2760846892549, -20.919078723567804]], [[167.27689372305736, -20.91918739872254], [167.27681479421597, -20.91919961355943], [167.2768892264916, -20.91926909886016], [167.27692016214957, -20.919259630704275], [167.27689372305736, -20.91918739872254]], [[167.05072693117881, -20.948306872425164], [167.0506885677007, -20.948370020155835], [167.05075783017577, -20.94839801635664], [167.05079154318395, -20.94836922181111], [167.05072693117881, -20.948306872425164]], [[167.27632847627265, -20.76452376310375], [167.2762647132187, -20.764576275318696], [167.27629687878147, -20.764616538590076], [167.27635321260348, -20.76459889489896], [167.27632847627265, -20.76452376310375]], [[167.08374686004623, -20.768959641242283], [167.08371281531612, -20.769001476936722], [167.08376625044016, -20.769056596609822], [167.08379528584194, -20.769006431082072], [167.08374686004623, -20.768959641242283]], [[167.27707384653033, -20.918961986523897], [167.27710448210104, -20.91903333536411], [167.27715218740275, -20.91899018931168], [167.27707384653033, -20.918961986523897]], [[167.2772253059081, -20.91885928042568], [167.27720184437598, -20.918925606719373], [167.27726532293804, -20.918965264363166], [167.27724098988548, -20.91884701617958], [167.2772253059081, -20.91885928042568]], [[167.39841242081127, -21.026177924432115], [167.39838092709778, -21.026209147783955], [167.39841305254038, -21.026245035294625], [167.39847171489126, -21.026201217545875], [167.39841242081127, -21.026177924432115]], [[167.16273316838502, -20.703878136302002], [167.1626986776646, -20.703928041164872], [167.16275677126578, -20.703963649686408], [167.16277777867953, -20.703908210015122], [167.16273316838502, -20.703878136302002]], [[167.27735015324487, -20.918831971150517], [167.27733573566996, -20.918890141767733], [167.27742757592398, -20.91888791188875], [167.27741993811293, -20.91882472210205], [167.27735015324487, -20.918831971150517]], [[167.1051480966077, -20.915665227521476], [167.10521540351564, -20.915633671341986], [167.10516081799975, -20.915586376726743], [167.1051480966077, -20.915665227521476]], [[167.27671359573844, -20.919168005370786], [167.27668317142547, -20.919226567941084], [167.27672193605676, -20.91925652530127], [167.27676677796444, -20.91923167039163], [167.27671359573844, -20.919168005370786]], [[167.08199604492398, -20.92688797494322], [167.0819839486856, -20.926944663241084], [167.08204596771796, -20.92695597008519], [167.08203681771747, -20.926895267561587], [167.08199604492398, -20.92688797494322]], [[167.10953927818613, -20.912218825034333], [167.10946857485524, -20.912231209049665], [167.10951702243307, -20.91228155562648], [167.10953927818613, -20.912218825034333]], [[167.27894688298846, -20.91774998764692], [167.27896456965297, -20.917846851581547], [167.27899983611428, -20.91784933641491], [167.27894688298846, -20.91774998764692]], [[167.08385188858307, -20.769085942788784], [167.08383898610813, -20.76911009278559], [167.0838797833701, -20.769147991766747], [167.08390129961018, -20.769080986788314], [167.08385188858307, -20.769085942788784]], [[167.27691588866443, -20.91895263582891], [167.27690886006218, -20.919003508015127], [167.27695229125814, -20.919019095182566], [167.27694354827545, -20.91894642027009], [167.27691588866443, -20.91895263582891]], [[167.10410782160065, -20.915990108141358], [167.10414093406976, -20.91600464803855], [167.10417261013907, -20.915973897813085], [167.10411771275866, -20.915951589737087], [167.10410782160065, -20.915990108141358]], [[167.31799016209015, -20.936432408976714], [167.31798020118154, -20.936471855223733], [167.3180155622404, -20.936474765565244], [167.31802259127494, -20.93640914882742], [167.31799016209015, -20.936432408976714]], [[167.32187876866197, -20.937509115494564], [167.32187389118408, -20.937547061877797], [167.3219319711502, -20.937504382316668], [167.32188738168796, -20.93749895547037], [167.32187876866197, -20.937509115494564]], [[167.3253422528222, -20.93798439893905], [167.32531959696715, -20.938026813813746], [167.3253666763955, -20.93803387564809], [167.32538263306233, -20.93798896954784], [167.3253422528222, -20.93798439893905]], [[167.3153426821564, -20.934839337934214], [167.31531251185314, -20.93487767554418], [167.31537571737567, -20.93487944045809], [167.31538573413155, -20.934836824276502], [167.3153426821564, -20.934839337934214]], [[167.3060847479425, -20.928504547616196], [167.30607001418085, -20.92852728985258], [167.30608978385192, -20.928553724896034], [167.3061301614767, -20.92851079690564], [167.3060847479425, -20.928504547616196]], [[167.26765155374622, -20.9168649456178], [167.26761950200134, -20.916895037250736], [167.26765714010426, -20.916914722225872], [167.26767035538379, -20.916873996049805], [167.26765155374622, -20.9168649456178]], [[167.27738265395595, -20.919124289420132], [167.2773767003517, -20.91915294506358], [167.27741079044128, -20.919166381734268], [167.27743085819188, -20.919129451971653], [167.27738265395595, -20.919124289420132]], [[167.3214743902578, -20.937444306714546], [167.3214644722634, -20.93748137356198], [167.32149643763296, -20.937485033672406], [167.32151388226814, -20.937452028776974], [167.3214743902578, -20.937444306714546]], [[167.27735367954062, -20.91902121965497], [167.2773429278002, -20.919059505084416], [167.27737777837464, -20.919069742789556], [167.27737387079927, -20.919019937327317], [167.27735367954062, -20.91902121965497]], [[167.31758601997183, -20.936050784839942], [167.31754543513847, -20.93605729466979], [167.3175633696032, -20.93609241905288], [167.3175973481775, -20.936077887891507], [167.31758601997183, -20.936050784839942]], [[167.32059961866307, -20.937377002686087], [167.32058821474203, -20.937402179471814], [167.32063031433728, -20.937405202889295], [167.32063419535464, -20.93737595052835], [167.32059961866307, -20.937377002686087]], [[167.26773940763775, -20.91674795137834], [167.2677188547931, -20.9167674600795], [167.26774318833083, -20.916793800686516], [167.26775839955158, -20.916764122794774], [167.26773940763775, -20.91674795137834]], [[167.2773437865185, -20.91893748647117], [167.27733169501647, -20.918957577260645], [167.27735117890163, -20.9189610724524], [167.2773599894682, -20.91894421624381], [167.2773437865185, -20.91893748647117]], [[167.4498105491509, -21.049084432978322], [167.44979384656946, -21.049075470382224], [167.4498117262672, -21.049108325061784], [167.4498105491509, -21.049084432978322]], [[167.44551343386635, -21.049508931914758], [167.44550539917356, -21.04951753156023], [167.4455199811621, -21.049529465893606], [167.4455305441069, -21.049521008701642], [167.44551343386635, -21.049508931914758]]], [[[167.26901863995204, -20.915022695117052], [167.26899624902032, -20.915036706119935], [167.26897402929455, -20.91502535684178], [167.2690055167406, -20.91500558301898], [167.26901863995204, -20.915022695117052]]], [[[167.26931606365903, -20.91477068449958], [167.26927977450686, -20.914738300191054], [167.26932747852567, -20.914726051648334], [167.26931606365903, -20.91477068449958]]], [[[167.13736940199644, -20.87548419960216], [167.13616579130826, -20.87603687897412], [167.13604974020436, -20.87527627715982], [167.13658192214345, -20.874616578620493], [167.13736940199644, -20.87548419960216]]], [[[167.25753486273095, -20.706462870093333], [167.25749282125702, -20.706452457432214], [167.25751646569975, -20.706426398807963], [167.25753486273095, -20.706462870093333]]], [[[167.25708340491002, -20.705806638577442], [167.25704305002637, -20.70579068411333], [167.25705499342783, -20.705742411392333], [167.25711888730658, -20.705767150912987], [167.25708340491002, -20.705806638577442]]], [[[167.25110449773447, -20.699378654462443], [167.2510408748435, -20.699275509394198], [167.25118707318683, -20.699223288647676], [167.25125288904138, -20.699318691463176], [167.25110449773447, -20.699378654462443]]], [[[167.16182052067077, -20.69822343715366], [167.1616823476885, -20.698105817063126], [167.16184532938956, -20.69810510094397], [167.16182052067077, -20.69822343715366]]]]}, \"bbox\": [167.01102070985155, -21.186605808042774, 167.83971701897602, -20.679820681963747]}], \"bbox\": [167.01102070985155, -21.186605808042774, 167.83971701897602, -20.679820681963747]}", "shape_id": 17, "type": "communes"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "communes";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>