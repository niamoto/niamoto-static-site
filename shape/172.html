<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Niamoto - 70.0</title>
    <link rel="stylesheet" href="../js/vendor/tailwindcss/2.2.19_dist_tailwind.css">
    <link rel="stylesheet" href="../js/vendor/leaflet/1.9.4_leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
<script src="../js/shape_list.js"></script>

<style>
    #shape-type-list li, #shape-list li {
        list-style: none;
        text-transform: capitalize;
    }

    .shape-type-link, .shape-link {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-decoration: none;
    }

    .shape-type-link:hover, .shape-link:hover {
        background-color: #f0f0f0;
    }

    .shape-type-link.active, .shape-link.active {
        background-color: #3498db;
        color: #fff;
    }

    #shapeMap, #allShapesMap {
        position: relative;
        height: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #allShapesMap {
        height: 400px;
    }

    .chart-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .chart-container > div {
        flex: 1 1 calc(33.333% - 10px);
        margin: 5px;
    }
    .custom-tooltip {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    font-size: 12px;
    max-width: 300px;
    word-wrap: break-word;
}
</style>

    <style>
        .gauge {
            height: 349px;
        }

        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <nav class="nav-bg p-4 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a id="home-link" class="inline-flex items-center py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier les
                forêts</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPN">La forêt de la
                province Nord</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestPS">La forêt de la
                province Sud</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-4 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#article">Articles</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#academic">Académique</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#media-production">Médias</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
  document.getElementById('nav-toggle').onclick = function () {
    document.getElementById('nav-content').classList.toggle('hidden');
  };

  // Function to adjust the navigation links based on page depth
  function adjustNavLinks(depth) {
    document.querySelectorAll('a[data-link]').forEach(link => {
      link.href = depth + link.getAttribute('data-link');
    });
  }

  // Adjust the navigation links based on the depth
  adjustNavLinks("../");
</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 500;
    }

    .custom-dropdown {
        z-index: 500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }
</style>
    <div class="flex">
        
<aside class="w-1/4 p-4 mt-28">
    <h2 class="font-semibold text-lg mb-4">Shape Types</h2>
    <ul id="shape-type-list" class="list-disc pl-5">
        <!-- The list of shape types will be generated by JavaScript -->
    </ul>
</aside>

        <div class="w-full">
            
<div id="allShapesMap" class="mt-28"></div>

<div class="rounded overflow-hidden shadow-lg mb-2 mt-8">
    <div class="px-6 py-4">
        <div class="font-bold text-4xl mb-2">70.0</div>
    </div>
</div>

<div class="chart-container">
    <!-- Section for general information -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">General Information</h2>
            
                
                    
                        
                        
                            <p>Shape Area (Total Area): 2992.219478167504</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Forest Area (Forest Area): 2662.5061509453008</p>
                        
                    
                
                    
                
            
                
                    
                        
                        
                            <p>Number of Families (Number of Families): 10</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Species (Number of Species): 11</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Number of Occurrences (Number of Occurrences): 19</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Average Rainfall (Average Rainfall): 2730.3125</p>
                        
                    
                
                    
                        
                        
                            <p>Average Rainfall (Rainfall Range): {"min": 2400.0, "max": 3040.0}</p>
                        
                    
                
            
                
                    
                        
                        
                            <p>Altitude (Median Altitude): 303.0</p>
                        
                    
                
                    
                        
                        
                            <p>Altitude (Maximum Altitude): 793.0</p>
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        </div>
    </div>

    <!-- Section for shape map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Shape Map</h2>
            <div id="shapeMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="shapeMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Section for forest map -->
    <div>
        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
            <h2 class="font-bold text-xl mb-2">Forest Map</h2>
            <div id="forestMap" style="height: 400px; position: relative;">
                <div class="loader-container" id="forestMapLoader">
                    <div class="loader"></div>
                </div>
                <!-- The Leaflet map will be loaded here -->
            </div>
        </div>
    </div>
</div>

<div class="flex flex-wrap -mx-2">
    

    

    
    
        
    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
    
        
            
            

            
            
                
            
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Elevation Distribution</h2>
        
    
    
        <canvas id="elevationDistributionChart"></canvas>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Forest Fragment Distribution</h2>
        
    
    
        <canvas id="forestFragmentationChart"></canvas>
    
    
                        </div>
                    </div>
                
            
                
                    <div class="w-1/2 px-2 mb-4">
                        <div class="rounded overflow-hidden shadow-lg p-4 bg-white">
                            
    
        
            <h2 class="font-bold text-xl mb-2">Fragmentation</h2>
        
    
    
        <div class="gauge" id="forest_fragmentationeffective_mesh_sizeGauge"></div>
    
    
                        </div>
                    </div>
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
        
            
            

            
            
                
            

    
        
    
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
        <div class="container mx-auto">
            <div class="flex justify-center mb-4">
                <div class="bg-white p-2 rounded-lg shadow-md flex justify-center">
                    <figure class="mx-2"><img class="img-fluid" src="../files/ps_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/pn_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/amap_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/herbarium_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/iac_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/ird_100.png"></figure>
                    <figure class="mx-2"><img class="img-fluid" src="../files/cirad_100.png"></figure>
                </div>
            </div>
            <div class="text-center">
                <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
                <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                    <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
                </a>
            </div>
        </div>
    </footer>
    <script src="../js/vendor/chart/4.4.2_chart.js"></script>
    <script src="../js/vendor/d3/7.8.5_d3.js"></script>
    <script src="../js/vendor/jquery/3.6.0_jquery.js"></script>
    <script src="../js/vendor/raphael/2.3.0_raphael.js"></script>
    <script src="../js/vendor/justgage/1.6.1_justgage.js"></script>
    <script src="../js/vendor/leaflet/1.9.4_leaflet.js"></script>
    
<script>
    var shape = {"elevation_elevation_distribution": {"altitudes": [51.0, 151.0, 251.0, 351.0, 451.0, 551.0, 651.0, 751.0], "forest": [161.13574448457007, 735.6680196467958, 843.4622763019909, 565.6420271906632, 215.58851331039028, 103.3491326694139, 33.338429893359326, 0.0], "non_forest": [13.335371957343728, 85.56863672628893, 93.3476037014061, 81.12351274050768, 34.449710889804635, 15.55793395023435, 12.224090960898419, 3.333842989335932]}, "elevation_max": 793.0, "elevation_median": 303.0, "forest_area": "2662.5061509453008", "forest_coordinates": "{\"type\": \"MultiPolygon\", \"coordinates\": [[[[165.19252564880003, -20.955211919400003], [165.1918099192, -20.954776737899998], [165.1918595418, -20.953760329000005], [165.19359934073276, -20.955344683976072], [165.19252564880003, -20.955211919400003]]], [[[165.2044439539393, -20.954772224847307], [165.20392948664983, -20.95474710622779], [165.20303077483206, -20.95458029726081], [165.20498433529562, -20.95477157574115], [165.2044439539393, -20.954772224847307]]], [[[165.17087795594114, -20.937005994226304], [165.1710779435474, -20.937458214084337], [165.1707185235, -20.937339041100003], [165.17087795594114, -20.937005994226304]]], [[[165.20033568150987, -20.91394246062341], [165.2007855473808, -20.915513457908233], [165.20018298840822, -20.914242751986944], [165.19797562604265, -20.914698006872204], [165.19962710247802, -20.91692050712955], [165.19625521058424, -20.915651598919393], [165.19907864626947, -20.917569311174045], [165.20366221648803, -20.91657474389137], [165.20794173324617, -20.919315105024378], [165.20790604194752, -20.9157474321873], [165.2111189464316, -20.916205991102675], [165.20924990174797, -20.91479709081652], [165.21404754395394, -20.915258214919245], [165.21620403797647, -20.918719610958714], [165.21236266279521, -20.91773349734599], [165.21437035793835, -20.91937700592826], [165.21430499111972, -20.921571463410274], [165.2186290793711, -20.920200147373702], [165.22545399786188, -20.923240473945643], [165.22627581432968, -20.926166381444396], [165.22375368783702, -20.92711634999186], [165.22298815498533, -20.92565424980656], [165.2249107430285, -20.924927349323973], [165.21694509268232, -20.922273231160244], [165.22253900314445, -20.925523077164907], [165.224698228863, -20.93086968528058], [165.22644612536928, -20.92825301109967], [165.23062851716367, -20.926654109805984], [165.23421087994674, -20.92717894848446], [165.2324660546728, -20.92760154318401], [165.23305463019818, -20.930509755055056], [165.23670946335687, -20.92972063785217], [165.24233359240645, -20.925519839937085], [165.24407396909908, -20.926484779685836], [165.24442432956053, -20.923325755322864], [165.24763140435263, -20.92416829870901], [165.2498515175595, -20.923201219087378], [165.24912012792223, -20.922293575240378], [165.25253266957787, -20.922734621713367], [165.25208768219534, -20.921288130639994], [165.25121191953397, -20.922367775464814], [165.2496169280665, -20.921120146334697], [165.25370173328488, -20.92073065853204], [165.2584001146638, -20.926382078172917], [165.2586862752812, -20.93176965181068], [165.2565085941942, -20.931398935903662], [165.25517906044064, -20.93459962942969], [165.25643215938223, -20.937785932536922], [165.25373381098825, -20.939781881993454], [165.24832572283816, -20.938476549109705], [165.24962434379276, -20.93637905177693], [165.24740635983753, -20.933895372835263], [165.24751860651898, -20.937688152577575], [165.24543399986732, -20.938927806633192], [165.24204767742734, -20.93946286008425], [165.24324553110034, -20.93832803861799], [165.240418516108, -20.93633044807568], [165.24164549153446, -20.9401996280639], [165.23918888432536, -20.942072032531314], [165.23293854851318, -20.93944411400841], [165.23587392200224, -20.94228264389476], [165.22983738551207, -20.943400093881742], [165.22802639255124, -20.941059835649313], [165.22918784426204, -20.941178958901702], [165.22991251071406, -20.940255753695695], [165.2265969135226, -20.940047288004017], [165.22493586586555, -20.942177253368797], [165.22634846373992, -20.94444600130805], [165.22763676227495, -20.94335321563529], [165.2274428604556, -20.94546925866141], [165.22424126375978, -20.948485331215835], [165.21886013770492, -20.947661356291427], [165.2169393872439, -20.945423412705242], [165.2185657374255, -20.94494384816208], [165.21774671039628, -20.943474624280842], [165.21467101346147, -20.94418855513602], [165.21408551628548, -20.945851414485013], [165.21173037308455, -20.945749586597195], [165.21177235331132, -20.948954288678745], [165.20877250825026, -20.953371635522508], [165.2059506357507, -20.95355180889113], [165.20630257127797, -20.952043768234024], [165.2023295650894, -20.95364398240914], [165.20186057740594, -20.95064026157278], [165.2014562956271, -20.953448038093736], [165.2027002112482, -20.954457438517096], [165.20039958878647, -20.952726512954293], [165.1977343307335, -20.955314051226676], [165.19438208750972, -20.95556481266191], [165.1942410284, -20.953255589699996], [165.1916917674, -20.953294416599995], [165.1902125309, -20.951739511], [165.1911379263, -20.950673568999996], [165.189595326, -20.950395580199995], [165.19169947370003, -20.9558360103], [165.18920997694457, -20.957362715795618], [165.18316921024407, -20.957395031809828], [165.18522279115487, -20.956493320419234], [165.18298813138685, -20.95477787486502], [165.18278794656376, -20.95739544654319], [165.17980934125612, -20.95673855791054], [165.17745257620143, -20.952043360499133], [165.18022368602746, -20.94678379466351], [165.17256502096126, -20.9468129988428], [165.16933697518678, -20.9437173107793], [165.16609552274073, -20.946480495957015], [165.16284521909606, -20.94754065021399], [165.1644633789, -20.946499725400002], [165.1634797939, -20.943012067300007], [165.16212399243668, -20.947624964599033], [165.1575267256, -20.948437960099998], [165.1564103993, -20.946853959699997], [165.15705615053358, -20.948708771227658], [165.15540792340678, -20.94937049871672], [165.1556866208, -20.9456472932], [165.1544247857, -20.946282002800007], [165.15476658722304, -20.94993428052876], [165.1529440997, -20.94671904], [165.1528944518, -20.9504557331], [165.15209940080004, -20.949445182100003], [165.1514185953511, -20.95134197278695], [165.15091295819994, -20.951385543391503], [165.1507164366, -20.9483903222], [165.1503909064, -20.951159028399996], [165.1485869256481, -20.952209630764845], [165.1467334101, -20.9507892663], [165.1470427674, -20.948708321699993], [165.14573577308022, -20.95199892454876], [165.14050585290568, -20.94484671989503], [165.14168481914368, -20.94791907626477], [165.14021228290545, -20.946381481004405], [165.14112793673957, -20.939512567194445], [165.14421497900733, -20.93714711465697], [165.14526217585527, -20.939780978285743], [165.1453445646187, -20.936665558304032], [165.15226899478859, -20.93661629019024], [165.1507360157, -20.9382550664], [165.1521694388, -20.939604406000004], [165.15427596904073, -20.937815933800792], [165.15908870562566, -20.938655548360664], [165.15892061952067, -20.937217478351176], [165.15652188391851, -20.937477340920612], [165.1595173454, -20.932074812999993], [165.15806709714457, -20.932182389554338], [165.15827693347984, -20.930787361259956], [165.16239959770857, -20.926039202530305], [165.16788788751185, -20.926017550668362], [165.16947420412902, -20.926772949888516], [165.1703248921832, -20.927592840856704], [165.16874673967234, -20.92848848243436], [165.17224763626217, -20.931015615455014], [165.1719480197605, -20.933775031850924], [165.1697898436, -20.93634484199999], [165.1669242409, -20.933832062400008], [165.1663415092, -20.934985542899998], [165.16966440280004, -20.936809358700003], [165.170564166, -20.939232623000006], [165.1686158327, -20.93782166050001], [165.1680748574, -20.938768907999997], [165.1705625673, -20.9401322075], [165.171369160172, -20.937681240061696], [165.17728030581895, -20.933797912475555], [165.1884284207969, -20.934739358712093], [165.19098928138823, -20.93293935637496], [165.19516770293188, -20.932747502938952], [165.1963241298132, -20.93462339357075], [165.19721917467982, -20.93084381429663], [165.19330495748346, -20.92472214783146], [165.19132965178605, -20.91570004957203], [165.19444749730147, -20.91496149590903], [165.19316798677133, -20.912899965219992], [165.19461489925766, -20.912162342720645], [165.19814951125275, -20.912271769920824], [165.20033568150987, -20.91394246062341]], [[165.1473577335086, -20.946224821610947], [165.14791369778396, -20.9466708211641], [165.14858370601328, -20.945805447684485], [165.1472793282903, -20.94514642914041], [165.1473577335086, -20.946224821610947]], [[165.14854093953053, -20.949473265556023], [165.1483841290939, -20.949792780823945], [165.14891158238078, -20.950005790623567], [165.14904700957607, -20.949380073474366], [165.14854093953053, -20.949473265556023]], [[165.1540382625, -20.944277469100005], [165.1548975531, -20.945714980599995], [165.1552929767, -20.945767370099997], [165.1555363396, -20.94327051559999], [165.1540382625, -20.944277469100005]], [[165.1414991407, -20.942101133899996], [165.1413453742, -20.9409537287], [165.1411865172, -20.942517373400005], [165.1422179668, -20.943355649899996], [165.1414991407, -20.942101133899996]], [[165.1461887829809, -20.940992548512305], [165.1460554292, -20.94244049039999], [165.1464290656, -20.9425806041], [165.1466520865437, -20.9411722861174], [165.1461887829809, -20.940992548512305]], [[165.14700134615256, -20.940386764624513], [165.1463384656704, -20.939807606308175], [165.14708519563527, -20.938625999941042], [165.14570431097846, -20.940415097763005], [165.14700134615256, -20.940386764624513]], [[165.1579311957, -20.944632802599997], [165.1568694873, -20.944655375699995], [165.1578151875, -20.946431724500002], [165.1595807535, -20.9450884873], [165.1579311957, -20.944632802599997]], [[165.1591914168, -20.9412321946], [165.15946048540002, -20.940821117499997], [165.1587354948, -20.9407687986], [165.1586233829, -20.941239668799998], [165.1591914168, -20.9412321946]], [[165.1599307272, -20.943940628100002], [165.1599529528, -20.943302292799995], [165.1587845085, -20.9429609177], [165.158868923, -20.943882520899994], [165.1599307272, -20.943940628100002]], [[165.16049211966697, -20.93127271085219], [165.16031303100303, -20.931395245201195], [165.1605863768585, -20.933223834717158], [165.16123675148015, -20.932507480061417], [165.16049211966697, -20.93127271085219]], [[165.16249979784683, -20.9278606005183], [165.162999360962, -20.92745529459466], [165.1622170262722, -20.92676721709639], [165.1620002347317, -20.926984008636943], [165.16249979784683, -20.9278606005183]], [[165.16760853762852, -20.930480950443226], [165.1675896861902, -20.931150176503184], [165.1683154665651, -20.930716593422087], [165.16815522933948, -20.93060348479223], [165.16760853762852, -20.930480950443226]], [[165.1724169099, -20.9438065424], [165.1735601664, -20.94213429119999], [165.1721702673, -20.9417627516], [165.1719249833, -20.943789320100002], [165.1670703762, -20.941696100299993], [165.1686312361, -20.943625344500003], [165.1705920491, -20.943629075], [165.1720283754, -20.944531313599995], [165.1724169099, -20.9438065424]], [[165.1701534818002, -20.92994368445142], [165.16908837553575, -20.930603484792236], [165.16908837553575, -20.930895682086025], [165.17059649060047, -20.93017932743028], [165.1701534818002, -20.92994368445142]], [[165.1822046109, -20.947124209299997], [165.1835476036, -20.946534660500003], [165.1801478003, -20.9445587943], [165.1805937203, -20.9471546104], [165.1822046109, -20.947124209299997]], [[165.1847771183, -20.9539429156], [165.1843729192, -20.9533956394], [165.18372060043296, -20.95475140974734], [165.1848104147, -20.9552670726], [165.1847771183, -20.9539429156]], [[165.18758875489803, -20.95625952953552], [165.18750459017988, -20.95582000267414], [165.18636369066738, -20.956194068088084], [165.18678451425808, -20.956371749159704], [165.18758875489803, -20.95625952953552]], [[165.18852878290002, -20.949216958599997], [165.1878937592, -20.948149022199996], [165.18728349550003, -20.9485656728], [165.1874901349, -20.948967081199992], [165.18852878290002, -20.949216958599997]], [[165.1782728707, -20.936351587699995], [165.1783625603, -20.9357835538], [165.177368501, -20.935581752299996], [165.1776898886, -20.936232001599997], [165.1782728707, -20.936351587699995]], [[165.1790875509, -20.937480181400005], [165.1784671981, -20.937270905699993], [165.1793416713, -20.938347180399997], [165.1798050674, -20.937726827599988], [165.1790875509, -20.937480181400005]], [[165.1948862789564, -20.95226262643304], [165.1941626126, -20.9516545177], [165.1938727436, -20.95185566489999], [165.1939996170756, -20.95226764511005], [165.1948862789564, -20.95226262643304]], [[165.1996138033496, -20.949745876583933], [165.1984598214696, -20.950090046618325], [165.19894570857699, -20.95205384034388], [165.20064631345272, -20.948895574146064], [165.1996138033496, -20.949745876583933]], [[165.19959355805344, -20.945798043836678], [165.19912791624222, -20.946324421536307], [165.1997757657187, -20.94729619575102], [165.19995797338396, -20.946830553939808], [165.19959355805344, -20.945798043836678]], [[165.15740784457563, -20.943035125207743], [165.15651138534892, -20.942661600529956], [165.1560444795017, -20.94282968663496], [165.15743585892645, -20.943744822095542], [165.1582762894515, -20.943249901897474], [165.15740784457563, -20.943035125207743]], [[165.1527481242202, -20.941970579876045], [165.1515341690174, -20.941382278508527], [165.15290687220826, -20.942941744038297], [165.1545223664397, -20.942923067804408], [165.1540834749433, -20.941148825584907], [165.1527481242202, -20.941970579876045]], [[165.21048570128937, -20.919040833718253], [165.2102802627166, -20.918452532350734], [165.20944917030852, -20.919180905472423], [165.21010283849463, -20.91943303462993], [165.21048570128937, -20.919040833718253]], [[165.21000468910847, -20.94303786807019], [165.20892282974455, -20.94465290911071], [165.20978905686655, -20.94599520656659], [165.2115478948077, -20.943774683651835], [165.21000468910847, -20.94303786807019]], [[165.21026594053086, -20.94671643399613], [165.21117069198095, -20.94757709976608], [165.21124774606858, -20.947504524286682], [165.21108594879692, -20.94645760464034], [165.21026594053086, -20.94671643399613]], [[165.19451736940098, -20.93952936368171], [165.19510454345402, -20.93901230463475], [165.19339388044384, -20.938562411570473], [165.19338733279207, -20.93940872287196], [165.19451736940098, -20.93952936368171]], [[165.1947892926489, -20.937277024529305], [165.19533956033888, -20.937742579985265], [165.19549121180708, -20.936946306848352], [165.19424670879673, -20.936847318847594], [165.1947892926489, -20.937277024529305]], [[165.19546443431807, -20.92513214058926], [165.19504379774142, -20.924522994952227], [165.19470913462138, -20.925462919127988], [165.19551861376567, -20.925705844758234], [165.19546443431807, -20.92513214058926]], [[165.19477491156397, -20.917290257663062], [165.19343832404752, -20.922634978269105], [165.19436311120268, -20.923516094010584], [165.19476720552058, -20.923142685448294], [165.19477491156397, -20.917290257663062]], [[165.1981529941051, -20.94080718742016], [165.19730514484536, -20.94047825488674], [165.19815425863635, -20.941768242438634], [165.19833647442798, -20.941000619981043], [165.1981529941051, -20.94080718742016]], [[165.19893376835802, -20.936590897640823], [165.19852799454858, -20.93570920581744], [165.19801666816767, -20.935831724966395], [165.19813931430977, -20.936211702222046], [165.19893376835802, -20.936590897640823]], [[165.1969958023834, -20.912622268799346], [165.19608858036597, -20.91346961890459], [165.197066795012, -20.914379348230124], [165.19746229796792, -20.913297699444897], [165.1969958023834, -20.912622268799346]], [[165.19860378171114, -20.920807340640206], [165.1985801258393, -20.920233601700076], [165.19806067206798, -20.919940149590598], [165.19828290644486, -20.920599723160915], [165.19860378171114, -20.920807340640206]], [[165.2001985853724, -20.920375153733723], [165.20028477231713, -20.922046147196284], [165.20062078666888, -20.9221533339545], [165.20068837055038, -20.921314121311138], [165.2001985853724, -20.920375153733723]], [[165.2007457754409, -20.91856356100282], [165.20202060659375, -20.918619434484558], [165.20211944481326, -20.91832526221787], [165.20072189225948, -20.917824864641446], [165.2007457754409, -20.91856356100282]], [[165.20617834928683, -20.93640120506514], [165.2018534281207, -20.933431759902568], [165.20451812645254, -20.9337441589492], [165.2030806309867, -20.932040715913562], [165.20134921699741, -20.93248693146882], [165.20254415339727, -20.930477841977012], [165.20048416277373, -20.931346301242357], [165.20303401252733, -20.937100664894025], [165.20617834928683, -20.93640120506514]], [[165.20462181930895, -20.928589109572844], [165.2056676451317, -20.928587852904936], [165.20577400859574, -20.928214777015043], [165.20523929474726, -20.927957226058908], [165.20462181930895, -20.928589109572844]], [[165.20486880727069, -20.93900086223446], [165.20448720946337, -20.939087384663235], [165.20636488054035, -20.941860471886194], [165.2065565858684, -20.939436323555313], [165.20486880727069, -20.93900086223446]], [[165.20524034591986, -20.923123246785277], [165.20584341106326, -20.923136865043613], [165.2074189197268, -20.92532244133523], [165.2075603040018, -20.92266860188498], [165.20560509039217, -20.92190355498216], [165.20524034591986, -20.923123246785277]], [[165.20845826451614, -20.939964743730688], [165.2088244045561, -20.9397419621883], [165.20715361111183, -20.940561613525837], [165.20823714631504, -20.940165831402965], [165.20845826451614, -20.939964743730688]], [[165.20871247447985, -20.933342825191918], [165.20932277629325, -20.933040851079603], [165.20927635471085, -20.932596239862498], [165.20800991832854, -20.933178725244424], [165.20871247447985, -20.933342825191918]], [[165.2099310297496, -20.939487789298468], [165.21090023622463, -20.939235572143595], [165.2105627227145, -20.938088459096782], [165.20994516869274, -20.93867732898416], [165.2099310297496, -20.939487789298468]], [[165.2140556719172, -20.93559720137316], [165.21222335264267, -20.935506252698328], [165.21108761859426, -20.936755600109926], [165.21386926518457, -20.938156506200208], [165.2122021375178, -20.93670401359029], [165.2140556719172, -20.93559720137316]], [[165.21264113165932, -20.931315453700623], [165.21316895642235, -20.932082206498453], [165.2135739007926, -20.9323255505697], [165.21316741412787, -20.930992054323383], [165.21264113165932, -20.931315453700623]], [[165.22035874232017, -20.943730070417757], [165.21956698191119, -20.943626387507063], [165.22156523437192, -20.94438987075856], [165.22195168885725, -20.94389030764339], [165.22035874232017, -20.943730070417757]], [[165.2249584932675, -20.944936562469522], [165.2239876441946, -20.945115651133452], [165.22380855553067, -20.945228759763307], [165.22552403641677, -20.94512507685261], [165.2249584932675, -20.944936562469522]], [[165.2157000663681, -20.929733761336177], [165.21497435230106, -20.929383245417153], [165.2168233520958, -20.930506921550656], [165.21667790661036, -20.930227395637896], [165.2157000663681, -20.929733761336177]], [[165.21880398426535, -20.940772992822232], [165.2166417431846, -20.93958518996306], [165.21913096843772, -20.93988323817939], [165.21954130914366, -20.938570224203758], [165.21454057944413, -20.93837576633657], [165.21800293541264, -20.941161309130838], [165.21880398426535, -20.940772992822232]], [[165.21653382584543, -20.92824091582659], [165.2156393541816, -20.927316851072025], [165.2179636384154, -20.9298312952642], [165.21736655540496, -20.928691697912114], [165.21653382584543, -20.92824091582659]], [[165.21948545404683, -20.92643157872294], [165.2188581930242, -20.925535875274736], [165.21773601179726, -20.92550862169312], [165.2181489322248, -20.925995795365488], [165.21948545404683, -20.92643157872294]], [[165.21992696451468, -20.930811350212338], [165.22128391861838, -20.929532969136414], [165.21807436790763, -20.927220521368042], [165.22027630875758, -20.929570132539393], [165.21891210777213, -20.931121053426597], [165.21992696451468, -20.930811350212338]], [[165.22608090311513, -20.93658399153063], [165.22519256372638, -20.934727602755693], [165.2228723167409, -20.935074907083067], [165.22354530818927, -20.93587729764134], [165.22608090311513, -20.93658399153063]], [[165.22780860798738, -20.933110417925757], [165.2279157658337, -20.933296748433342], [165.22767270281014, -20.934107515516914], [165.22867900172832, -20.933188146742655], [165.22780860798738, -20.933110417925757]], [[165.24828304192164, -20.933148206522443], [165.24834513041864, -20.933764912634008], [165.24902402333188, -20.933441181234624], [165.24858044737618, -20.932954128276826], [165.24828304192164, -20.933148206522443]], [[165.25045027447118, -20.931506226629967], [165.25112973836437, -20.93153391661504], [165.24986879064235, -20.930718152941783], [165.25029756095327, -20.93148493445707], [165.25045027447118, -20.931506226629967]], [[165.25537189354642, -20.925673435129344], [165.2530895461404, -20.92573420988327], [165.25281554275634, -20.926215143561546], [165.25519734103455, -20.92627614872611], [165.25537189354642, -20.925673435129344]], [[165.25485532890605, -20.92716420132115], [165.2559664862437, -20.929679929553714], [165.25695916058353, -20.929843395474972], [165.25678105339722, -20.928359048761543], [165.25485532890605, -20.92716420132115]]], [[[165.17151106421798, -20.929274656797467], [165.17142826329714, -20.929022788670345], [165.17158819088394, -20.92927457927271], [165.17151106421798, -20.929274656797467]]], [[[165.20525099176672, -20.915473598310744], [165.20502368544587, -20.916852942905813], [165.2033328335399, -20.914910655455014], [165.2039736669195, -20.91501902092609], [165.20525099176672, -20.915473598310744]]], [[[165.2034492497623, -20.915359933676307], [165.2037397950975, -20.915746582434902], [165.20185779946567, -20.91482699523739], [165.20268606088734, -20.91487207084], [165.2034492497623, -20.915359933676307]]], [[[165.19189730000264, -20.91437626868152], [165.19216023512192, -20.913849693538385], [165.1926655258118, -20.913315499410075], [165.19237788948251, -20.91414622130662], [165.19189730000264, -20.91437626868152]]], [[[165.2080091190115, -20.953973642005117], [165.20807650379876, -20.953855828804826], [165.20839170073577, -20.953730284220516], [165.2083835320079, -20.953737977618122], [165.2080091190115, -20.953973642005117]]], [[[165.21511669747719, -20.94599688661054], [165.2150857687739, -20.945930842030517], [165.2153507364876, -20.945924603560652], [165.21511669747719, -20.94599688661054]]], [[[165.2164667000562, -20.945276438659175], [165.21672580410953, -20.94538731225984], [165.2159248701837, -20.945747282119562], [165.2159857404941, -20.945291392303343], [165.2164667000562, -20.945276438659175]]], [[[165.23467230531998, -20.92855043553286], [165.23380698703548, -20.928995862743133], [165.23487410134683, -20.927585191140516], [165.2352945041199, -20.927933178830298], [165.23467230531998, -20.92855043553286]]], [[[165.2259234217463, -20.92829329741254], [165.22488517960053, -20.92825880783388], [165.224872205819, -20.927063556460304], [165.2264644089835, -20.927335312088708], [165.2259234217463, -20.92829329741254]]], [[[165.22639794515152, -20.926851399544873], [165.22645988581496, -20.927234319595144], [165.22593687208143, -20.92708120061331], [165.22604359297827, -20.926980650436327], [165.22639794515152, -20.926851399544873]]], [[[165.22434157853345, -20.922052098328194], [165.2190207401768, -20.919405020279093], [165.217638698869, -20.920021335997447], [165.21657967389208, -20.91885081865832], [165.22045919173868, -20.91938329695431], [165.22434157853345, -20.922052098328194]]]]}", "forest_cover_percentage": null, "forest_fragmentation_effective_mesh_size": 26.582828969437127, "forest_fragmentation_fragment_size_distribution": {"10": 0.07937275141627824, "100": 0.07937275141627824, "1000": 0.07937275141627824, "1100": 0.07937275141627824, "1200": 0.07937275141627824, "12000": 100.0, "125": 0.07937275141627824, "1300": 0.07937275141627824, "1400": 0.07937275141627824, "150": 0.07937275141627824, "1500": 0.07937275141627824, "1600": 0.07937275141627824, "1700": 0.07937275141627824, "17000": 100.0, "175": 0.07937275141627824, "1800": 0.07937275141627824, "1900": 0.07937275141627824, "20": 0.07937275141627824, "200": 0.07937275141627824, "2000": 0.07937275141627824, "225": 0.07937275141627824, "250": 0.07937275141627824, "27000": 100.0, "275": 0.07937275141627824, "30": 0.07937275141627824, "300": 0.07937275141627824, "325": 0.07937275141627824, "350": 0.07937275141627824, "375": 0.07937275141627824, "40": 0.07937275141627824, "400": 0.07937275141627824, "425": 0.07937275141627824, "450": 0.07937275141627824, "475": 0.07937275141627824, "50": 0.07937275141627824, "500": 0.07937275141627824, "500000": 100.0, "60": 0.07937275141627824, "600": 0.07937275141627824, "70": 0.07937275141627824, "700": 0.07937275141627824, "7000": 100.0, "80": 0.07937275141627824, "800": 0.07937275141627824, "90": 0.07937275141627824, "900": 0.07937275141627824}, "forest_humidity_category_distribution": null, "frequencies": {}, "id": 172, "land_use_category_distribution": null, "name": "70.0", "num_families_unique_taxonomic_count": 10, "num_occurrences_count": 19, "num_species_unique_taxonomic_count": 11, "rainfall_mean": "2730.3125", "rainfall_range": "{\"min\": 2400.0, \"max\": 3040.0}", "shape_area": "2992.219478167504", "shape_coordinates": "{\"type\": \"FeatureCollection\", \"features\": [{\"id\": \"0\", \"type\": \"Feature\", \"properties\": {}, \"geometry\": {\"type\": \"Polygon\", \"coordinates\": [[[165.14073039812249, -20.940509187050274], [165.14617238357516, -20.93637615134732], [165.15720379108353, -20.937279296731003], [165.15955697547895, -20.928235495621774], [165.1633239483485, -20.925865538433452], [165.16871853726445, -20.926325751032152], [165.1714635123857, -20.92906178475438], [165.17222196953202, -20.932925428374375], [165.17003108002984, -20.935876614103154], [165.17121320275706, -20.937828069810067], [165.17716020197454, -20.93382048686702], [165.1884284207969, -20.934739358712093], [165.19098928138823, -20.93293935637496], [165.19543181436674, -20.93273581124225], [165.19721917467982, -20.93084381429663], [165.19330495748346, -20.92472214783146], [165.19123934003855, -20.916513978357905], [165.19219401519106, -20.913806091205746], [165.1956042825358, -20.911969375858586], [165.20664631966943, -20.91633696171232], [165.2095223675244, -20.9146193690451], [165.21404754395394, -20.915258214919245], [165.21622272666923, -20.918858539807413], [165.22436594223277, -20.921642027614517], [165.2264249411305, -20.92837154148343], [165.23192421023168, -20.926626620112195], [165.2372007553769, -20.928582002717317], [165.2433490997635, -20.923148235528178], [165.25192998180532, -20.92053476502175], [165.2560253482711, -20.92218440425293], [165.2589519552711, -20.92810851636571], [165.25693462775192, -20.936765260574813], [165.25460420804393, -20.939441662741363], [165.2509122629643, -20.93988465509508], [165.24757396584624, -20.937635984045762], [165.242197009987, -20.93901975045751], [165.23918888432536, -20.942072032531314], [165.23169024802536, -20.943476608291704], [165.2274441650155, -20.942260238028688], [165.22708331261128, -20.946287970435183], [165.22331684774528, -20.948659325331516], [165.21964475087043, -20.948152388121443], [165.21690309717619, -20.94534975786284], [165.21173037308455, -20.945749586597195], [165.21141271178325, -20.949772967913393], [165.2076002832182, -20.95423097291388], [165.20300454156, -20.954575428130433], [165.20039958878647, -20.952726512954293], [165.1977343307335, -20.955314051226676], [165.19308265691814, -20.955112783609284], [165.18920997694457, -20.957362715795618], [165.17922032626026, -20.956369761059218], [165.17747940196637, -20.951560098050802], [165.18022368602746, -20.94678379466351], [165.17256502096126, -20.9468129988428], [165.16933697518678, -20.9437173107793], [165.1651468116832, -20.94694261430638], [165.14582936743128, -20.952035248670505], [165.14021228290545, -20.946381481004405], [165.14073039812249, -20.940509187050274]]]}, \"bbox\": [165.14021228290545, -20.957362715795618, 165.2589519552711, -20.911969375858586]}], \"bbox\": [165.14021228290545, -20.957362715795618, 165.2589519552711, -20.911969375858586]}", "shape_id": 172, "type": "hotspots"};
    var mapping = {"fields": {"elevation": {"data_source": {"name": "elevation", "type": "layer"}, "description": "Altitude metrics within the shape", "field_type": "JSON", "label": "Altitude", "transformations": [{"chart_options": {"title": "Median Altitude"}, "chart_type": "text", "name": "median"}, {"chart_options": {"title": "Maximum Altitude"}, "chart_type": "text", "name": "max"}, {"chart_options": {"title": "Elevation Distribution", "x_label": "Elevation (m)", "y_label": "Area (ha)"}, "chart_type": "stacked_bar", "data_structure": {"x_field": "altitudes", "y_fields": [{"color": "#4BC0C0", "label": "For\u00eat", "name": "forest"}, {"color": "#FF6384", "label": "Hors-for\u00eat", "name": "non_forest"}]}, "name": "elevation_distribution"}]}, "forest": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "TEXT", "label": "Forest Area", "transformations": [{"chart_options": {"title": "Forest Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "forest_coordinates", "title": "Forest Location"}, "chart_type": "map", "name": "coordinates"}]}, "forest_cover": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Area covered by forest within the shape", "field_type": "JSON", "label": "Forest Area", "transformations": [{"chart_options": {"categories": ["UM", "Non-UM", "Commune"], "title": "Forest Cover"}, "chart_type": "donut", "layer_params": {"forest_cover": [{"name": "area"}, {"attribute": "cover_type"}], "soil_types": [{"attribute": "soil_category"}]}, "name": "percentage"}]}, "forest_fragmentation": {"data_source": {"name": "forest_cover", "type": "layer"}, "description": "Analysis of forest fragmentation", "field_type": "JSON", "label": "Forest Fragmentation", "transformations": [{"chart_options": {"bins": [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 7000, 12000, 17000, 27000, 500000], "title": "Forest Fragment Distribution", "x_label": "Area (ha)", "y_label": "Cumulative Area (%)"}, "chart_type": "line", "data_structure": {"color": "#4BC0C0", "x_field": "keys", "y_field": "values"}, "name": "fragment_size_distribution"}, {"chart_options": {"label": "Effective Mesh Size (km\u00b2)", "max": 1000, "min": 0, "title": "Fragmentation"}, "chart_type": "gauge", "name": "effective_mesh_size"}]}, "forest_humidity": {"data_source": [{"name": "forest_cover", "type": "layer"}, {"name": "holdridge", "type": "shape"}], "description": "Distribution of forests by humidity level", "field_type": "JSON", "label": "Forest and Living Environments", "transformations": [{"chart_options": {"categories": ["Dry", "Humid", "Very Humid"], "title": "Forest and Living Environments", "x_label": "Category", "y_label": "Frequency (%)"}, "chart_type": "stacked_bar", "layer_params": {"forest_cover": [{"name": "area"}], "humidity": [{"name": "value"}]}, "name": "category_distribution"}]}, "land_use": {"data_source": [{"name": "ultramafic", "type": "shape"}, {"name": "holdridge", "type": "shape"}, {"name": "forest_cover", "type": "layer"}], "description": "Land use distribution", "field_type": "JSON", "label": "Land Use", "transformations": [{"chart_options": {"title": "Land Use", "x_label": "Category", "y_label": "Area (ha)"}, "chart_type": "bar", "name": "category_distribution"}]}, "num_families": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of families in the zone", "field_type": "INTEGER", "label": "Number of Families", "transformations": [{"chart_options": {"title": "Number of Families"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["family"]}]}, "num_occurrences": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of occurrences in the zone", "field_type": "INTEGER", "label": "Number of Occurrences", "source_field": "id_occurrence", "transformations": [{"chart_options": {"title": "Number of Occurrences"}, "chart_type": "text", "name": "count"}]}, "num_species": {"data_source": {"name": "occurrences", "type": "source"}, "description": "Total number of species in the zone", "field_type": "INTEGER", "label": "Number of Species", "transformations": [{"chart_options": {"title": "Number of Species"}, "chart_type": "text", "name": "unique_taxonomic_count", "target_ranks": ["species", "infra"]}]}, "rainfall": {"data_source": {"name": "rainfall", "type": "layer"}, "description": "Average annual rainfall within the shape", "field_type": "TEXT", "label": "Average Rainfall", "transformations": [{"chart_options": {"title": "Average Rainfall"}, "chart_type": "text", "name": "mean"}, {"chart_options": {"title": "Rainfall Range"}, "chart_type": "text", "name": "range"}]}, "shape": {"data_source": {"name": "self", "type": "shape"}, "description": "Total area of the reference zone", "field_type": "TEXT", "label": "Shape Area", "transformations": [{"chart_options": {"title": "Total Area"}, "chart_type": "text", "name": "area"}, {"chart_options": {"coordinates_field": "shape_coordinates", "title": "Location"}, "chart_type": "map", "name": "coordinates"}]}}, "group_by": "shape", "source_location_field": "geo_pt", "source_table_name": "occurrences"};
    var currentShapeType = "hotspots";

    document.addEventListener('DOMContentLoaded', function () {
        loadShapeCharts(shape, mapping);
        loadShapeTypeList();
        initShapeMaps(mapping, shape);
        loadAllShapesMap(shape);
    });

    function loadShapeCharts(shape, mapping) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            if (field.field_type !== 'TEXT' && shape[field_key] !== null) {
                // Handle bins chart if present
                if (field.bins && field.bins.values && field.bins.values.length > 0) {
                    var binChartId = field_key + 'BinChart';
                    var binCtx = document.getElementById(binChartId);
                    if (binCtx) {
                        createBinChart(binCtx, field, shape);
                    }
                }

                // Handle transformations
                field.transformations.forEach(function(transformation) {
                    var transformationName = transformation.name ? transformation.name : '';
                    var valueKey = field_key + '_' + transformationName;

                    if (shape[valueKey] !== null) {
                        switch(transformation.chart_type) {
                            case 'pie':
                                var pieChartId = field_key + 'PieChart';
                                var pieCtx = document.getElementById(pieChartId);
                                if (pieCtx) {
                                    createPieChart(pieCtx, transformation, shape[valueKey]);
                                }
                                break;
                            case 'gauge':
                                var gaugeId = field_key + transformationName + 'Gauge';
                                var gaugeElement = document.getElementById(gaugeId);
                                if (gaugeElement) {
                                    createGauge({
                                        id: gaugeId,
                                        value: parseFloat(shape[valueKey]),
                                        min: 0,
                                        max: transformation.chart_options.max,
                                        title: transformation.chart_options.title,
                                        label: transformation.chart_options.label
                                    });
                                }
                                break;
                            case 'bar':
                                var barChartId = field_key + transformationName + 'BarChart';
                                var barCtx = document.getElementById(barChartId);
                                if (barCtx) {
                                    createBarChart(barCtx, field, transformation, shape[valueKey]);
                                }
                                break;
                            case 'stacked_bar':
                                if (field_key === 'elevation' && transformationName === 'elevation_distribution') {
                                    var stackedBarChartId = 'elevationDistributionChart';
                                    var stackedBarCtx = document.getElementById(stackedBarChartId);
                                    if (stackedBarCtx) {
                                        createElevationDistributionChart(stackedBarCtx, shape.elevation_elevation_distribution, transformation);
                                    }
                                }
                                break;
                            case 'line':
                                if (field_key === 'forest_fragmentation' && transformationName === 'fragment_size_distribution') {
                                    var lineChartId = 'forestFragmentationChart';
                                    var lineCtx = document.getElementById(lineChartId);
                                    if (lineCtx) {
                                        createForestFragmentationChart(lineCtx, shape.forest_fragmentation_fragment_size_distribution, transformation);
                                    }
                                }
                                break;
                        }
                    }
                });
            }
        });
    }

    function createBinChart(ctx, field, shape) {
        var binData = {
            labels: field.bins.values,
            datasets: [{
                label: field.label,
                data: field.bins.values.map(value => shape.frequencies[field.field_key][value] || 0),
                backgroundColor: field.bins.chart_options.color
            }]
        };

        new Chart(ctx, {
            type: field.bins.chart_type,
            data: binData,
            options: field.bins.chart_options
        });
    }

    function createPieChart(ctx, transformation, data) {
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['True', 'False'],
                datasets: [{
                    data: [data.true || 0, data.false || 0],
                    backgroundColor: ['#FF6384', '#36A2EB']
                }]
            },
            options: {
                title: {
                    display: true,
                    text: transformation.chart_options.title
                }
            }
        });
    }

    function createBarChart(ctx, field, transformation, data) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: field.label,
                    data: Object.values(data),
                    backgroundColor: getColor(0).background,
                    borderColor: getColor(0).border,
                    borderWidth: 1
                }]
            },
            options: transformation.chart_options
        });
    }

    function createElevationDistributionChart(ctx, elevationData, chartConfig) {
        const altitudes = elevationData.altitudes.reverse();
        const forestData = elevationData.forest.reverse();
        const nonForestData = elevationData.non_forest.reverse();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: altitudes,
                datasets: [
                    {
                        label: 'Forest',
                        data: forestData,
                        backgroundColor: '#4CAF50',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Non-Forest',
                        data: nonForestData,
                        backgroundColor: '#FFF59D',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Area (ha)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString(); // Format les grands nombres
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Elevation (m)'
                        },
                        reverse: false
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 0,
                        bottom: 10
                    }
                }
            }
        });
    }

    function createForestFragmentationChart(ctx, fragmentationData, chartConfig) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(fragmentationData),
                datasets: [{
                    label: 'Cumulative Area (%)',
                    data: Object.values(fragmentationData),
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.x_label
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: chartConfig.chart_options.y_label
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartConfig.chart_options.title
                    }
                }
            }
        });
    }

    function createGauge(options) {
        new JustGage({
            id: options.id,
            value: options.value || 0,
            min: options.min || 0,
            max: options.max,
            title: options.title,
            label: options.label,
            pointer: true,
            pointerOptions: {
                toplength: 10,
                bottomlength: 10,
                bottomwidth: 2,
                color: '#8e8e93',
                stroke: '#ffffff',
                stroke_width: 3,
                stroke_linecap: 'round'
            },
            gaugeWidthScale: 0.6,
            counter: true,
            donut: true,
            relativeGaugeSize: true,
            donutStartAngle: 270,
            hideInnerShadow: true,
            customSectors: [{
                color: "#ff0000",
                lo: 0,
                hi: options.max * 0.33
            }, {
                color: "#ffff00",
                lo: options.max * 0.33,
                hi: options.max * 0.66
            }, {
                color: "#00ff00",
                lo: options.max * 0.66,
                hi: options.max
            }],
            humanFriendly: true,
            formatNumber: true,
            textRenderer: function (val) {
                return parseFloat(val).toFixed(2);
            }
        });
    }

    // Function to get a color based on the index
    function getColor(index) {
        var colors = [
            {background: 'rgba(54, 162, 235, 0.6)', border: 'rgba(54, 162, 235, 1)'},
            {background: 'rgba(75, 192, 192, 0.6)', border: 'rgba(75, 192, 192, 1)'},
            {background: 'rgba(255, 99, 132, 0.6)', border: 'rgba(255, 99, 132, 1)'}
        ];
        return colors[index % colors.length];
    }

// Rest of the code (loadShapeTypeList, initShapeMaps, loadAllShapesMap) remains the same...

    let maps = {};  // Object to keep track of initialized maps

    function initMap(field_key, geometry) {
        const mapId = field_key + 'Map';
        const mapLoaderId = field_key + 'MapLoader';

        // Check if the map already exists
        if (maps[mapId]) {
            return; // Map is already initialized, so do nothing
        }

        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        map.on('load', function () {
            document.getElementById(mapLoaderId).style.display = 'none';
        });

        if (geometry) {
            const geoJsonLayer = L.geoJSON(geometry, {
                style: function() {
                    return {
                        color: '#228b22', // Border color
                        weight: 2,       // Border width
                        fillColor: '#228b22cc', // Fill color with opacity
                        fillOpacity: 0.8 // Fill opacity
                    };
                }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
        } else {
            console.warn("No geographic coordinates found.");
            // Set default view if no geometry is found
            map.setView([-21.291237, 165.516418], 10);
        }

        // Store the map instance in the maps object
        maps[mapId] = map;
    }

    function initShapeMaps(mapping, shape) {
        Object.entries(mapping.fields).forEach(function([field_key, field]) {
            field.transformations.forEach(function(transformation) {
                if (transformation.chart_type === 'map') {
                    var coordinatesField = transformation.chart_options.coordinates_field;
                    var geometry = shape[coordinatesField];

                    // Check if geometry is a string, if so, parse it as JSON
                    if (typeof geometry === 'string') {
                        try {
                            geometry = JSON.parse(geometry);
                        } catch (e) {
                            console.error("Invalid JSON for field", coordinatesField, ":", geometry);
                            return; // Skip this field if JSON is invalid
                        }
                    }

                    // Initialize the map with the parsed geometry
                    initMap(field_key, geometry);
                }
            });
        });
    }

    function loadAllShapesMap(currentShape) {
        const mapId = 'allShapesMap';
        const satellite = L.tileLayer.wms("https://carto10.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer", {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const carte = L.tileLayer.wms('https://carto.gouv.nc/arcgis/services/fond_cartographie/MapServer/WMSServer', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: "<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>"
        });
        const map = L.map(mapId, {
            layers: [carte, satellite],
            scrollWheelZoom: false
        });
        map.attributionControl.setPrefix(false); // Remove the "Powered by Leaflet" prefix
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        const baseMaps = {
            "Carte": carte,
            "Satellite": satellite,
        };

        L.control.layers(baseMaps).addTo(map);

        var group = L.featureGroup(); // Create a group to hold all the layers

        shapeTypes.forEach(function(shapeTypeItem) {
            if (shapeTypeItem.type === currentShape.type) {
                shapeTypeItem.shapes.forEach(function(shapeItem) {
                    var geometry = shapeItem.geometry;
                    // No need to parse geometry if it's already GeoJSON
                    var layer = L.geoJSON(geometry, {
                        style: function() {
                            return {
                                color: '#228b22', // Border color
                                weight: 2,       // Border width
                                fillColor: '#228b22cc', // Fill color with opacity
                                fillOpacity: 0.8 // Fill opacity
                            };
                        }
                    }).addTo(map);
                    group.addLayer(layer); // Add each layer to the group

                    // Highlight current shape
                    if (shapeItem.id === currentShape.id) {
                        layer.setStyle({color: 'red', weight: 3, fillOpacity: 0.4});
                        layer.bringToFront(); // Ensure the highlighted shape is on top
                    } else {
                        layer.setStyle({fillOpacity: 0.2}); // Reduce opacity for other shapes
                    }

                    // Show tooltip on hover with additional content
                    var tooltipContent = "<strong>" + shapeItem.name + "</strong><br>";

                    


                    layer.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'right',
                        offset: L.point(10, 0),
                        opacity: 0.9,
                        className: 'custom-tooltip'
                    });


                    layer.on('mousemove', function(e) {
                        var tooltip = e.target.getTooltip();
                        tooltip.setLatLng(e.latlng);
                    });

                    layer.on('click', function() {
                        window.location.href = '../shape/' + shapeItem.id + '.html';
                    });
                });
            }
        });

        map.fitBounds(group.getBounds()); // Adjust the view to fit the bounds of the group

        map.attributionControl.setPrefix(false);
        map.attributionControl.addAttribution("<a href='http://www.geoportal.gouv.nc/'>Géorep</a> <i> - Gouvernement de la Nouvelle-Calédonie</i>");

        maps['allShapesMap'] = map;
    }

    function loadShapeTypeList() {
            var shapeTypeListElement = document.getElementById("shape-type-list");
            shapeTypes.forEach(function (shapeTypeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "javascript:void(0)";
                a.textContent = shapeTypeItem.type;
                a.className = "shape-type-link";
                if (shapeTypeItem.type === currentShapeType) {
                    a.classList.add("active");
                }
                a.onclick = function () {
                    if (shapeTypeItem.shapes.length > 0) {
                        // Redirect to the first shape of the selected type
                        window.location.href = "../shape/" + shapeTypeItem.shapes[0].id + ".html";
                    }
                    loadShapeList(shapeTypeItem.shapes);
                };
                li.appendChild(a);
                shapeTypeListElement.appendChild(li);
            });
        }

        function loadShapeList(shapes) {
            var shapeListElement = document.getElementById("shape-list");
            shapeListElement.innerHTML = ''; // Clear the previous list
            shapes.forEach(function (shapeItem) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "../shape/" + shapeItem.id + ".html";
                a.textContent = shapeItem.name;
                a.className = "shape-link";
                if (shapeItem.id === shape.id) {
                    a.classList.add("active");
                }
                li.appendChild(a);
                shapeListElement.appendChild(li);
            });
        }

</script>

</body>
</html>